var IV = (function(SCOPE) {

    SCOPE.baseData = {};

    SCOPE.baseData.app_data = {"custom":true,"debug-sample-rate":1,"html-custom-data":{},"html-studio-properties":[{"page_load_timeout_sec":"4","hsp - type":"text"},{"polite_image_file":"","hsp - type":"text"},{"image_file":"https:\/\/s-static.innovid.com\/display\/uploads\/138124\/759692\/1665079257422\/s\/300x250\/StaticBackup_Template_2022_300x250.jpg","hsp - type":"text"},{"html_file":"","hsp - type":"text"},{"ad_width":"300","hsp - type":"text"},{"ad_height":"250","hsp - type":"text"}],"video":{"url":"","sourceURL":"https:\/\/s-static.innovid.com\/display\/uploads\/138124\/759692\/1665079257422\/s\/300x250\/StaticBackup_Template_2022_300x250.jpg","width":300,"height":250,"duration":0,"renditions":[]},"default-click-thru-label":"main","video-clicks":{"click-thru-url":"https:\/\/weeklyad.target.com\/?lnk=dNav_weeklyad&ref=tgt_adv_XC&afid=1271&cpng=138124&fndsrc=BCM_TGA&Adgroup=981127-Default"},"placement-config":{"hotspot-clicks":[{"id":"main","type":"click-thru","main":"https:\/\/weeklyad.target.com\/?lnk=dNav_weeklyad&ref=tgt_adv_XC&afid=1271&cpng=138124&fndsrc=BCM_TGA&Adgroup=981127-Default","tracking":[{"type":"url-tracking","data":"https:\/\/ad.doubleclick.net\/ddm\/trackclk\/N3550.287907INNOVID\/B27112423.326175643;dc_trk_aid=518516801;dc_trk_cid=165431691;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;ltd="}]},{"id":"main_click","type":"click-thru-custom","tracking":[{"type":"url-tracking","data":"https:\/\/ad.doubleclick.net\/ddm\/trackclk\/N3550.287907INNOVID\/B27112423.326175643;dc_trk_aid=518516801;dc_trk_cid=165431691;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;ltd="}]},{"id":"product_link_1","type":"click-thru-custom","tracking":[{"type":"url-tracking","data":"https:\/\/ad.doubleclick.net\/ddm\/trackclk\/N3550.287907INNOVID\/B27112423.326175643;dc_trk_aid=518516801;dc_trk_cid=165431691;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;ltd="}]},{"id":"product_link_2","type":"click-thru-custom","tracking":[{"type":"url-tracking","data":"https:\/\/ad.doubleclick.net\/ddm\/trackclk\/N3550.287907INNOVID\/B27112423.326175643;dc_trk_aid=518516801;dc_trk_cid=165431691;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;ltd="}]},{"id":"product_link_3","type":"click-thru-custom","tracking":[{"type":"url-tracking","data":"https:\/\/ad.doubleclick.net\/ddm\/trackclk\/N3550.287907INNOVID\/B27112423.326175643;dc_trk_aid=518516801;dc_trk_cid=165431691;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;ltd="}]},{"id":"product_link_4","type":"click-thru-custom","tracking":[{"type":"url-tracking","data":"https:\/\/ad.doubleclick.net\/ddm\/trackclk\/N3550.287907INNOVID\/B27112423.326175643;dc_trk_aid=518516801;dc_trk_cid=165431691;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;ltd="}]},{"id":"product_link_5","type":"click-thru-custom","tracking":[{"type":"url-tracking","data":"https:\/\/ad.doubleclick.net\/ddm\/trackclk\/N3550.287907INNOVID\/B27112423.326175643;dc_trk_aid=518516801;dc_trk_cid=165431691;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;ltd="}]}],"placement-hash":"15rbu6","project-hash":"1gr26n","client-id":3084,"channel-id":2719736,"publisher-id":1271,"advertiser-id":308,"placements-group-id":2731585,"campaign-id":138124,"video-id":981127,"placement-tag-id":0,"project-state":2,"child-manual-project-state":9,"child-auto-project-state":11,"real_estate_id":995233,"survey-data":null,"ivcexdata-enabled":true,"video-format":"display","tracking-events":{"playingStart":[{"type":"url-tracking","data":"https:\/\/ad.doubleclick.net\/ddm\/trackimp\/N3550.287907INNOVID\/B27112423.326175643;dc_trk_aid=518516801;dc_trk_cid=165431691;ord=[timestamp];dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;gdpr=${GDPR};gdpr_consent=${GDPR_CONSENT_755};ltd=?"},{"type":"url-tracking","data":"https:\/\/rtr.innovid.com\/placement\/15rbu6\/uuid?cb=[timestamp]"},{"type":"html-tracking","data":"<SCRIPT> var theDocument = window.parent.document; var scr = theDocument.createElement(\"SCRIPT\"); scr.type = \"text\/javascript\"; scr.src = \"https:\/\/cdn.doubleverify.com\/dvtp_src.js?ctx=21082388&cmp=138124&sid=1271&plc=2731585&num=&adid=&advid=&adsrv=118&btreg=iv-iroll&btadsrv=innovid&crt=981127&crtname=&chnl=&unit=&pid=&uid=&tagtype=&dvtagver=6.1.src\"; var currScr = (theDocument.currentScript || theDocument.scripts[document.scripts.length - 1]); var scrParent = currScr && currScr.parentNode; !scrParent || (typeof scrParent.nodeName === \"string\" && scrParent.nodeName.toUpperCase() === \"HEAD\") ? theDocument.body.appendChild(scr) : scrParent.appendChild(scr);<\/SCRIPT>"}]}},"error-monitoring-enabled":false,"service-config":{"dv":{"blocking":false,"clientId":21082388,"timeout":600,"useRealBlocking":true,"dvMacroIntegration":true,"dvQueryParams":""}}};
    SCOPE.baseData.config_data = {"iconSizes":[24,32,48,64,128],"previewParam":{"width":500,"height":281,"iconSize":32,"trayMargin":1.05},"platformScaling":{"mobile":1,"tablet":1,"desktop":1,"tv":2},"aspectRatio":1.3,"googleMapsApiKey":"AIzaSyAIvRFdH46ZxXWyLgE3_OjsL61tjxCDtS4","moat":{"disableFlash":0,"partnerCode":"innovidintvpaid2js125985325015"},"dv":{"url":"https:\/\/cdn.doubleverify.com\/dvvid_src.js?ctx=<%= ctx %>&cmp=<%= cmp %>&sid=<%= sid %>&crt=<%= crt %>&plc=<%= plc %>&adsrv=118&tagformat=2&tagtype=video&dvtagver=6.1.src&DVP_GVACB=<%= cb %>","blocking-url":"https:\/\/cdn.doubleverify.com\/dvbs_src.js?ctx=<%= ctx %>&cmp=<%= cmp %>&sid=<%= sid %>&crt=<%= crt %>&plc=<%= plc %>&adsrv=118&tagformat=2&tagtype=video&dvtagver=6.1.src&adid=<%= cb %>&DVP_DCB=<%= bcb %>"},"dv_with_creative_id_and_dsp":{"url":"https:\/\/cdn.doubleverify.com\/dvvid_src.js?ctx=<%= ctx %>&cmp=<%= cmp %>&sid=<%= sid %>&crt=<%= crt %>&plc=<%= plc %>&adsrv=118&tagformat=2&tagtype=video&dvtagver=6.1.src&DVP_GVACB=<%= cb %><%= dsp %>","blocking-url":"https:\/\/cdn.doubleverify.com\/dvbs_src.js?ctx=<%= ctx %>&cmp=<%= cmp %>&sid=<%= sid %>&crt=<%= crt %>&plc=<%= plc %>&adsrv=118&tagformat=2&tagtype=video&dvtagver=6.1.src&adid=<%= cb %>&DVP_DCB=<%= bcb %><%= dsp %>"},"comscore":{"partnerId":"Innovid"},"nielsen_dbe":{"survey_url":"https:\/\/secure-gl.imrworldwide.com\/u\/t\/{survey-id}\/video_tag.html?cr={iv_creativeid}&ce={iv_publisherid}-innovid&pc={iv_placementid}&wc=wc1&am=52&tt=5&view=300x300&show={show}&mode=s&width={player-width}&height={player-height}&bgcolor=000000&uuid={sessionid}"}};
    SCOPE.baseData.cssPath = 'https://s-static.innovid.com/mobileapps/s/js/default/15rbu6.css?cb=4.6.4271&secured=1';

    SCOPE.baseData.config_data.mode = 'js';
    SCOPE.baseData.targetElement = 'div#content';
    SCOPE.baseData.appPath = 'https://s-cdn.innovid.com/m/';
    SCOPE.baseData.servicePath = 'https://s-c-service.innovid.com';
    SCOPE.baseData.nonCdnServicePath = 'https://service.innovid.com';
    SCOPE.baseData.reportUrl = 'https://s.innovid.com/1x1.gif';
    SCOPE.baseData.errorReportUrl = 'https://s3.amazonaws.com/innovid-iroll-runtime/1x1.gif';
    SCOPE.baseData.runtimeConfigUrl = 'https://s-static.innovid.com/runtime/iroll-runtime-config.js';
    SCOPE.baseData.mobileCoreVersion = '4.6.4271';
    SCOPE.baseData.scriptUrl = 'https://s-static.innovid.com/mobileapps/s/js/default/15rbu6?cb=bfa2c984fef18f7f8400d96359ba3ce7&secured=1';
    SCOPE.baseData.dtsUrl = 'https://dts.innovid.com';

    SCOPE.baseData.featureBits = {"vpaid_clktru_handle_by_innovid_for_non_in_app":true,"feature.ac.studio_and_mobile.allow_vpaid_dynamic_video_placements":false};
    SCOPE.baseData.environment = "prod";

    return SCOPE;

})(IV || {});


/* Zepto v1.1.4 - zepto event ajax form ie - zeptojs.com/license */
var Zepto=function(){function L(t){return null==t?String(t):j[S.call(t)]||"object"}function Z(t){return"function"==L(t)}function $(t){return null!=t&&t==t.window}function _(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function D(t){return"object"==L(t)}function R(t){return D(t)&&!$(t)&&Object.getPrototypeOf(t)==Object.prototype}function M(t){return"number"==typeof t.length}function k(t){return s.call(t,function(t){return null!=t})}function z(t){return t.length>0?n.fn.concat.apply([],t):t}function F(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function q(t){return t in f?f[t]:f[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function H(t,e){return"number"!=typeof e||c[F(t)]?e:e+"px"}function I(t){var e,n;return u[t]||(e=a.createElement(t),a.body.appendChild(e),n=getComputedStyle(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),"none"==n&&(n="block"),u[t]=n),u[t]}function V(t){return"children"in t?o.call(t.children):n.map(t.childNodes,function(t){return 1==t.nodeType?t:void 0})}function B(n,i,r){for(e in i)r&&(R(i[e])||A(i[e]))?(R(i[e])&&!R(n[e])&&(n[e]={}),A(i[e])&&!A(n[e])&&(n[e]=[]),B(n[e],i[e],r)):i[e]!==t&&(n[e]=i[e])}function U(t,e){return null==e?n(t):n(t).filter(e)}function J(t,e,n,i){return Z(e)?e.call(t,n,i):e}function X(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function W(e,n){var i=e.className,r=i&&i.baseVal!==t;return n===t?r?i.baseVal:i:void(r?i.baseVal=n:e.className=n)}function Y(t){var e;try{return t?"true"==t||("false"==t?!1:"null"==t?null:/^0/.test(t)||isNaN(e=Number(t))?/^[\[\{]/.test(t)?n.parseJSON(t):t:e):t}catch(i){return t}}function G(t,e){e(t);for(var n=0,i=t.childNodes.length;i>n;n++)G(t.childNodes[n],e)}var t,e,n,i,C,N,r=[],o=r.slice,s=r.filter,a=window.document,u={},f={},c={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},l=/^\s*<(\w+|!)[^>]*>/,h=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,p=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,d=/^(?:body|html)$/i,m=/([A-Z])/g,g=["val","css","html","text","data","width","height","offset"],v=["after","prepend","before","append"],y=a.createElement("table"),x=a.createElement("tr"),b={tr:a.createElement("tbody"),tbody:y,thead:y,tfoot:y,td:x,th:x,"*":a.createElement("div")},w=/complete|loaded|interactive/,E=/^[\w-]*$/,j={},S=j.toString,T={},O=a.createElement("div"),P={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},A=Array.isArray||function(t){return t instanceof Array};return T.matches=function(t,e){if(!e||!t||1!==t.nodeType)return!1;var n=t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(n)return n.call(t,e);var i,r=t.parentNode,o=!r;return o&&(r=O).appendChild(t),i=~T.qsa(r,e).indexOf(t),o&&O.removeChild(t),i},C=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},N=function(t){return s.call(t,function(e,n){return t.indexOf(e)==n})},T.fragment=function(e,i,r){var s,u,f;return h.test(e)&&(s=n(a.createElement(RegExp.$1))),s||(e.replace&&(e=e.replace(p,"<$1></$2>")),i===t&&(i=l.test(e)&&RegExp.$1),i in b||(i="*"),f=b[i],f.innerHTML=""+e,s=n.each(o.call(f.childNodes),function(){f.removeChild(this)})),R(r)&&(u=n(s),n.each(r,function(t,e){g.indexOf(t)>-1?u[t](e):u.attr(t,e)})),s},T.Z=function(t,e){return t=t||[],t.__proto__=n.fn,t.selector=e||"",t},T.isZ=function(t){return t instanceof T.Z},T.init=function(e,i){var r;if(!e)return T.Z();if("string"==typeof e)if(e=e.trim(),"<"==e[0]&&l.test(e))r=T.fragment(e,RegExp.$1,i),e=null;else{if(i!==t)return n(i).find(e);r=T.qsa(a,e)}else{if(Z(e))return n(a).ready(e);if(T.isZ(e))return e;if(A(e))r=k(e);else if(D(e))r=[e],e=null;else if(l.test(e))r=T.fragment(e.trim(),RegExp.$1,i),e=null;else{if(i!==t)return n(i).find(e);r=T.qsa(a,e)}}return T.Z(r,e)},n=function(t,e){return T.init(t,e)},n.extend=function(t){var e,n=o.call(arguments,1);return"boolean"==typeof t&&(e=t,t=n.shift()),n.forEach(function(n){B(t,n,e)}),t},T.qsa=function(t,e){var n,i="#"==e[0],r=!i&&"."==e[0],s=i||r?e.slice(1):e,a=E.test(s);return _(t)&&a&&i?(n=t.getElementById(s))?[n]:[]:1!==t.nodeType&&9!==t.nodeType?[]:o.call(a&&!i?r?t.getElementsByClassName(s):t.getElementsByTagName(e):t.querySelectorAll(e))},n.contains=a.documentElement.contains?function(t,e){return t!==e&&t.contains(e)}:function(t,e){for(;e&&(e=e.parentNode);)if(e===t)return!0;return!1},n.type=L,n.isFunction=Z,n.isWindow=$,n.isArray=A,n.isPlainObject=R,n.isEmptyObject=function(t){var e;for(e in t)return!1;return!0},n.inArray=function(t,e,n){return r.indexOf.call(e,t,n)},n.camelCase=C,n.trim=function(t){return null==t?"":String.prototype.trim.call(t)},n.uuid=0,n.support={},n.expr={},n.map=function(t,e){var n,r,o,i=[];if(M(t))for(r=0;r<t.length;r++)n=e(t[r],r),null!=n&&i.push(n);else for(o in t)n=e(t[o],o),null!=n&&i.push(n);return z(i)},n.each=function(t,e){var n,i;if(M(t)){for(n=0;n<t.length;n++)if(e.call(t[n],n,t[n])===!1)return t}else for(i in t)if(e.call(t[i],i,t[i])===!1)return t;return t},n.grep=function(t,e){return s.call(t,e)},window.JSON&&(n.parseJSON=JSON.parse),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){j["[object "+e+"]"]=e.toLowerCase()}),n.fn={forEach:r.forEach,reduce:r.reduce,push:r.push,sort:r.sort,indexOf:r.indexOf,concat:r.concat,map:function(t){return n(n.map(this,function(e,n){return t.call(e,n,e)}))},slice:function(){return n(o.apply(this,arguments))},ready:function(t){return w.test(a.readyState)&&a.body?t(n):a.addEventListener("DOMContentLoaded",function(){t(n)},!1),this},get:function(e){return e===t?o.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(t){return r.every.call(this,function(e,n){return t.call(e,n,e)!==!1}),this},filter:function(t){return Z(t)?this.not(this.not(t)):n(s.call(this,function(e){return T.matches(e,t)}))},add:function(t,e){return n(N(this.concat(n(t,e))))},is:function(t){return this.length>0&&T.matches(this[0],t)},not:function(e){var i=[];if(Z(e)&&e.call!==t)this.each(function(t){e.call(this,t)||i.push(this)});else{var r="string"==typeof e?this.filter(e):M(e)&&Z(e.item)?o.call(e):n(e);this.forEach(function(t){r.indexOf(t)<0&&i.push(t)})}return n(i)},has:function(t){return this.filter(function(){return D(t)?n.contains(this,t):n(this).find(t).size()})},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!D(t)?t:n(t)},last:function(){var t=this[this.length-1];return t&&!D(t)?t:n(t)},find:function(t){var e,i=this;return e=t?"object"==typeof t?n(t).filter(function(){var t=this;return r.some.call(i,function(e){return n.contains(e,t)})}):1==this.length?n(T.qsa(this[0],t)):this.map(function(){return T.qsa(this,t)}):[]},closest:function(t,e){var i=this[0],r=!1;for("object"==typeof t&&(r=n(t));i&&!(r?r.indexOf(i)>=0:T.matches(i,t));)i=i!==e&&!_(i)&&i.parentNode;return n(i)},parents:function(t){for(var e=[],i=this;i.length>0;)i=n.map(i,function(t){return(t=t.parentNode)&&!_(t)&&e.indexOf(t)<0?(e.push(t),t):void 0});return U(e,t)},parent:function(t){return U(N(this.pluck("parentNode")),t)},children:function(t){return U(this.map(function(){return V(this)}),t)},contents:function(){return this.map(function(){return o.call(this.childNodes)})},siblings:function(t){return U(this.map(function(t,e){return s.call(V(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(t){return n.map(this,function(e){return e[t]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==(getComputedStyle(this,"") ? getComputedStyle(this,"").getPropertyValue("display") : "")&&(this.style.display=I(this.nodeName))})},replaceWith:function(t){return this.before(t).remove()},wrap:function(t){var e=Z(t);if(this[0]&&!e)var i=n(t).get(0),r=i.parentNode||this.length>1;return this.each(function(o){n(this).wrapAll(e?t.call(this,o):r?i.cloneNode(!0):i)})},wrapAll:function(t){if(this[0]){n(this[0]).before(t=n(t));for(var e;(e=t.children()).length;)t=e.first();n(t).append(this)}return this},wrapInner:function(t){var e=Z(t);return this.each(function(i){var r=n(this),o=r.contents(),s=e?t.call(this,i):t;o.length?o.wrapAll(s):r.append(s)})},unwrap:function(){return this.parent().each(function(){n(this).replaceWith(n(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var i=n(this);(e===t?"none"==i.css("display"):e)?i.show():i.hide()})},prev:function(t){return n(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return n(this.pluck("nextElementSibling")).filter(t||"*")},html:function(t){return 0 in arguments?this.each(function(e){var i=this.innerHTML;n(this).empty().append(J(this,t,e,i))}):0 in this?this[0].innerHTML:null},text:function(t){return 0 in arguments?this.each(function(e){var n=J(this,t,e,this.textContent);this.textContent=null==n?"":""+n}):0 in this?this[0].textContent:null},attr:function(n,i){var r;return"string"!=typeof n||1 in arguments?this.each(function(t){if(1===this.nodeType)if(D(n))for(e in n)X(this,e,n[e]);else X(this,n,J(this,i,t,this.getAttribute(n)))}):this.length&&1===this[0].nodeType?!(r=this[0].getAttribute(n))&&n in this[0]?this[0][n]:r:t},removeAttr:function(t){return this.each(function(){1===this.nodeType&&X(this,t)})},prop:function(t,e){return t=P[t]||t,1 in arguments?this.each(function(n){this[t]=J(this,e,n,this[t])}):this[0]&&this[0][t]},data:function(e,n){var i="data-"+e.replace(m,"-$1").toLowerCase(),r=1 in arguments?this.attr(i,n):this.attr(i);return null!==r?Y(r):t},val:function(t){return 0 in arguments?this.each(function(e){this.value=J(this,t,e,this.value)}):this[0]&&(this[0].multiple?n(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(t){if(t)return this.each(function(e){var i=n(this),r=J(this,t,e,i.offset()),o=i.offsetParent().offset(),s={top:r.top-o.top,left:r.left-o.left};"static"==i.css("position")&&(s.position="relative"),i.css(s)});if(!this.length)return null;var e;try {e=this[0].getBoundingClientRect()}catch(ex){e={left:0,top:0,width:0,height:0}};return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},css:function(t,i){if(arguments.length<2){var r=this[0],o=getComputedStyle(r,"");if(!r)return;if("string"==typeof t)return r.style[C(t)]||o.getPropertyValue(t);if(A(t)){var s={};return n.each(A(t)?t:[t],function(t,e){s[e]=r.style[C(e)]||o.getPropertyValue(e)}),s}}var a="";if("string"==L(t))i||0===i?a=F(t)+":"+H(t,i):this.each(function(){this.style.removeProperty(F(t))});else for(e in t)t[e]||0===t[e]?a+=F(e)+":"+H(e,t[e])+";":this.each(function(){this.style.removeProperty(F(e))});return this.each(function(){this.style.cssText+=";"+a})},index:function(t){return t?this.indexOf(n(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){return t?r.some.call(this,function(t){return this.test(W(t))},q(t)):!1},addClass:function(t){return t?this.each(function(e){i=[];var r=W(this),o=J(this,t,e,r);o.split(/\s+/g).forEach(function(t){n(this).hasClass(t)||i.push(t)},this),i.length&&W(this,r+(r?" ":"")+i.join(" "))}):this},removeClass:function(e){return this.each(function(n){return e===t?W(this,""):(i=W(this),J(this,e,n,i).split(/\s+/g).forEach(function(t){i=i.replace(q(t)," ")}),void W(this,i.trim()))})},toggleClass:function(e,i){return e?this.each(function(r){var o=n(this),s=J(this,e,r,W(this));s.split(/\s+/g).forEach(function(e){(i===t?!o.hasClass(e):i)?o.addClass(e):o.removeClass(e)})}):this},scrollTop:function(e){if(this.length){var n="scrollTop"in this[0];return e===t?n?this[0].scrollTop:this[0].pageYOffset:this.each(n?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})}},scrollLeft:function(e){if(this.length){var n="scrollLeft"in this[0];return e===t?n?this[0].scrollLeft:this[0].pageXOffset:this.each(n?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})}},position:function(){if(this.length){var t=this[0],e=this.offsetParent(),i=this.offset(),r=d.test(e[0].nodeName)?{top:0,left:0}:e.offset();return i.top-=parseFloat(n(t).css("margin-top"))||0,i.left-=parseFloat(n(t).css("margin-left"))||0,r.top+=parseFloat(n(e[0]).css("border-top-width"))||0,r.left+=parseFloat(n(e[0]).css("border-left-width"))||0,{top:i.top-r.top,left:i.left-r.left}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||a.body;t&&!d.test(t.nodeName)&&"static"==n(t).css("position");)t=t.offsetParent;return t})}},n.fn.detach=n.fn.remove,["width","height"].forEach(function(e){var i=e.replace(/./,function(t){return t[0].toUpperCase()});n.fn[e]=function(r){var o,s=this[0];return r===t?$(s)?s["inner"+i]:_(s)?s.documentElement["scroll"+i]:(o=this.offset())&&o[e]:this.each(function(t){s=n(this),s.css(e,J(this,r,t,s[e]()))})}}),v.forEach(function(t,e){var i=e%2;n.fn[t]=function(){var t,o,r=n.map(arguments,function(e){return t=L(e),"object"==t||"array"==t||null==e?e:T.fragment(e)}),s=this.length>1;return r.length<1?this:this.each(function(t,u){o=i?u:u.parentNode,u=0==e?u.nextSibling:1==e?u.firstChild:2==e?u:null;var f=n.contains(a.documentElement,o);r.forEach(function(t){if(s)t=t.cloneNode(!0);else if(!o)return n(t).remove();o.insertBefore(t,u),f&&G(t,function(t){null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src||window.eval.call(window,t.innerHTML)})})})},n.fn[i?t+"To":"insert"+(e?"Before":"After")]=function(e){return n(e)[t](this),this}}),T.Z.prototype=n.fn,T.uniq=N,T.deserializeValue=Y,n.zepto=T,n}();window.Zepto=Zepto,void 0===window.$&&(window.$=Zepto),function(t){function l(t){return t._zid||(t._zid=e++)}function h(t,e,n,i){if(e=p(e),e.ns)var r=d(e.ns);return(s[l(t)]||[]).filter(function(t){return!(!t||e.e&&t.e!=e.e||e.ns&&!r.test(t.ns)||n&&l(t.fn)!==l(n)||i&&t.sel!=i)})}function p(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function d(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function m(t,e){return t.del&&!u&&t.e in f||!!e}function g(t){return c[t]||u&&f[t]||t}function v(e,i,r,o,a,u,f){var h=l(e),d=s[h]||(s[h]=[]);i.split(/\s/).forEach(function(i){if("ready"==i)return t(document).ready(r);var s=p(i);s.fn=r,s.sel=a,s.e in c&&(r=function(e){var n=e.relatedTarget;return!n||n!==this&&!t.contains(this,n)?s.fn.apply(this,arguments):void 0}),s.del=u;var l=u||r;s.proxy=function(t){if(t=j(t),!t.isImmediatePropagationStopped()){t.data=o;var i=l.apply(e,t._args==n?[t]:[t].concat(t._args));return i===!1&&(t.preventDefault(),t.stopPropagation()),i}},s.i=d.length,d.push(s),"addEventListener"in e&&e.addEventListener(g(s.e),s.proxy,m(s,f))})}function y(t,e,n,i,r){var o=l(t);(e||"").split(/\s/).forEach(function(e){h(t,e,n,i).forEach(function(e){delete s[o][e.i],"removeEventListener"in t&&t.removeEventListener(g(e.e),e.proxy,m(e,r))})})}function j(e,i){return(i||!e.isDefaultPrevented)&&(i||(i=e),t.each(E,function(t,n){var r=i[t];e[t]=function(){return this[n]=x,r&&r.apply(i,arguments)},e[n]=b}),(i.defaultPrevented!==n?i.defaultPrevented:"returnValue"in i?i.returnValue===!1:i.getPreventDefault&&i.getPreventDefault())&&(e.isDefaultPrevented=x)),e}function S(t){var e,i={originalEvent:t};for(e in t)w.test(e)||t[e]===n||(i[e]=t[e]);return j(i,t)}var n,e=1,i=Array.prototype.slice,r=t.isFunction,o=function(t){return"string"==typeof t},s={},a={},u="onfocusin"in window,f={focus:"focusin",blur:"focusout"},c={mouseenter:"mouseover",mouseleave:"mouseout"};a.click=a.mousedown=a.mouseup=a.mousemove="MouseEvents",t.event={add:v,remove:y},t.proxy=function(e,n){var s=2 in arguments&&i.call(arguments,2);if(r(e)){var a=function(){return e.apply(n,s?s.concat(i.call(arguments)):arguments)};return a._zid=l(e),a}if(o(n))return s?(s.unshift(e[n],e),t.proxy.apply(null,s)):t.proxy(e[n],e);throw new TypeError("expected function")},t.fn.bind=function(t,e,n){return this.on(t,e,n)},t.fn.unbind=function(t,e){return this.off(t,e)},t.fn.one=function(t,e,n,i){return this.on(t,e,n,i,1)};var x=function(){return!0},b=function(){return!1},w=/^([A-Z]|returnValue$|layer[XY]$)/,E={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};t.fn.delegate=function(t,e,n){return this.on(e,t,n)},t.fn.undelegate=function(t,e,n){return this.off(e,t,n)},t.fn.live=function(e,n){return t(document.body).delegate(this.selector,e,n),this},t.fn.die=function(e,n){return t(document.body).undelegate(this.selector,e,n),this},t.fn.on=function(e,s,a,u,f){var c,l,h=this;return e&&!o(e)?(t.each(e,function(t,e){h.on(t,s,a,e,f)}),h):(o(s)||r(u)||u===!1||(u=a,a=s,s=n),(r(a)||a===!1)&&(u=a,a=n),u===!1&&(u=b),h.each(function(n,r){f&&(c=function(t){return y(r,t.type,u),u.apply(this,arguments)}),s&&(l=function(e){var n,o=t(e.target).closest(s,r).get(0);return o&&o!==r?(n=t.extend(S(e),{currentTarget:o,liveFired:r}),(c||u).apply(o,[n].concat(i.call(arguments,1)))):void 0}),v(r,e,u,a,s,l||c)}))},t.fn.off=function(e,i,s){var a=this;return e&&!o(e)?(t.each(e,function(t,e){a.off(t,i,e)}),a):(o(i)||r(s)||s===!1||(s=i,i=n),s===!1&&(s=b),a.each(function(){y(this,e,s,i)}))},t.fn.trigger=function(e,n){return e=o(e)||t.isPlainObject(e)?t.Event(e):j(e),e._args=n,this.each(function(){"dispatchEvent"in this?this.dispatchEvent(e):t(this).triggerHandler(e,n)})},t.fn.triggerHandler=function(e,n){var i,r;return this.each(function(s,a){i=S(o(e)?t.Event(e):e),i._args=n,i.target=a,t.each(h(a,e.type||e),function(t,e){return r=e.proxy(i),i.isImmediatePropagationStopped()?!1:void 0})}),r},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(e){t.fn[e]=function(t){return t?this.bind(e,t):this.trigger(e)}}),["focus","blur"].forEach(function(e){t.fn[e]=function(t){return t?this.bind(e,t):this.each(function(){try{this[e]()}catch(t){}}),this}}),t.Event=function(t,e){o(t)||(e=t,t=e.type);var n=document.createEvent(a[t]||"Events"),i=!0;if(e)for(var r in e)"bubbles"==r?i=!!e[r]:n[r]=e[r];return n.initEvent(t,i,!0),j(n)}}(Zepto),function(t){function l(e,n,i){var r=t.Event(n);return t(e).trigger(r,i),!r.isDefaultPrevented()}function h(t,e,i,r){return t.global?l(e||n,i,r):void 0}function p(e){e.global&&0===t.active++&&h(e,null,"ajaxStart")}function d(e){e.global&&!--t.active&&h(e,null,"ajaxStop")}function m(t,e){var n=e.context;return e.beforeSend.call(n,t,e)===!1||h(e,n,"ajaxBeforeSend",[t,e])===!1?!1:void h(e,n,"ajaxSend",[t,e])}function g(t,e,n,i){var r=n.context,o="success";n.success.call(r,t,o,e),i&&i.resolveWith(r,[t,o,e]),h(n,r,"ajaxSuccess",[e,n,t]),y(o,e,n)}function v(t,e,n,i,r){var o=i.context;i.error.call(o,n,e,t),r&&r.rejectWith(o,[n,e,t]),h(i,o,"ajaxError",[n,i,t||e]),y(e,n,i)}function y(t,e,n){var i=n.context;n.complete.call(i,e,t),h(n,i,"ajaxComplete",[e,n]),d(n)}function x(){}function b(t){return t&&(t=t.split(";",2)[0]),t&&(t==f?"html":t==u?"json":s.test(t)?"script":a.test(t)&&"xml")||"text"}function w(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function E(e){e.processData&&e.data&&"string"!=t.type(e.data)&&(e.data=t.param(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=w(e.url,e.data),e.data=void 0)}function j(e,n,i,r){return t.isFunction(n)&&(r=i,i=n,n=void 0),t.isFunction(i)||(r=i,i=void 0),{url:e,data:n,success:i,dataType:r}}function T(e,n,i,r){var o,s=t.isArray(n),a=t.isPlainObject(n);t.each(n,function(n,u){o=t.type(u),r&&(n=i?r:r+"["+(a||"object"==o||"array"==o?n:"")+"]"),!r&&s?e.add(u.name,u.value):"array"==o||!i&&"object"==o?T(e,u,i,n):e.add(n,u)})}var i,r,e=0,n=window.document,o=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,s=/^(?:text|application)\/javascript/i,a=/^(?:text|application)\/xml/i,u="application/json",f="text/html",c=/^\s*$/;t.active=0,t.ajaxJSONP=function(i,r){if(!("type"in i))return t.ajax(i);var f,h,o=i.jsonpCallback,s=(t.isFunction(o)?o():o)||"jsonp"+ ++e,a=n.createElement("script"),u=window[s],c=function(e){t(a).triggerHandler("error",e||"abort")},l={abort:c};return r&&r.promise(l),t(a).on("load error",function(e,n){clearTimeout(h),t(a).off().remove(),"error"!=e.type&&f?g(f[0],l,i,r):v(null,n||"error",l,i,r),window[s]=u,f&&t.isFunction(u)&&u(f[0]),u=f=void 0}),m(l,i)===!1?(c("abort"),l):(window[s]=function(){f=arguments},a.src=i.url.replace(/\?(.+)=\?/,"?$1="+s),n.head.appendChild(a),i.timeout>0&&(h=setTimeout(function(){c("timeout")},i.timeout)),l)},t.ajaxSettings={type:"GET",beforeSend:x,success:x,error:x,complete:x,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:u,xml:"application/xml, text/xml",html:f,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},t.ajax=function(e){var n=t.extend({},e||{}),o=t.Deferred&&t.Deferred();for(i in t.ajaxSettings)void 0===n[i]&&(n[i]=t.ajaxSettings[i]);p(n),n.crossDomain||(n.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(n.url)&&RegExp.$2!=window.location.host),n.url||(n.url=window.location.toString()),E(n);var s=n.dataType,a=/\?.+=\?/.test(n.url);if(a&&(s="jsonp"),n.cache!==!1&&(e&&e.cache===!0||"script"!=s&&"jsonp"!=s)||(n.url=w(n.url,"_="+Date.now())),"jsonp"==s)return a||(n.url=w(n.url,n.jsonp?n.jsonp+"=?":n.jsonp===!1?"":"callback=?")),t.ajaxJSONP(n,o);var j,u=n.accepts[s],f={},l=function(t,e){f[t.toLowerCase()]=[t,e]},h=/^([\w-]+:)\/\//.test(n.url)?RegExp.$1:window.location.protocol,d=n.xhr(),y=d.setRequestHeader;if(o&&o.promise(d),n.crossDomain||l("X-Requested-With","XMLHttpRequest"),l("Accept",u||"*/*"),(u=n.mimeType||u)&&(u.indexOf(",")>-1&&(u=u.split(",",2)[0]),d.overrideMimeType&&d.overrideMimeType(u)),(n.contentType||n.contentType!==!1&&n.data&&"GET"!=n.type.toUpperCase())&&l("Content-Type",n.contentType||"application/x-www-form-urlencoded"),n.headers)for(r in n.headers)l(r,n.headers[r]);if(d.setRequestHeader=l,d.onreadystatechange=function(){if(4==d.readyState){d.onreadystatechange=x,clearTimeout(j);var e,i=!1;if(d.status>=200&&d.status<300||304==d.status||0==d.status&&"file:"==h){s=s||b(n.mimeType||d.getResponseHeader("content-type")),e=d.responseText;try{"script"==s?(1,eval)(e):"xml"==s?e=d.responseXML:"json"==s&&(e=c.test(e)?null:t.parseJSON(e))}catch(r){i=r}i?v(i,"parsererror",d,n,o):g(e,d,n,o)}else v(d.statusText||null,d.status?"error":"abort",d,n,o)}},m(d,n)===!1)return d.abort(),v(null,"abort",d,n,o),d;if(n.xhrFields)for(r in n.xhrFields)d[r]=n.xhrFields[r];var S="async"in n?n.async:!0;d.open(n.type,n.url,S,n.username,n.password);for(r in f)y.apply(d,f[r]);return n.timeout>0&&(j=setTimeout(function(){d.onreadystatechange=x,d.abort(),v(null,"timeout",d,n,o)},n.timeout)),d.send(n.data?n.data:null),d},t.get=function(){return t.ajax(j.apply(null,arguments))},t.post=function(){var e=j.apply(null,arguments);return e.type="POST",t.ajax(e)},t.getJSON=function(){var e=j.apply(null,arguments);return e.dataType="json",t.ajax(e)},t.fn.load=function(e,n,i){if(!this.length)return this;var a,r=this,s=e.split(/\s/),u=j(e,n,i),f=u.success;return s.length>1&&(u.url=s[0],a=s[1]),u.success=function(e){r.html(a?t("<div>").html(e.replace(o,"")).find(a):e),f&&f.apply(r,arguments)},t.ajax(u),this};var S=encodeURIComponent;t.param=function(t,e){var n=[];return n.add=function(t,e){this.push(S(t)+"="+S(e))},T(n,t,e),n.join("&").replace(/%20/g,"+")}}(Zepto),function(t){t.fn.serializeArray=function(){var n,e=[];return t([].slice.call(this.get(0).elements)).each(function(){n=t(this);var i=n.attr("type");"fieldset"!=this.nodeName.toLowerCase()&&!this.disabled&&"submit"!=i&&"reset"!=i&&"button"!=i&&("radio"!=i&&"checkbox"!=i||this.checked)&&e.push({name:n.attr("name"),value:n.val()})}),e},t.fn.serialize=function(){var t=[];return this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")},t.fn.submit=function(e){if(e)this.bind("submit",e);else if(this.length){var n=t.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),function(t){"__proto__"in{}||t.extend(t.zepto,{Z:function(e,n){return e=e||[],t.extend(e,t.fn),e.selector=n||"",e.__Z=!0,e},isZ:function(e){return"array"===t.type(e)&&"__Z"in e}});try{getComputedStyle(void 0)}catch(e){var n=getComputedStyle;window.getComputedStyle=function(t){try{return n(t)}catch(e){return null}}}}(Zepto);

//     Underscore.js 1.7.0
//     http://underscorejs.org
//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.
(function(){var n=this,t=n._,r=Array.prototype,e=Object.prototype,u=Function.prototype,i=r.push,a=r.slice,o=r.concat,l=e.toString,c=e.hasOwnProperty,f=Array.isArray,s=Object.keys,p=u.bind,h=function(n){return n instanceof h?n:this instanceof h?void(this._wrapped=n):new h(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports._=h):n._=h,h.VERSION="1.7.0";var g=function(n,t,r){if(t===void 0)return n;switch(null==r?3:r){case 1:return function(r){return n.call(t,r)};case 2:return function(r,e){return n.call(t,r,e)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,i){return n.call(t,r,e,u,i)}}return function(){return n.apply(t,arguments)}};h.iteratee=function(n,t,r){return null==n?h.identity:h.isFunction(n)?g(n,t,r):h.isObject(n)?h.matches(n):h.property(n)},h.each=h.forEach=function(n,t,r){if(null==n)return n;t=g(t,r);var e,u=n.length;if(u===+u)for(e=0;u>e;e++)t(n[e],e,n);else{var i=h.keys(n);for(e=0,u=i.length;u>e;e++)t(n[i[e]],i[e],n)}return n},h.map=h.collect=function(n,t,r){if(null==n)return[];t=h.iteratee(t,r);for(var e,u=n.length!==+n.length&&h.keys(n),i=(u||n).length,a=Array(i),o=0;i>o;o++)e=u?u[o]:o,a[o]=t(n[e],e,n);return a};var v="Reduce of empty array with no initial value";h.reduce=h.foldl=h.inject=function(n,t,r,e){null==n&&(n=[]),t=g(t,e,4);var u,i=n.length!==+n.length&&h.keys(n),a=(i||n).length,o=0;if(arguments.length<3){if(!a)throw new TypeError(v);r=n[i?i[o++]:o++]}for(;a>o;o++)u=i?i[o]:o,r=t(r,n[u],u,n);return r},h.reduceRight=h.foldr=function(n,t,r,e){null==n&&(n=[]),t=g(t,e,4);var u,i=n.length!==+n.length&&h.keys(n),a=(i||n).length;if(arguments.length<3){if(!a)throw new TypeError(v);r=n[i?i[--a]:--a]}for(;a--;)u=i?i[a]:a,r=t(r,n[u],u,n);return r},h.find=h.detect=function(n,t,r){var e;return t=h.iteratee(t,r),h.some(n,function(n,r,u){return t(n,r,u)?(e=n,!0):void 0}),e},h.filter=h.select=function(n,t,r){var e=[];return null==n?e:(t=h.iteratee(t,r),h.each(n,function(n,r,u){t(n,r,u)&&e.push(n)}),e)},h.reject=function(n,t,r){return h.filter(n,h.negate(h.iteratee(t)),r)},h.every=h.all=function(n,t,r){if(null==n)return!0;t=h.iteratee(t,r);var e,u,i=n.length!==+n.length&&h.keys(n),a=(i||n).length;for(e=0;a>e;e++)if(u=i?i[e]:e,!t(n[u],u,n))return!1;return!0},h.some=h.any=function(n,t,r){if(null==n)return!1;t=h.iteratee(t,r);var e,u,i=n.length!==+n.length&&h.keys(n),a=(i||n).length;for(e=0;a>e;e++)if(u=i?i[e]:e,t(n[u],u,n))return!0;return!1},h.contains=h.include=function(n,t){return null==n?!1:(n.length!==+n.length&&(n=h.values(n)),h.indexOf(n,t)>=0)},h.invoke=function(n,t){var r=a.call(arguments,2),e=h.isFunction(t);return h.map(n,function(n){return(e?t:n[t]).apply(n,r)})},h.pluck=function(n,t){return h.map(n,h.property(t))},h.where=function(n,t){return h.filter(n,h.matches(t))},h.findWhere=function(n,t){return h.find(n,h.matches(t))},h.max=function(n,t,r){var e,u,i=-1/0,a=-1/0;if(null==t&&null!=n){n=n.length===+n.length?n:h.values(n);for(var o=0,l=n.length;l>o;o++)e=n[o],e>i&&(i=e)}else t=h.iteratee(t,r),h.each(n,function(n,r,e){u=t(n,r,e),(u>a||u===-1/0&&i===-1/0)&&(i=n,a=u)});return i},h.min=function(n,t,r){var e,u,i=1/0,a=1/0;if(null==t&&null!=n){n=n.length===+n.length?n:h.values(n);for(var o=0,l=n.length;l>o;o++)e=n[o],i>e&&(i=e)}else t=h.iteratee(t,r),h.each(n,function(n,r,e){u=t(n,r,e),(a>u||1/0===u&&1/0===i)&&(i=n,a=u)});return i},h.shuffle=function(n){for(var t,r=n&&n.length===+n.length?n:h.values(n),e=r.length,u=Array(e),i=0;e>i;i++)t=h.random(0,i),t!==i&&(u[i]=u[t]),u[t]=r[i];return u},h.sample=function(n,t,r){return null==t||r?(n.length!==+n.length&&(n=h.values(n)),n[h.random(n.length-1)]):h.shuffle(n).slice(0,Math.max(0,t))},h.sortBy=function(n,t,r){return t=h.iteratee(t,r),h.pluck(h.map(n,function(n,r,e){return{value:n,index:r,criteria:t(n,r,e)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index-t.index}),"value")};var m=function(n){return function(t,r,e){var u={};return r=h.iteratee(r,e),h.each(t,function(e,i){var a=r(e,i,t);n(u,e,a)}),u}};h.groupBy=m(function(n,t,r){h.has(n,r)?n[r].push(t):n[r]=[t]}),h.indexBy=m(function(n,t,r){n[r]=t}),h.countBy=m(function(n,t,r){h.has(n,r)?n[r]++:n[r]=1}),h.sortedIndex=function(n,t,r,e){r=h.iteratee(r,e,1);for(var u=r(t),i=0,a=n.length;a>i;){var o=i+a>>>1;r(n[o])<u?i=o+1:a=o}return i},h.toArray=function(n){return n?h.isArray(n)?a.call(n):n.length===+n.length?h.map(n,h.identity):h.values(n):[]},h.size=function(n){return null==n?0:n.length===+n.length?n.length:h.keys(n).length},h.partition=function(n,t,r){t=h.iteratee(t,r);var e=[],u=[];return h.each(n,function(n,r,i){(t(n,r,i)?e:u).push(n)}),[e,u]},h.first=h.head=h.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:0>t?[]:a.call(n,0,t)},h.initial=function(n,t,r){return a.call(n,0,Math.max(0,n.length-(null==t||r?1:t)))},h.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:a.call(n,Math.max(n.length-t,0))},h.rest=h.tail=h.drop=function(n,t,r){return a.call(n,null==t||r?1:t)},h.compact=function(n){return h.filter(n,h.identity)};var y=function(n,t,r,e){if(t&&h.every(n,h.isArray))return o.apply(e,n);for(var u=0,a=n.length;a>u;u++){var l=n[u];h.isArray(l)||h.isArguments(l)?t?i.apply(e,l):y(l,t,r,e):r||e.push(l)}return e};h.flatten=function(n,t){return y(n,t,!1,[])},h.without=function(n){return h.difference(n,a.call(arguments,1))},h.uniq=h.unique=function(n,t,r,e){if(null==n)return[];h.isBoolean(t)||(e=r,r=t,t=!1),null!=r&&(r=h.iteratee(r,e));for(var u=[],i=[],a=0,o=n.length;o>a;a++){var l=n[a];if(t)a&&i===l||u.push(l),i=l;else if(r){var c=r(l,a,n);h.indexOf(i,c)<0&&(i.push(c),u.push(l))}else h.indexOf(u,l)<0&&u.push(l)}return u},h.union=function(){return h.uniq(y(arguments,!0,!0,[]))},h.intersection=function(n){if(null==n)return[];for(var t=[],r=arguments.length,e=0,u=n.length;u>e;e++){var i=n[e];if(!h.contains(t,i)){for(var a=1;r>a&&h.contains(arguments[a],i);a++);a===r&&t.push(i)}}return t},h.difference=function(n){var t=y(a.call(arguments,1),!0,!0,[]);return h.filter(n,function(n){return!h.contains(t,n)})},h.zip=function(n){if(null==n)return[];for(var t=h.max(arguments,"length").length,r=Array(t),e=0;t>e;e++)r[e]=h.pluck(arguments,e);return r},h.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},h.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=h.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}for(;u>e;e++)if(n[e]===t)return e;return-1},h.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=n.length;for("number"==typeof r&&(e=0>r?e+r+1:Math.min(e,r+1));--e>=0;)if(n[e]===t)return e;return-1},h.range=function(n,t,r){arguments.length<=1&&(t=n||0,n=0),r=r||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=Array(e),i=0;e>i;i++,n+=r)u[i]=n;return u};var d=function(){};h.bind=function(n,t){var r,e;if(p&&n.bind===p)return p.apply(n,a.call(arguments,1));if(!h.isFunction(n))throw new TypeError("Bind must be called on a function");return r=a.call(arguments,2),e=function(){if(!(this instanceof e))return n.apply(t,r.concat(a.call(arguments)));d.prototype=n.prototype;var u=new d;d.prototype=null;var i=n.apply(u,r.concat(a.call(arguments)));return h.isObject(i)?i:u}},h.partial=function(n){var t=a.call(arguments,1);return function(){for(var r=0,e=t.slice(),u=0,i=e.length;i>u;u++)e[u]===h&&(e[u]=arguments[r++]);for(;r<arguments.length;)e.push(arguments[r++]);return n.apply(this,e)}},h.bindAll=function(n){var t,r,e=arguments.length;if(1>=e)throw new Error("bindAll must be passed function names");for(t=1;e>t;t++)r=arguments[t],n[r]=h.bind(n[r],n);return n},h.memoize=function(n,t){var r=function(e){var u=r.cache,i=t?t.apply(this,arguments):e;return h.has(u,i)||(u[i]=n.apply(this,arguments)),u[i]};return r.cache={},r},h.delay=function(n,t){var r=a.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},h.defer=function(n){return h.delay.apply(h,[n,1].concat(a.call(arguments,1)))},h.throttle=function(n,t,r){var e,u,i,a=null,o=0;r||(r={});var l=function(){o=r.leading===!1?0:h.now(),a=null,i=n.apply(e,u),a||(e=u=null)};return function(){var c=h.now();o||r.leading!==!1||(o=c);var f=t-(c-o);return e=this,u=arguments,0>=f||f>t?(clearTimeout(a),a=null,o=c,i=n.apply(e,u),a||(e=u=null)):a||r.trailing===!1||(a=setTimeout(l,f)),i}},h.debounce=function(n,t,r){var e,u,i,a,o,l=function(){var c=h.now()-a;t>c&&c>0?e=setTimeout(l,t-c):(e=null,r||(o=n.apply(i,u),e||(i=u=null)))};return function(){i=this,u=arguments,a=h.now();var c=r&&!e;return e||(e=setTimeout(l,t)),c&&(o=n.apply(i,u),i=u=null),o}},h.wrap=function(n,t){return h.partial(t,n)},h.negate=function(n){return function(){return!n.apply(this,arguments)}},h.compose=function(){var n=arguments,t=n.length-1;return function(){for(var r=t,e=n[t].apply(this,arguments);r--;)e=n[r].call(this,e);return e}},h.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},h.before=function(n,t){var r;return function(){return--n>0?r=t.apply(this,arguments):t=null,r}},h.once=h.partial(h.before,2),h.keys=function(n){if(!h.isObject(n))return[];if(s)return s(n);var t=[];for(var r in n)h.has(n,r)&&t.push(r);return t},h.values=function(n){for(var t=h.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},h.pairs=function(n){for(var t=h.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];return e},h.invert=function(n){for(var t={},r=h.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},h.functions=h.methods=function(n){var t=[];for(var r in n)h.isFunction(n[r])&&t.push(r);return t.sort()},h.extend=function(n){if(!h.isObject(n))return n;for(var t,r,e=1,u=arguments.length;u>e;e++){t=arguments[e];for(r in t)c.call(t,r)&&(n[r]=t[r])}return n},h.pick=function(n,t,r){var e,u={};if(null==n)return u;if(h.isFunction(t)){t=g(t,r);for(e in n){var i=n[e];t(i,e,n)&&(u[e]=i)}}else{var l=o.apply([],a.call(arguments,1));n=new Object(n);for(var c=0,f=l.length;f>c;c++)e=l[c],e in n&&(u[e]=n[e])}return u},h.omit=function(n,t,r){if(h.isFunction(t))t=h.negate(t);else{var e=h.map(o.apply([],a.call(arguments,1)),String);t=function(n,t){return!h.contains(e,t)}}return h.pick(n,t,r)},h.defaults=function(n){if(!h.isObject(n))return n;for(var t=1,r=arguments.length;r>t;t++){var e=arguments[t];for(var u in e)n[u]===void 0&&(n[u]=e[u])}return n},h.clone=function(n){return h.isObject(n)?h.isArray(n)?n.slice():h.extend({},n):n},h.tap=function(n,t){return t(n),n};var b=function(n,t,r,e){if(n===t)return 0!==n||1/n===1/t;if(null==n||null==t)return n===t;n instanceof h&&(n=n._wrapped),t instanceof h&&(t=t._wrapped);var u=l.call(n);if(u!==l.call(t))return!1;switch(u){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!==+n?+t!==+t:0===+n?1/+n===1/t:+n===+t;case"[object Date]":case"[object Boolean]":return+n===+t}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]===n)return e[i]===t;var a=n.constructor,o=t.constructor;if(a!==o&&"constructor"in n&&"constructor"in t&&!(h.isFunction(a)&&a instanceof a&&h.isFunction(o)&&o instanceof o))return!1;r.push(n),e.push(t);var c,f;if("[object Array]"===u){if(c=n.length,f=c===t.length)for(;c--&&(f=b(n[c],t[c],r,e)););}else{var s,p=h.keys(n);if(c=p.length,f=h.keys(t).length===c)for(;c--&&(s=p[c],f=h.has(t,s)&&b(n[s],t[s],r,e)););}return r.pop(),e.pop(),f};h.isEqual=function(n,t){return b(n,t,[],[])},h.isEmpty=function(n){if(null==n)return!0;if(h.isArray(n)||h.isString(n)||h.isArguments(n))return 0===n.length;for(var t in n)if(h.has(n,t))return!1;return!0},h.isElement=function(n){return!(!n||1!==n.nodeType)},h.isArray=f||function(n){return"[object Array]"===l.call(n)},h.isObject=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n},h.each(["Arguments","Function","String","Number","Date","RegExp"],function(n){h["is"+n]=function(t){return l.call(t)==="[object "+n+"]"}}),h.isArguments(arguments)||(h.isArguments=function(n){return h.has(n,"callee")}),"function"!=typeof/./&&(h.isFunction=function(n){return"function"==typeof n||!1}),h.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},h.isNaN=function(n){return h.isNumber(n)&&n!==+n},h.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"===l.call(n)},h.isNull=function(n){return null===n},h.isUndefined=function(n){return n===void 0},h.has=function(n,t){return null!=n&&c.call(n,t)},h.noConflict=function(){return n._=t,this},h.identity=function(n){return n},h.constant=function(n){return function(){return n}},h.noop=function(){},h.property=function(n){return function(t){return t[n]}},h.matches=function(n){var t=h.pairs(n),r=t.length;return function(n){if(null==n)return!r;n=new Object(n);for(var e=0;r>e;e++){var u=t[e],i=u[0];if(u[1]!==n[i]||!(i in n))return!1}return!0}},h.times=function(n,t,r){var e=Array(Math.max(0,n));t=g(t,r,1);for(var u=0;n>u;u++)e[u]=t(u);return e},h.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},h.now=Date.now||function(){return(new Date).getTime()};var _={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},w=h.invert(_),j=function(n){var t=function(t){return n[t]},r="(?:"+h.keys(n).join("|")+")",e=RegExp(r),u=RegExp(r,"g");return function(n){return n=null==n?"":""+n,e.test(n)?n.replace(u,t):n}};h.escape=j(_),h.unescape=j(w),h.result=function(n,t){if(null==n)return void 0;var r=n[t];return h.isFunction(r)?n[t]():r};var x=0;h.uniqueId=function(n){var t=++x+"";return n?n+t:t},h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/(.)^/,k={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},O=/\\|'|\r|\n|\u2028|\u2029/g,F=function(n){return"\\"+k[n]};h.template=function(n,t,r){!t&&r&&(t=r),t=h.defaults({},t,h.templateSettings);var e=RegExp([(t.escape||A).source,(t.interpolate||A).source,(t.evaluate||A).source].join("|")+"|$","g"),u=0,i="__p+='";n.replace(e,function(t,r,e,a,o){return i+=n.slice(u,o).replace(O,F),u=o+t.length,r?i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":e?i+="'+\n((__t=("+e+"))==null?'':__t)+\n'":a&&(i+="';\n"+a+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var a=new Function(t.variable||"obj","_",i)}catch(o){throw o.source=i,o}var l=function(n){return a.call(this,n,h)},c=t.variable||"obj";return l.source="function("+c+"){\n"+i+"}",l},h.chain=function(n){var t=h(n);return t._chain=!0,t};var E=function(n){return this._chain?h(n).chain():n};h.mixin=function(n){h.each(h.functions(n),function(t){var r=h[t]=n[t];h.prototype[t]=function(){var n=[this._wrapped];return i.apply(n,arguments),E.call(this,r.apply(h,n))}})},h.mixin(h),h.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=r[n];h.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==n&&"splice"!==n||0!==r.length||delete r[0],E.call(this,r)}}),h.each(["concat","join","slice"],function(n){var t=r[n];h.prototype[n]=function(){return E.call(this,t.apply(this._wrapped,arguments))}}),h.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return h})}).call(this);

// Backbone.js 0.9.2

// (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Backbone may be freely distributed under the MIT license.
// For all details and documentation:
// http://backbonejs.org
(function(){var l=this,y=l.Backbone,z=Array.prototype.slice,A=Array.prototype.splice,g;g="undefined"!==typeof exports?exports:l.Backbone={};g.VERSION="0.9.2";var f=l._;!f&&"undefined"!==typeof require&&(f=require("underscore"));var i=l.jQuery||l.Zepto||l.ender;g.setDomLibrary=function(a){i=a};g.noConflict=function(){l.Backbone=y;return this};g.emulateHTTP=!1;g.emulateJSON=!1;var p=/\s+/,k=g.Events={on:function(a,b,c){var d,e,f,g,j;if(!b)return this;a=a.split(p);for(d=this._callbacks||(this._callbacks=
{});e=a.shift();)f=(j=d[e])?j.tail:{},f.next=g={},f.context=c,f.callback=b,d[e]={tail:g,next:j?j.next:f};return this},off:function(a,b,c){var d,e,h,g,j,q;if(e=this._callbacks){if(!a&&!b&&!c)return delete this._callbacks,this;for(a=a?a.split(p):f.keys(e);d=a.shift();)if(h=e[d],delete e[d],h&&(b||c))for(g=h.tail;(h=h.next)!==g;)if(j=h.callback,q=h.context,b&&j!==b||c&&q!==c)this.on(d,j,q);return this}},trigger:function(a){var b,c,d,e,f,g;if(!(d=this._callbacks))return this;f=d.all;a=a.split(p);for(g=
z.call(arguments,1);b=a.shift();){if(c=d[b])for(e=c.tail;(c=c.next)!==e;)c.callback.apply(c.context||this,g);if(c=f){e=c.tail;for(b=[b].concat(g);(c=c.next)!==e;)c.callback.apply(c.context||this,b)}}return this}};k.bind=k.on;k.unbind=k.off;var o=g.Model=function(a,b){var c;a||(a={});b&&b.parse&&(a=this.parse(a));if(c=n(this,"defaults"))a=f.extend({},c,a);b&&b.collection&&(this.collection=b.collection);this.attributes={};this._escapedAttributes={};this.cid=f.uniqueId("c");this.changed={};this._silent=
{};this._pending={};this.set(a,{silent:!0});this.changed={};this._silent={};this._pending={};this._previousAttributes=f.clone(this.attributes);this.initialize.apply(this,arguments)};f.extend(o.prototype,k,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return f.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;b=this.get(a);return this._escapedAttributes[a]=f.escape(null==
b?"":""+b)},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e;f.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b);c||(c={});if(!d)return this;d instanceof o&&(d=d.attributes);if(c.unset)for(e in d)d[e]=void 0;if(!this._validate(d,c))return!1;this.idAttribute in d&&(this.id=d[this.idAttribute]);var b=c.changes={},h=this.attributes,g=this._escapedAttributes,j=this._previousAttributes||{};for(e in d){a=d[e];if(!f.isEqual(h[e],a)||c.unset&&f.has(h,e))delete g[e],(c.silent?this._silent:
b)[e]=!0;c.unset?delete h[e]:h[e]=a;!f.isEqual(j[e],a)||f.has(h,e)!=f.has(j,e)?(this.changed[e]=a,c.silent||(this._pending[e]=!0)):(delete this.changed[e],delete this._pending[e])}c.silent||this.change(c);return this},unset:function(a,b){(b||(b={})).unset=!0;return this.set(a,null,b)},clear:function(a){(a||(a={})).unset=!0;return this.set(f.clone(this.attributes),a)},fetch:function(a){var a=a?f.clone(a):{},b=this,c=a.success;a.success=function(d,e,f){if(!b.set(b.parse(d,f),a))return!1;c&&c(b,d)};
a.error=g.wrapError(a.error,b,a);return(this.sync||g.sync).call(this,"read",this,a)},save:function(a,b,c){var d,e;f.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b);c=c?f.clone(c):{};if(c.wait){if(!this._validate(d,c))return!1;e=f.clone(this.attributes)}a=f.extend({},c,{silent:!0});if(d&&!this.set(d,c.wait?a:c))return!1;var h=this,i=c.success;c.success=function(a,b,e){b=h.parse(a,e);if(c.wait){delete c.wait;b=f.extend(d||{},b)}if(!h.set(b,c))return false;i?i(h,a):h.trigger("sync",h,a,c)};c.error=g.wrapError(c.error,
h,c);b=this.isNew()?"create":"update";b=(this.sync||g.sync).call(this,b,this,c);c.wait&&this.set(e,a);return b},destroy:function(a){var a=a?f.clone(a):{},b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(this.isNew())return d(),!1;a.success=function(e){a.wait&&d();c?c(b,e):b.trigger("sync",b,e,a)};a.error=g.wrapError(a.error,b,a);var e=(this.sync||g.sync).call(this,"delete",this,a);a.wait||d();return e},url:function(){var a=n(this,"urlRoot")||n(this.collection,"url")||t();
return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(a){a||(a={});var b=this._changing;this._changing=!0;for(var c in this._silent)this._pending[c]=!0;var d=f.extend({},a.changes,this._silent);this._silent={};for(c in d)this.trigger("change:"+c,this,this.get(c),a);if(b)return this;for(;!f.isEmpty(this._pending);){this._pending=
{};this.trigger("change",this,a);for(c in this.changed)!this._pending[c]&&!this._silent[c]&&delete this.changed[c];this._previousAttributes=f.clone(this.attributes)}this._changing=!1;return this},hasChanged:function(a){return!arguments.length?!f.isEmpty(this.changed):f.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._previousAttributes,e;for(e in a)if(!f.isEqual(d[e],b=a[e]))(c||(c={}))[e]=b;return c},previous:function(a){return!arguments.length||
!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return f.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,b){if(b.silent||!this.validate)return!0;var a=f.extend({},this.attributes,a),c=this.validate(a,b);if(!c)return!0;b&&b.error?b.error(this,c,b):this.trigger("error",this,c,b);return!1}});var r=g.Collection=function(a,b){b||(b={});b.model&&(this.model=b.model);b.comparator&&(this.comparator=b.comparator);
this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,{silent:!0,parse:b.parse})};f.extend(r.prototype,k,{model:o,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){var c,d,e,g,i,j={},k={},l=[];b||(b={});a=f.isArray(a)?a.slice():[a];c=0;for(d=a.length;c<d;c++){if(!(e=a[c]=this._prepareModel(a[c],b)))throw Error("Can't add an invalid model to a collection");g=e.cid;i=e.id;j[g]||this._byCid[g]||null!=i&&(k[i]||this._byId[i])?
l.push(c):j[g]=k[i]=e}for(c=l.length;c--;)a.splice(l[c],1);c=0;for(d=a.length;c<d;c++)(e=a[c]).on("all",this._onModelEvent,this),this._byCid[e.cid]=e,null!=e.id&&(this._byId[e.id]=e);this.length+=d;A.apply(this.models,[null!=b.at?b.at:this.models.length,0].concat(a));this.comparator&&this.sort({silent:!0});if(b.silent)return this;c=0;for(d=this.models.length;c<d;c++)if(j[(e=this.models[c]).cid])b.index=c,e.trigger("add",e,this,b);return this},remove:function(a,b){var c,d,e,g;b||(b={});a=f.isArray(a)?
a.slice():[a];c=0;for(d=a.length;c<d;c++)if(g=this.getByCid(a[c])||this.get(a[c]))delete this._byId[g.id],delete this._byCid[g.cid],e=this.indexOf(g),this.models.splice(e,1),this.length--,b.silent||(b.index=e,g.trigger("remove",g,this,b)),this._removeReference(g);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,b);return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,f.extend({at:0},b));return a},
shift:function(a){var b=this.at(0);this.remove(b,a);return b},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return f.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var b=f.bind(this.comparator,this);1==this.comparator.length?
this.models=this.sortBy(b):this.models.sort(b);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return f.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);this._reset();this.add(a,f.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a=a?f.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;a.success=function(d,
e,f){b[a.add?"add":"reset"](b.parse(d,f),a);c&&c(b,d)};a.error=g.wrapError(a.error,b,a);return(this.sync||g.sync).call(this,"read",this,a)},create:function(a,b){var c=this,b=b?f.clone(b):{},a=this._prepareModel(a,b);if(!a)return!1;b.wait||c.add(a,b);var d=b.success;b.success=function(e,f){b.wait&&c.add(e,b);d?d(e,f):e.trigger("sync",a,f,b)};a.save(null,b);return a},parse:function(a){return a},chain:function(){return f(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId=
{};this._byCid={}},_prepareModel:function(a,b){b||(b={});a instanceof o?a.collection||(a.collection=this):(b.collection=this,a=new this.model(a,b),a._validate(a.attributes,b)||(a=!1));return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"==a||"remove"==a)&&c!=this||("destroy"==a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,
arguments))}});f.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(a){r.prototype[a]=function(){return f[a].apply(f,[this.models].concat(f.toArray(arguments)))}});var v=g.View=function(a){this.cid=f.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},F=/^(\S+)\s*(.*)$/,w="model,collection,el,id,attributes,className,tagName".split(",");
f.extend(v.prototype,k,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(a,b,c){a=document.createElement(a);b&&i(a).attr(b);c&&i(a).html(c);return a},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof i?a:i(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=n(this,"events"))){this.undelegateEvents();
for(var b in a){var c=a[b];f.isFunction(c)||(c=this[a[b]]);if(!c)throw Error('Method "'+a[b]+'" does not exist');var d=b.match(F),e=d[1],d=d[2],c=f.bind(c,this),e=e+(".delegateEvents"+this.cid);""===d?this.$el.bind(e,c):this.$el.delegate(d,e,c)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=f.extend({},this.options,a));for(var b=0,c=w.length;b<c;b++){var d=w[b];a[d]&&(this[d]=a[d])}this.options=a},_ensureElement:function(){if(this.el)this.setElement(this.el,
!1);else{var a=n(this,"attributes")||{};this.id&&(a.id=this.id);this.className&&(a["class"]=this.className);this.setElement(this.make(this.tagName,a),!1)}}});o.extend=r.extend=v.extend=function(a,b){var c=G(this,a,b);c.extend=this.extend;return c};var H={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};g.sync=function(a,b,c){var d=H[a];c||(c={});var e={type:d,dataType:"json"};c.url||(e.url=n(b,"url")||t());if(!c.data&&b&&("create"==a||"update"==a))e.contentType="application/json",
e.data=JSON.stringify(b.toJSON());g.emulateJSON&&(e.contentType="application/x-www-form-urlencoded",e.data=e.data?{model:e.data}:{});if(g.emulateHTTP&&("PUT"===d||"DELETE"===d))g.emulateJSON&&(e.data._method=d),e.type="POST",e.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d)};"GET"!==e.type&&!g.emulateJSON&&(e.processData=!1);return i.ajax(f.extend(e,c))};g.wrapError=function(a,b,c){return function(d,e){e=d===b?e:d;a?a(b,e,c):b.trigger("error",b,e,c)}};var x=function(){},G=function(a,
b,c){var d;d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)};f.extend(d,a);x.prototype=a.prototype;d.prototype=new x;b&&f.extend(d.prototype,b);c&&f.extend(d,c);d.prototype.constructor=d;d.__super__=a.prototype;return d},n=function(a,b){return!a||!a[b]?null:f.isFunction(a[b])?a[b]():a[b]},t=function(){throw Error('A "url" property or function must be specified');}}).call(this);

!function(){"use strict";var t=window,h="0123456789abcdef".split(""),s=[-2147483648,8388608,32768,128],i=[24,16,8,0],e=["hex","array","digest","arrayBuffer"],r=[],n=function(t){return function(h){return new a(!0).update(h)[t]()}};function a(t){t?(r[0]=r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0,this.blocks=r):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}a.prototype.update=function(h){if(!this.finalized){var s="string"!=typeof h;s&&h.constructor===t.ArrayBuffer&&(h=new Uint8Array(h));for(var e,r,n=0,a=h.length||0,o=this.blocks;n<a;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),s)for(r=this.start;n<a&&r<64;++n)o[r>>2]|=h[n]<<i[3&r++];else for(r=this.start;n<a&&r<64;++n)(e=h.charCodeAt(n))<128?o[r>>2]|=e<<i[3&r++]:e<2048?(o[r>>2]|=(192|e>>6)<<i[3&r++],o[r>>2]|=(128|63&e)<<i[3&r++]):e<55296||e>=57344?(o[r>>2]|=(224|e>>12)<<i[3&r++],o[r>>2]|=(128|e>>6&63)<<i[3&r++],o[r>>2]|=(128|63&e)<<i[3&r++]):(e=65536+((1023&e)<<10|1023&h.charCodeAt(++n)),o[r>>2]|=(240|e>>18)<<i[3&r++],o[r>>2]|=(128|e>>12&63)<<i[3&r++],o[r>>2]|=(128|e>>6&63)<<i[3&r++],o[r>>2]|=(128|63&e)<<i[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=o[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},a.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,h=this.lastByteIndex;t[16]=this.block,t[h>>2]|=s[3&h],this.block=t[16],h>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}},a.prototype.hash=function(){var t,h,s=this.h0,i=this.h1,e=this.h2,r=this.h3,n=this.h4,a=this.blocks;for(t=16;t<80;++t)h=a[t-3]^a[t-8]^a[t-14]^a[t-16],a[t]=h<<1|h>>>31;for(t=0;t<20;t+=5)s=(h=(i=(h=(e=(h=(r=(h=(n=(h=s<<5|s>>>27)+(i&e|~i&r)+n+1518500249+a[t]<<0)<<5|n>>>27)+(s&(i=i<<30|i>>>2)|~s&e)+r+1518500249+a[t+1]<<0)<<5|r>>>27)+(n&(s=s<<30|s>>>2)|~n&i)+e+1518500249+a[t+2]<<0)<<5|e>>>27)+(r&(n=n<<30|n>>>2)|~r&s)+i+1518500249+a[t+3]<<0)<<5|i>>>27)+(e&(r=r<<30|r>>>2)|~e&n)+s+1518500249+a[t+4]<<0,e=e<<30|e>>>2;for(;t<40;t+=5)s=(h=(i=(h=(e=(h=(r=(h=(n=(h=s<<5|s>>>27)+(i^e^r)+n+1859775393+a[t]<<0)<<5|n>>>27)+(s^(i=i<<30|i>>>2)^e)+r+1859775393+a[t+1]<<0)<<5|r>>>27)+(n^(s=s<<30|s>>>2)^i)+e+1859775393+a[t+2]<<0)<<5|e>>>27)+(r^(n=n<<30|n>>>2)^s)+i+1859775393+a[t+3]<<0)<<5|i>>>27)+(e^(r=r<<30|r>>>2)^n)+s+1859775393+a[t+4]<<0,e=e<<30|e>>>2;for(;t<60;t+=5)s=(h=(i=(h=(e=(h=(r=(h=(n=(h=s<<5|s>>>27)+(i&e|i&r|e&r)+n-1894007588+a[t]<<0)<<5|n>>>27)+(s&(i=i<<30|i>>>2)|s&e|i&e)+r-1894007588+a[t+1]<<0)<<5|r>>>27)+(n&(s=s<<30|s>>>2)|n&i|s&i)+e-1894007588+a[t+2]<<0)<<5|e>>>27)+(r&(n=n<<30|n>>>2)|r&s|n&s)+i-1894007588+a[t+3]<<0)<<5|i>>>27)+(e&(r=r<<30|r>>>2)|e&n|r&n)+s-1894007588+a[t+4]<<0,e=e<<30|e>>>2;for(;t<80;t+=5)s=(h=(i=(h=(e=(h=(r=(h=(n=(h=s<<5|s>>>27)+(i^e^r)+n-899497514+a[t]<<0)<<5|n>>>27)+(s^(i=i<<30|i>>>2)^e)+r-899497514+a[t+1]<<0)<<5|r>>>27)+(n^(s=s<<30|s>>>2)^i)+e-899497514+a[t+2]<<0)<<5|e>>>27)+(r^(n=n<<30|n>>>2)^s)+i-899497514+a[t+3]<<0)<<5|i>>>27)+(e^(r=r<<30|r>>>2)^n)+s-899497514+a[t+4]<<0,e=e<<30|e>>>2;this.h0=this.h0+s<<0,this.h1=this.h1+i<<0,this.h2=this.h2+e<<0,this.h3=this.h3+r<<0,this.h4=this.h4+n<<0},a.prototype.hex=function(){this.finalize();var t=this.h0,s=this.h1,i=this.h2,e=this.h3,r=this.h4;return h[t>>28&15]+h[t>>24&15]+h[t>>20&15]+h[t>>16&15]+h[t>>12&15]+h[t>>8&15]+h[t>>4&15]+h[15&t]+h[s>>28&15]+h[s>>24&15]+h[s>>20&15]+h[s>>16&15]+h[s>>12&15]+h[s>>8&15]+h[s>>4&15]+h[15&s]+h[i>>28&15]+h[i>>24&15]+h[i>>20&15]+h[i>>16&15]+h[i>>12&15]+h[i>>8&15]+h[i>>4&15]+h[15&i]+h[e>>28&15]+h[e>>24&15]+h[e>>20&15]+h[e>>16&15]+h[e>>12&15]+h[e>>8&15]+h[e>>4&15]+h[15&e]+h[r>>28&15]+h[r>>24&15]+h[r>>20&15]+h[r>>16&15]+h[r>>12&15]+h[r>>8&15]+h[r>>4&15]+h[15&r]},a.prototype.toString=a.prototype.hex,a.prototype.digest=function(){this.finalize();var t=this.h0,h=this.h1,s=this.h2,i=this.h3,e=this.h4;return[t>>24&255,t>>16&255,t>>8&255,255&t,h>>24&255,h>>16&255,h>>8&255,255&h,s>>24&255,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i,e>>24&255,e>>16&255,e>>8&255,255&e]},a.prototype.array=a.prototype.digest,a.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(20),h=new DataView(t);return h.setUint32(0,this.h0),h.setUint32(4,this.h1),h.setUint32(8,this.h2),h.setUint32(12,this.h3),h.setUint32(16,this.h4),t};var o=function(){var t=n("hex");t.create=function(){return new a},t.update=function(h){return t.create().update(h)};for(var h=0;h<e.length;++h){var s=e[h];t[s]=n(s)}return t}();t.sha1=o}();
['width','height'].forEach(function(dimension){var offset,Dimension=dimension.replace(/./,function(m){return m[0].toUpperCase()});$.fn['outer'+Dimension]=function(margin){var elem=this;if(elem){var size=elem[dimension]();var sides={'width':['left','right'],'height':['top','bottom']};sides[dimension].forEach(function(side){if(margin)size+=parseInt(elem.css('margin-'+side),10);});return size;}else{return null;}};});$.fn['end']=function(){return this.prevObject||$();};
(function($){var data={},dataAttr=$.fn.data,camelize=$.camelCase,exp=$.expando='Zepto'+(+new Date())
function getData(node,name){var id=node[exp],store=id&&data[id]
if(name===undefined)return store||setData(node)
else{if(store){if(name in store)return store[name]
var camelName=camelize(name)
if(camelName in store)return store[camelName]}
return dataAttr.call($(node),name)}}
function setData(node,name,value){var id=node[exp]||(node[exp]=++$.uuid),store=data[id]||(data[id]=attributeData(node))
if(name!==undefined)store[camelize(name)]=value
return store}
function attributeData(node){var store={}
$.each(node.attributes,function(i,attr){if(attr.name.indexOf('data-')==0)
store[camelize(attr.name.replace('data-',''))]=$.zepto.deserializeValue(attr.value)})
return store}
$.fn.data=function(name,value){return value===undefined?$.isPlainObject(name)?this.each(function(i,node){$.each(name,function(key,value){setData(node,key,value)})}):this.length==0?undefined:getData(this[0],name):this.each(function(){setData(this,name,value)})}
$.fn.removeData=function(names){if(typeof names=='string')names=names.split(/\s+/)
return this.each(function(){var id=this[exp],store=id&&data[id]
if(store)$.each(names,function(){delete store[camelize(this)]})})}})(Zepto);
(function($){var touch={},touchTimeout,tapTimeout,swipeTimeout,longTapTimeout,longTapDelay=750,gesture
function swipeDirection(x1,x2,y1,y2){return Math.abs(x1-x2)>=Math.abs(y1-y2)?(x1-x2>0?'Left':'Right'):(y1-y2>0?'Up':'Down')}
function longTap(){longTapTimeout=null
if(touch.last){touch.el.trigger('longTap')
touch={}}}
function cancelLongTap(){if(longTapTimeout)clearTimeout(longTapTimeout)
longTapTimeout=null}
function cancelAll(){if(touchTimeout)clearTimeout(touchTimeout)
if(tapTimeout)clearTimeout(tapTimeout)
if(swipeTimeout)clearTimeout(swipeTimeout)
if(longTapTimeout)clearTimeout(longTapTimeout)
touchTimeout=tapTimeout=swipeTimeout=longTapTimeout=null
touch={}}
function cancelEvent(event)
{event=event||window.event;if(event.preventDefault){event.preventDefault();event.stopPropagation();}else{event.returnValue=false;event.cancelBubble=true;}}
function isPrimaryTouch(event){return(event.pointerType=='touch'||event.pointerType==event.MSPOINTER_TYPE_TOUCH)&&event.isPrimary}
function isPointerEventType(e,type){return(e.type=='pointer'+type||e.type.toLowerCase()=='mspointer'+type)}
$.fn.registerTouch=function(){var now,delta,deltaX=0,deltaY=0,firstTouch,_isPointerType
if('MSGesture'in window){gesture=new MSGesture()
gesture.target=this[0];}
this.bind('MSGestureEnd',function(e){var swipeDirectionFromVelocity=e.velocityX>1?'Right':e.velocityX<-1?'Left':e.velocityY>1?'Down':e.velocityY<-1?'Up':null;if(swipeDirectionFromVelocity){touch.el.trigger('swipe')
touch.el.trigger('swipe'+swipeDirectionFromVelocity)}}).on('touchstart MSPointerDown pointerdown',function(e){if((_isPointerType=isPointerEventType(e,'down'))&&!isPrimaryTouch(e))return
firstTouch=_isPointerType?e:e.touches[0]
if(e.touches&&e.touches.length===1&&touch.x2){touch.x2=undefined
touch.y2=undefined}
now=Date.now()
delta=now-(touch.last||now)
touch.el=$('tagName'in firstTouch.target?firstTouch.target:firstTouch.target.parentNode)
touchTimeout&&clearTimeout(touchTimeout)
touch.x1=firstTouch.pageX
touch.y1=firstTouch.pageY
if(delta>0&&delta<=250)touch.isDoubleTap=true
touch.last=now
longTapTimeout=setTimeout(longTap,longTapDelay)
if(gesture&&_isPointerType)gesture.addPointer(e.pointerId);}).on('touchmove MSPointerMove pointermove',function(e){if((_isPointerType=isPointerEventType(e,'move'))&&!isPrimaryTouch(e))return
firstTouch=_isPointerType?e:e.touches[0]
cancelLongTap()
touch.x2=firstTouch.pageX
touch.y2=firstTouch.pageY
var hDistance=Math.abs(touch.x1-touch.x2)
deltaX+=hDistance
deltaY+=Math.abs(touch.y1-touch.y2)
if(hDistance>20){var event=$.Event('drag')
event.distance=hDistance
event.direction=(touch.x1>touch.x2)?"left":"right"
touch.el.trigger(event)
cancelEvent(e);}}).on('touchend MSPointerUp pointerup',function(e){if((_isPointerType=isPointerEventType(e,'up'))&&!isPrimaryTouch(e))return
cancelLongTap()
var event=$.Event('dragend')
event.distance=touch.x1-touch.x2;event.direction=(touch.x1>touch.x2)?"left":"right"
touch.el.trigger(event)
if((touch.x2&&Math.abs(touch.x1-touch.x2)>30)||(touch.y2&&Math.abs(touch.y1-touch.y2)>30))
swipeTimeout=setTimeout(function(){touch.el.trigger('swipe')
touch.el.trigger('swipe'+(swipeDirection(touch.x1,touch.x2,touch.y1,touch.y2)))
touch={}},0)
else if('last'in touch)
if(deltaX<30&&deltaY<30){tapTimeout=setTimeout(function(){var event=$.Event('tap')
event.cancelTouch=cancelAll
touch.el.trigger(event)
if(touch.isDoubleTap){if(touch.el)touch.el.trigger('doubleTap')
touch={}}
else{touchTimeout=setTimeout(function(){touchTimeout=null
if(touch.el)touch.el.trigger('singleTap')
touch={}},250)}},0)}else{touch={}}
deltaX=deltaY=0}).on('touchcancel MSPointerCancel pointercancel',cancelAll)
$(window).on('scroll',cancelAll)};['drag','dragend','swipe','swipeLeft','swipeRight','swipeUp','swipeDown','doubleTap','tap','singleTap','longTap'].forEach(function(eventName){$.fn[eventName]=function(callback){return this.on(eventName,callback)}})})(Zepto);
var IV;(function(IV){var AdProgressReporter=(function(){function AdProgressReporter(irollId,reporter,customMetrics,trackingEventCallback){this.irollId=irollId;this.reporter=reporter;this.customMetrics=customMetrics;this.trackingEventCallback=trackingEventCallback;this.playReported=false;}
AdProgressReporter.prototype.startReporting=function(playCallback){var _this=this;var completeCallback=_.once(function(){_this.reportAdComplete();});this.playCallback=function(){_this.playReported=true;playCallback();};IV.Events.on(this.irollId+":ad_play",_.once(function(forceImmediateImpression){if(typeof forceImmediateImpression==="undefined"){forceImmediateImpression=false;}
if(forceImmediateImpression){_this.reportAdPlay();}
else{_this.waitForTimeUpdateBeforeImpression(function(){_this.reportAdPlay();});}}));IV.Events.on(this.irollId+":video_videoPassed25",_.once(function(){_this.reportAdFirstQuartile();}));IV.Events.on(this.irollId+":video_videoPassed50",_.once(function(){_this.reportAdMidpoint();}));IV.Events.on(this.irollId+":video_videoPassed75",_.once(function(){_this.reportAdThirdQuartile();}));["video_ended","ad_ended"].forEach(function(eventName){IV.Events.on(_this.irollId+":"+eventName,completeCallback);});IV.Events.on(this.irollId+":video_videoPassedCustomPoint",function(){_this.customMetrics.forEach(function(url){_this.reporter.submit3rdPartyTracking([{data:url,type:IV.ThirdPartyTrackingReporter.URL_TRACKING_TYPE}]);});});};AdProgressReporter.prototype.waitForTimeUpdateBeforeImpression=function(callback){var _this=this;var onTimeUpdate=function(data){if(typeof data.currentTime!=="undefined"&&data.currentTime>0){IV.Events.off(_this.irollId+":video_timeupdate",onTimeUpdate);callback();}};IV.Events.on(this.irollId+":video_timeupdate",onTimeUpdate);};AdProgressReporter.prototype.reportAdPlay=function(){IV.Events.trigger(this.irollId+":videoStarted");IV.Events.trigger(this.irollId+":ad_started");this.reporter.submit({action:"play"});this.trackingEventCallback("playingStart");this.playCallback();};AdProgressReporter.prototype.reportAdFirstQuartile=function(){this.reporter.submit({action:"vpoint",event_value:25,event_id:"percent"});this.trackingEventCallback("playingFirstQuartile");};AdProgressReporter.prototype.reportAdMidpoint=function(){this.reporter.submit({action:"vpoint",event_value:50,event_id:"percent"});this.trackingEventCallback("playingMidpoint");};AdProgressReporter.prototype.reportAdThirdQuartile=function(){this.reporter.submit({action:"vpoint",event_value:75,event_id:"percent"});this.trackingEventCallback("playingThirdQuartile");};AdProgressReporter.prototype.reportAdComplete=function(){this.reporter.submit({action:"vpoint",event_value:100,event_id:"percent"});this.trackingEventCallback("playingComplete");};return AdProgressReporter;})();IV.AdProgressReporter=AdProgressReporter;})(IV||(IV={}));
var IV;(function(IV){var Base64Encoder=(function(){function Base64Encoder(){}
Base64Encoder.utf16CompatibleEncode=function(str){var utf8Bytes=encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode(parseInt("0x"+p1,16));});return btoa(utf8Bytes);};Base64Encoder.utf8CompatibleDecode=function(utf16CompatibleBase64){return decodeURIComponent(atob(utf16CompatibleBase64).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2);}).join(""));};return Base64Encoder;})();IV.Base64Encoder=Base64Encoder;})(IV||(IV={}));
var IV;(function(IV){var CanvasAppender=(function(){function CanvasAppender(core){this.core=core;}
CanvasAppender.prototype.getSize=function(){var externalInterface=this.core.get("interface");if(externalInterface!==null&&_.isFunction(externalInterface.getAdSize)){return externalInterface.getAdSize();}
else{return{"width":$(window).width()||-1,"height":$(window).height()||-1};}};CanvasAppender.prototype.setContainer=function(mainContainer){this.mainContainer=mainContainer;};CanvasAppender.prototype.appendToContainer=function(elem){this.mainContainer.appendChild(elem);};return CanvasAppender;})();IV.CanvasAppender=CanvasAppender;})(IV||(IV={}));
var IV;(function(IV){var ClickthruDecorator=(function(){function ClickthruDecorator(macroMapper,clickthruRedirectHelper){this.macroMapper=macroMapper;this.clickthruRedirectHelper=clickthruRedirectHelper;}
ClickthruDecorator.prototype.decorate=function(url,label,sessionId){url=this.macroMapper.expandSessionId(this.macroMapper.expandAll(url),sessionId);return this.clickthruRedirectHelper.redirect(url,label);};return ClickthruDecorator;})();IV.ClickthruDecorator=ClickthruDecorator;})(IV||(IV={}));
var IV;(function(IV){var ClickthruRedirectHelper=(function(){function ClickthruRedirectHelper(adConfig,reporter,getPlayStartTime){this.dtsClickthruUrl=null;this.dtsClickthruUrl=""+adConfig.dtsUrl+ClickthruRedirectHelper.DTS_CLICKTHRU_PATH+"?";this.reporter=reporter;this.getPlayStartTime=getPlayStartTime;}
Object.defineProperty(ClickthruRedirectHelper,"DTS_CLICKTHRU_PATH",{get:function(){return"/clktru/action/htmlclk";},enumerable:true,configurable:true});;Object.defineProperty(ClickthruRedirectHelper,"CLICKTHRU_ACTION",{get:function(){return"clktru";},enumerable:true,configurable:true});;ClickthruRedirectHelper.prototype.redirect=function(clickthruUrl,label,value){var options=label?{event_id:label}:{};if(_.isString(value)){options.event_value=value;}
return this.wrapUrlWithDts(clickthruUrl,options);};ClickthruRedirectHelper.prototype.wrapUrlWithDts=function(clickthruUrl,options){var template=_.template("<%= reportUrl %>&click=<%= clickthruUrl %>");options=this.overrideChildVideoOptions(options);var reportData=this.reporter.prepareReportData(options);reportData.action=ClickthruRedirectHelper.CLICKTHRU_ACTION;reportData.relative_time=_.now()-this.getPlayStartTime();var reportUrl=this.reporter.addReportDataToReportUrl(reportData,this.dtsClickthruUrl);clickthruUrl=encodeURIComponent(clickthruUrl);return template({reportUrl:reportUrl,clickthruUrl:clickthruUrl});};ClickthruRedirectHelper.prototype.overrideChildVideoOptions=function(options){var childVideoService=this.reporter.get("childVideoService");if(childVideoService.childVideoPlaying()){var selectedChildVideoData=childVideoService.getChildVideoData();return _.extend(options,{video_id:selectedChildVideoData.videoId,placement_hash:selectedChildVideoData.placementHash,project_state:selectedChildVideoData.projectState});}
return options;};return ClickthruRedirectHelper;})();IV.ClickthruRedirectHelper=ClickthruRedirectHelper;})(IV||(IV={}));
var IV;(function(IV){var ConsoleLogUtil=(function(){function ConsoleLogUtil(){}
ConsoleLogUtil.prototype.log=function(message){console.log(message);};return ConsoleLogUtil;})();IV.ConsoleLogUtil=ConsoleLogUtil;})(IV||(IV={}));
var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var IV;(function(IV){var CoreClickthruDecorator=(function(_super){__extends(CoreClickthruDecorator,_super);function CoreClickthruDecorator(macroMapper,clickthruRedirectHelper){_super.call(this,macroMapper,clickthruRedirectHelper);}
CoreClickthruDecorator.prototype.decorate=function(url,label,sessionId){return _super.prototype.decorate.call(this,url,label,sessionId);};return CoreClickthruDecorator;})(IV.ClickthruDecorator);IV.CoreClickthruDecorator=CoreClickthruDecorator;})(IV||(IV={}));
var IV;(function(IV){var CurrentScriptPopulator=(function(){function CurrentScriptPopulator(){}
CurrentScriptPopulator.populateCurrentScript=function(contextDoc){IV._currentScript=contextDoc["currentScript"]||this.findCurrentScript(contextDoc)||this.buildCurrentScript(contextDoc);};CurrentScriptPopulator.findCurrentScript=function(contextDoc){var scripts=contextDoc.getElementsByTagName("script");if(this.hasScriptUrlDefined()&&scripts&&scripts.length>0){var domain=this.currentScriptDomain(contextDoc);return this.findScriptByDomain(scripts,domain);}
return null;};CurrentScriptPopulator.buildCurrentScript=function(contextDoc){if(this.hasScriptUrlDefined()){var currentScript=contextDoc.createElement("script");currentScript.src=IV.baseData.scriptUrl;currentScript.type="text/javascript";return currentScript;}
return null;};CurrentScriptPopulator.hasScriptUrlDefined=function(){return IV.baseData&&typeof IV.baseData.scriptUrl==="string";};CurrentScriptPopulator.currentScriptDomain=function(contextDoc){var hyperlink=contextDoc.createElement("a");hyperlink.href=IV.baseData.scriptUrl;return hyperlink.hostname;};CurrentScriptPopulator.findScriptByDomain=function(scripts,domain){for(var idx=0;idx<scripts.length;idx++){var script=scripts[idx];if(script.src.indexOf(domain)>=0){return script;}}
return null;};return CurrentScriptPopulator;})();IV.CurrentScriptPopulator=CurrentScriptPopulator;})(IV||(IV={}));
var IV;(function(IV){var DataInjector=(function(){function DataInjector(qstRdr,tool){if(qstRdr===void 0){qstRdr=new IV.QueryStringReader();}
if(tool===void 0){tool=IV.toolkit;}
this.tool=tool;this.qstRdr=qstRdr;}
DataInjector.prototype.injectCustomParams=function(core){var htmldata=DataInjector.HTML_DATA;var ecp=DataInjector.EXTERNAL_CUSTOM_PARAMETERS;var efp=DataInjector.EXTERNAL_FEED_PARAMETERS;var newData=core.get("data")||{};newData[htmldata]=newData[htmldata]||{};newData[htmldata][ecp]=this.getCustomParams();newData[htmldata][efp]=this.getFeedParams();core.set("data",newData);};DataInjector.prototype.getCustomParams=function(){var ret=this.qstRdr.getExternalCustomParams(IV._currentScript,document.location.search);return ret.hasOwnProperty("ivc")?this.tool.parseQueryString(ret["ivc"]):ret;};DataInjector.prototype.getFeedParams=function(){var ret=IV._currentScript&&IV._currentScript.dataset&&IV._currentScript.dataset["invFeed"];return ret?this.tool.parseQueryString(decodeURIComponent(ret)):{};};DataInjector.HTML_DATA="html-custom-data";DataInjector.EXTERNAL_CUSTOM_PARAMETERS="EXTERNAL_CUSTOM_PARAMETERS";DataInjector.EXTERNAL_FEED_PARAMETERS="EXTERNAL_FEED_PARAMETERS";return DataInjector;})();IV.DataInjector=DataInjector;})(IV||(IV={}));
var IV;(function(IV){var FeatureBitsResolver=(function(){function FeatureBitsResolver(){}
Object.defineProperty(FeatureBitsResolver,"FEATURE_BITS_KEY",{get:function(){return"featureBits";},enumerable:true,configurable:true});Object.defineProperty(FeatureBitsResolver,"FEATURE_NAMES",{get:function(){return{VPAID_CLKTRU_HANDLE_BY_INNOVID_FOR_NON_IN_APP:"vpaid_clktru_handle_by_innovid_for_non_in_app",ALLOW_VPAID_DYNAMIC_VIDEO_PLACEMENTS:"feature.ac.studio_and_mobile.allow_vpaid_dynamic_video_placements"};},enumerable:true,configurable:true});FeatureBitsResolver.isEnabled=function(name){var featureBits=IV.baseData[FeatureBitsResolver.FEATURE_BITS_KEY];return!!featureBits&&featureBits[name];};return FeatureBitsResolver;})();IV.FeatureBitsResolver=FeatureBitsResolver;})(IV||(IV={}));
var IV;(function(IV){var FormatDetector=(function(){function FormatDetector(){}
Object.defineProperty(FormatDetector,"DISPLAY_FORMAT",{get:function(){return"display";},enumerable:true,configurable:true});Object.defineProperty(FormatDetector,"VIDEO_FORMAT",{get:function(){return"video";},enumerable:true,configurable:true});FormatDetector.isDisplayAd=function(format){return(format)&&format===FormatDetector.DISPLAY_FORMAT;};return FormatDetector;})();IV.FormatDetector=FormatDetector;})(IV||(IV={}));
var IV;(function(IV){var HtmlTextTagInjector=(function(){function HtmlTextTagInjector(iframeInjector){this.iframeInjector=iframeInjector;}
HtmlTextTagInjector.prototype.injectTextTagIntoIframe=function(textTag){var injectedIframe=this.iframeInjector.injectIframeIntoDoc(document);var ifrDoc=injectedIframe.contentWindow.document;this.writeTextTagInsideIframe(ifrDoc,textTag);};HtmlTextTagInjector.prototype.writeTextTagInsideIframe=function(ifrDoc,textTag){var _this=this;textTag=this.trimStratEndWhiteSpaces(textTag);textTag=this.addBackslashBeforeApostropheMark(textTag);textTag=this.splitScriptTag(textTag);var iframeHTML="<html><body marginwidth='0' marginheight='0' topmargin='0' leftmargin='0'><scr"+"ipt>";var codeLines=this.splitTextTagIntoLines(textTag);codeLines.forEach(function(line){iframeHTML+="document.write('"+_this.trimStratEndWhiteSpaces(line)+"');\n";});iframeHTML+="</scr"+"ipt></body></html>";ifrDoc.open().write(""+iframeHTML);ifrDoc.close();};HtmlTextTagInjector.prototype.trimStratEndWhiteSpaces=function(text){return text.replace(/^\s+|\s+$/g,"");};HtmlTextTagInjector.prototype.addBackslashBeforeApostropheMark=function(text){return text.replace(/'/ig,"\\'");};HtmlTextTagInjector.prototype.splitScriptTag=function(text){text=text.replace(/<script/ig,"<scr\' + \'ipt");return text.replace(/\/script>/ig,"/scr\' + \'ipt>");};HtmlTextTagInjector.prototype.splitTextTagIntoLines=function(text){var tempCode=text.replace(/(\r\n|\n|\r)/gm,"!!NEWLINE!!");return tempCode.split("!!NEWLINE!!");};return HtmlTextTagInjector;})();IV.HtmlTextTagInjector=HtmlTextTagInjector;})(IV||(IV={}));
var IV;(function(IV){var InAppDetector=(function(){function InAppDetector(deviceInfo){this.deviceInfo=deviceInfo;this.isInApp=this.isInAppMem();}
Object.defineProperty(InAppDetector,"IN_APP_REGEXP_LIST",{get:function(){return[/(iPhone|iPod|iPad).+AppleWebKit.*Mobile(?!.*Safari)/i,/\(.*Android.*\).+AppleWebKit.*Version\/\d/i,/^Dalvik/i,/ANVSDK/i,/CFNetwork.*Darwin/i,/^com\..*?Android/i,/FreeWheelAdManager/i,/LiveRailSDK/i,/TransperaSDK/i,/AerServSDK/i,/Anvato Android SDK/i,/Vungle/i,/Mozilla\/.*Android.*; wv\) AppleWebKit/i,/Mozilla\/.*Android.*Gecko\) Version\/\d+\.\d+/i,/ExoPlayerLib/i];},enumerable:true,configurable:true});InAppDetector.prototype.isInAppMem=function(){var _this=this;return _.memoize(function(){return!_this.deviceInfo.isDesktop()&&(_this.hasDeviceId()||_this.hasInAppUserAgent());});};InAppDetector.prototype.hasDeviceId=function(){return!!this.deviceInfo.getDeviceIdFromRequest();};InAppDetector.prototype.hasInAppUserAgent=function(){var userAgent=this.deviceInfo.getNavigatorUserAgent();return InAppDetector.IN_APP_REGEXP_LIST.some(function(regexp){return regexp.test(userAgent);});};return InAppDetector;})();IV.InAppDetector=InAppDetector;})(IV||(IV={}));
var IV;(function(IV){(function(Action){Action[Action["INVPLY"]=0]="INVPLY";Action[Action["INVPT"]=1]="INVPT";})(IV.Action||(IV.Action={}));var Action=IV.Action;var LOG_ACTION_FORMAT=">>>> HTML Internal Video ";var InUnitVideoQuartileActionUtil=(function(){function InUnitVideoQuartileActionUtil(){}
InUnitVideoQuartileActionUtil.toValue=function(action){switch(action){case Action.INVPLY:return"invply";case Action.INVPT:return"invpt";}};InUnitVideoQuartileActionUtil.toMessage=function(action,eventId,eventValue){switch(action){case Action.INVPLY:return LOG_ACTION_FORMAT+"Play: "+eventId;case Action.INVPT:return LOG_ACTION_FORMAT+eventValue+"%: "+eventId;}};return InUnitVideoQuartileActionUtil;})();IV.InUnitVideoQuartileActionUtil=InUnitVideoQuartileActionUtil;})(IV||(IV={}));
var IV;(function(IV){var InnovidLogger=(function(){function InnovidLogger(debugMode,toolKit){if(toolKit===void 0){toolKit=IV.toolkit;}
this.debugMode=debugMode;this.toolKit=toolKit;}
Object.defineProperty(InnovidLogger,"DEBUG_MODE",{get:function(){return"[INNOVID.DEBUG]";},enumerable:true,configurable:true});InnovidLogger.prototype.debug=function(){var valuesToWrite=[];for(var _i=0;_i<arguments.length;_i++){valuesToWrite[_i-0]=arguments[_i];}
if(this.debugMode){var now=this.toolKit.generateDate();var message="["+now+"]"+InnovidLogger.DEBUG_MODE+" "+valuesToWrite.join(" ");console.log(message);}};return InnovidLogger;})();IV.InnovidLogger=InnovidLogger;})(IV||(IV={}));
var IV;(function(IV){var MacroExcluder=(function(){function MacroExcluder(){}
MacroExcluder.excludeMacros=function(queryToFilter,filterType){var _this=this;if(filterType&&!this.MACROS[filterType]||!queryToFilter){return queryToFilter;}
var filterTypes=filterType?[filterType]:Object.keys(this.MACROS);queryToFilter=queryToFilter.split("&").filter(function(queryParam){return _this.isOneOfTheMacros(filterTypes,queryParam);}).join("&");return queryToFilter;};MacroExcluder.isMacro=function(queryParam,filterType){var keyMacro=queryParam.split("=")[0];return this.MACROS[filterType].some(function(macroPrefix){return keyMacro.toLowerCase().indexOf(macroPrefix)===0;});};MacroExcluder.isOneOfTheMacros=function(filterTypes,queryParam){var _this=this;return filterTypes.every(function(key){return!_this.isMacro(queryParam,key);});};MacroExcluder.MACROS={"DV":["dvp","turl","prr"],"DCO":["inv_fd_","inv_ctx_"]};return MacroExcluder;})();IV.MacroExcluder=MacroExcluder;})(IV||(IV={}));
var IV;(function(IV){var MacroMapper=(function(){function MacroMapper(data,htmlData,ecp,efp){if(data===void 0){data={};}
if(htmlData===void 0){htmlData=IV.DataInjector.HTML_DATA;}
if(ecp===void 0){ecp=IV.DataInjector.EXTERNAL_CUSTOM_PARAMETERS;}
if(efp===void 0){efp=IV.DataInjector.EXTERNAL_FEED_PARAMETERS;}
var customData=data[htmlData]||{};this.publisherValues=customData[ecp]||{};var feedMacros=customData[efp];if(feedMacros){for(var feedKey in feedMacros){if(feedMacros.hasOwnProperty(feedKey)){this.publisherValues[feedKey]=feedMacros[feedKey];}}}}
Object.defineProperty(MacroMapper,"CDATA_OPEN",{get:function(){return"<![CDATA[";},enumerable:true,configurable:true});Object.defineProperty(MacroMapper,"CDATA_CLOSE",{get:function(){return"]]>";},enumerable:true,configurable:true});Object.defineProperty(MacroMapper,"CDATA_MACRO_OPEN",{get:function(){return /(\$\$__CDATA__\$\$)/;},enumerable:true,configurable:true});Object.defineProperty(MacroMapper,"CDATA_MACRO_END",{get:function(){return /(\$\$__CDATA_CLOSE__\$\$)/;},enumerable:true,configurable:true});Object.defineProperty(MacroMapper,"URL_MACRO",{get:function(){return /(https?:\/\/)?([\w\-])+\.{1}([a-zA-Z]{2,63})([\/\w-]*)*\/?\??([^#\n\r]*)?#?([^\n\r]*)/;},enumerable:true,configurable:true});MacroMapper.prototype.expandSessionId=function(trackingData,sessionId){if(trackingData===void 0){trackingData="";}
return this.expandStaticMacro(/(\{iv_sessionid\})/ig,sessionId,trackingData);};MacroMapper.prototype.expandTimeStamp=function(trackingData){if(trackingData===void 0){trackingData="";}
return this.expandStaticMacro(/(\[timestamp\])/ig,(new Date().getTime()).toString(),trackingData);};MacroMapper.prototype.expandVersionId=function(trackingData){if(trackingData===void 0){trackingData="";}
var versionId=this.publisherValues.hasOwnProperty("version_id")?this.publisherValues["version_id"]:"";return this.expandStaticMacro(/(%257B|{|%7B)(DCO_VERSION_ID)(%257D|}|%7D)/ig,versionId,trackingData);};MacroMapper.prototype.expandPlacementId=function(trackingData,placementId){if(trackingData===void 0){trackingData="";}
return this.expandStaticMacro(/(\{iv_placementid\})/ig,placementId,trackingData);};MacroMapper.prototype.expandCreativeId=function(trackingData,creativeId){if(trackingData===void 0){trackingData="";}
return this.expandStaticMacro(/(\{iv_creativeid\})/ig,creativeId,trackingData);};MacroMapper.prototype.expandCampaignId=function(trackingData,campaignId){if(trackingData===void 0){trackingData="";}
return this.expandStaticMacro(/(\{iv_campaignid\})/ig,campaignId,trackingData);};MacroMapper.prototype.expandAdId=function(trackingData,adId){if(trackingData===void 0){trackingData="";}
return this.expandStaticMacro(/(\{iv_adid\})/ig,adId,trackingData);};MacroMapper.prototype.expandAll=function(pixel){var macrosInPixel=_.uniq(pixel.match(/(%257B|{|%7B)(ivc_|iv_geo_|feed_)\w+(%257D|}|%7D)/ig));return this.foundMatches(macrosInPixel)?this.expand(macrosInPixel,pixel):pixel;};MacroMapper.prototype.fixCDATA=function(blob){var fixedCdataOpen=this.expandStaticMacro(MacroMapper.CDATA_MACRO_OPEN,MacroMapper.CDATA_OPEN,blob);return this.expandStaticMacro(MacroMapper.CDATA_MACRO_END,MacroMapper.CDATA_CLOSE,fixedCdataOpen);};MacroMapper.prototype.addOrUpdateMacro=function(key,value){this.publisherValues[key]=value;};MacroMapper.prototype.expandStaticMacro=function(pattern,replace,reportUrl){if(reportUrl===void 0){reportUrl="";}
replace=replace?replace:"";reportUrl=_.isArray(reportUrl)?IV.toolkit.trim(reportUrl.shift()||""):IV.toolkit.trim(reportUrl);return pattern.exec(reportUrl)?reportUrl.replace(pattern,replace):reportUrl;};MacroMapper.prototype.encode=function(value,macro){var encodeTwice=/(%7B)(ivc_|iv_geo_|feed_)\w+(%7D)/ig,encodeOnce=/({)(ivc_|iv_geo_|feed_)\w+(})/ig;if(MacroMapper.URL_MACRO.test(value)){return this.expandAll(value);}
return encodeOnce.test(macro)?encodeURIComponent(value):encodeTwice.test(macro)?encodeURIComponent(encodeURIComponent(value)):encodeURIComponent(encodeURIComponent(encodeURIComponent(value)));};MacroMapper.prototype.expand=function(macrosInPixel,pixel){var _this=this;macrosInPixel.forEach(function(macro){var key=macro.replace(/{|}|%7B|%7D|%257B|%257D/ig,"");key=_this.isFeedMacro(key)?_this.transformToFeedKey(key):key;var regExpMacro=new RegExp(macro,"g");var valueReplacement=macro;if(_this.publisherValues.hasOwnProperty(key)){if(!_this.macroExpandsRecursively(key,macro)){valueReplacement=_this.encode(_this.publisherValues[key],macro);}}
else{valueReplacement="";}
pixel=_this.expandStaticMacro(regExpMacro,valueReplacement,pixel);});return pixel;};MacroMapper.prototype.foundMatches=function(arr){return arr&&arr.length>0;};MacroMapper.prototype.isFeedMacro=function(key){return /^(feed_)/.test(key);};MacroMapper.prototype.transformToFeedKey=function(key){return"inv_fd_"+key.substr(5);};MacroMapper.prototype.macroExpandsRecursively=function(key,macro){return this.publisherValues[key].indexOf(macro)!==-1;};return MacroMapper;})();IV.MacroMapper=MacroMapper;})(IV||(IV={}));
var IV;(function(IV){var RedirectClickthroughPageCreator=(function(){function RedirectClickthroughPageCreator(){}
RedirectClickthroughPageCreator.createHtmlTagWithRedirect=function(label,url){var message="Label "+label+": you are being redirected to "+url;return"<ht"+"ml>"+"<he"+"ad>"+"<scr"+"ipt>"+"setTimeout(function() {"+"window.location.replace('"+url+"');"+"}, 5000);"+"</sc"+"ript>"+"</he"+"ad>"+
this.buildBodyMessage(message)+"</ht"+"ml>";};RedirectClickthroughPageCreator.createHtmlTagWithTextMessageOnly=function(label){var message="Label "+label+": The clickthrough is working properly, but there is no URL defined. Please use \"Clickthrough URL\" page on CMT to insert one.";return"<ht"+"ml>"+"<he"+"ad>"+"</he"+"ad>"+
this.buildBodyMessage(message)+"</ht"+"ml>";};RedirectClickthroughPageCreator.buildBodyMessage=function(message){return"<bo"+"dy style=\""+this.BODY_STYLE+"\">"+"<di"+"v>"+message+"</d"+"iv>"+"</bo"+"dy>";};RedirectClickthroughPageCreator.BODY_STYLE="\n            display:flex;\n            justify-content:center;\n            align-items:center;\n            height: 100%;\n        ";return RedirectClickthroughPageCreator;})();IV.RedirectClickthroughPageCreator=RedirectClickthroughPageCreator;})(IV||(IV={}));
var IV;(function(IV){var SkipAdHandler=(function(){function SkipAdHandler(iroll){this.iroll=iroll;}
SkipAdHandler.prototype.skipAd=function(){IV.Events.trigger(this.iroll.get("id")+":skip");var reporter=this.iroll.report;reporter.submit({action:"skip",relative_time:(new Date().getTime()-this.iroll.get("playStartTime"))});IV.Events.trigger(this.iroll.get("id")+":close");};return SkipAdHandler;})();IV.SkipAdHandler=SkipAdHandler;})(IV||(IV={}));
var IV;(function(IV){var StudioPropsRetriever=(function(){function StudioPropsRetriever(){}
StudioPropsRetriever.getStudioPropByKey=function(htmlStudioProps,key){var value=void(0);if(Array.isArray(htmlStudioProps)&&htmlStudioProps.length>0){htmlStudioProps.some(function(property){if(property.hasOwnProperty(key)){value=property[key].toString();return true;}});}
return value;};return StudioPropsRetriever;})();IV.StudioPropsRetriever=StudioPropsRetriever;})(IV||(IV={}));
var IV;(function(IV){var ThirdPartyTrackingReporter=(function(){function ThirdPartyTrackingReporter(htmlTagInjector,mapper){this.mapper=mapper;this.htmlTagInjector=htmlTagInjector;}
Object.defineProperty(ThirdPartyTrackingReporter,"URL_TRACKING_TYPE",{get:function(){return"url-tracking";},enumerable:true,configurable:true});Object.defineProperty(ThirdPartyTrackingReporter,"HTML_TRACKING_TYPE",{get:function(){return"html-tracking";},enumerable:true,configurable:true});Object.defineProperty(ThirdPartyTrackingReporter,"INJECT_HTML_TRACKING_ERROR",{get:function(){return"inject-html-tracking-tag-error";},enumerable:true,configurable:true});Object.defineProperty(ThirdPartyTrackingReporter,"THIRD_PARTY_TRACKING_IFRAME_ID",{get:function(){return"3rdparty-tracking";},enumerable:true,configurable:true});ThirdPartyTrackingReporter.prototype.report=function(trackingData,trackingType,reportData,firePixelCb,reportLogCb,staticMacrosFb){var _this=this;if(staticMacrosFb){var staticMacros=[{valueToReplace:reportData.audience_id,expandPattern:/(\{iv_audienceid\})/ig},{valueToReplace:reportData.placement_hash,expandPattern:/(\{iv_adid\})/ig},{valueToReplace:reportData.video_id,expandPattern:/(\{iv_creativeid\})/ig},{valueToReplace:reportData.advertiser_id,expandPattern:/(\{iv_advertiserid\})/ig},{valueToReplace:reportData.publisher_id,expandPattern:/(\{iv_publisherid\})/ig},{valueToReplace:reportData.placements_group_id,expandPattern:/(\{iv_placementid\})/ig},{valueToReplace:reportData.client_id,expandPattern:/(\{iv_clientid\})/ig},{valueToReplace:reportData.campaign_id,expandPattern:/(\{iv_campaignid\})/ig},{valueToReplace:reportData.session_id,expandPattern:/(\{iv_sessionid\})/ig}];trackingData=this.mapper.expandAll(trackingData);staticMacros.forEach(function(macroExpander){trackingData=_this.mapper.expandStaticMacro(macroExpander.expandPattern,macroExpander.valueToReplace,trackingData);});trackingData=this.mapper.expandTimeStamp(this.mapper.expandVersionId(trackingData));}
else{trackingData=this.mapper.expandSessionId(this.mapper.expandTimeStamp(this.mapper.expandVersionId(this.mapper.expandAll(trackingData))),reportData.session_id);}
if(trackingType===ThirdPartyTrackingReporter.URL_TRACKING_TYPE){this.firePixel(trackingData,firePixelCb,reportLogCb);}
else if(trackingType===ThirdPartyTrackingReporter.HTML_TRACKING_TYPE){this.injectHtmlTextTag(trackingData,reportLogCb);}};ThirdPartyTrackingReporter.prototype.firePixel=function(trackingData,firePixelCb,reportLogCb){firePixelCb(trackingData);reportLogCb({event_id:"3rd-party-url",event_value:trackingData});};ThirdPartyTrackingReporter.prototype.injectHtmlTextTag=function(trackingData,reportLogCb){try{var htmlTracking=this.mapper.fixCDATA(trackingData);this.htmlTagInjector.injectTextTagIntoIframe(htmlTracking);reportLogCb({event_id:"3rd-party-html",event_value:htmlTracking});}
catch(e){reportLogCb({event_id:ThirdPartyTrackingReporter.INJECT_HTML_TRACKING_ERROR,event_value:e.message+": "+trackingData});}};return ThirdPartyTrackingReporter;})();IV.ThirdPartyTrackingReporter=ThirdPartyTrackingReporter;})(IV||(IV={}));
var IV;(function(IV){var VideoClickBehaviour;(function(VideoClickBehaviour){VideoClickBehaviour[VideoClickBehaviour["CLICKTHRU"]=0]="CLICKTHRU";VideoClickBehaviour[VideoClickBehaviour["OPEN_MICROSITE"]=1]="OPEN_MICROSITE";VideoClickBehaviour[VideoClickBehaviour["DO_NOTHING"]=2]="DO_NOTHING";})(VideoClickBehaviour||(VideoClickBehaviour={}));var VideoClickHandler=(function(){function VideoClickHandler(core,adConfig,eventBus,mapper){this.displayCampaignIdsToPreventClick=["101160","98916","110074"];this.core=core;this.adConfig=adConfig;this.eventBus=eventBus;this.mapper=mapper;this.clickThruLabel=this.adConfig.app_data["default-click-thru-label"];this.queryStringReader=new IV.QueryStringReader(IV.toolkit);}
VideoClickHandler.prototype.handleClick=function(ev){if(this.shouldHandleClick()){this.core.report.submit({action:"click",event_id:"position",event_value:ev.pageX+"x"+ev.pageY,relative_time:(_.now()-this.core.get("playStartTime"))});var clickBehaviour=this.detectClickBehaviour();if(clickBehaviour===VideoClickBehaviour.OPEN_MICROSITE){this.handleMicrositeBehaviour();}
else if(clickBehaviour===VideoClickBehaviour.CLICKTHRU){this.handleClickthruBehaviour();ev.stopPropagation();ev.preventDefault();}
if(clickBehaviour!==VideoClickBehaviour.OPEN_MICROSITE){this.logMainClickthruEvent();}}};VideoClickHandler.prototype.detectClickBehaviour=function(){var clickBehaviour=VideoClickBehaviour.DO_NOTHING;var data=this.adConfig.app_data;var toolbar=data["toolbar"];var isMicrosite=toolbar&&toolbar.data.engagementType==="minisite";if(isMicrosite&&(!toolbar.data.clickBehavior||toolbar.data.clickBehavior==="open-microsite")){clickBehaviour=VideoClickBehaviour.OPEN_MICROSITE;}
else if(data["video-clicks"]&&data["video-clicks"]["click-thru-url"]){clickBehaviour=VideoClickBehaviour.CLICKTHRU;}
return clickBehaviour;};VideoClickHandler.prototype.handleMicrositeBehaviour=function(){this.eventBus.trigger("openMicrosite",true);};VideoClickHandler.prototype.updateUrlToClickThruByVersion=function(url){var clickThruByVersion=this.queryStringReader.clickThruUrlByVersion(IV._currentScript);return clickThruByVersion?this.replaceMacrosInClickThruUrl(clickThruByVersion):url;};VideoClickHandler.prototype.replaceMacrosInClickThruUrl=function(url){var _this=this;var campaignId=this.getAttributeFromPlacementConfig("campaign-id");var placementId=this.getAttributeFromPlacementConfig("placements-group-id");var creativeId=this.getAttributeFromPlacementConfig("video-id");var adId=this.getAttributeFromPlacementConfig("placement-hash");var audienceId=this.queryStringReader.getAudienceIdFromIvc(IV._currentScript)?this.queryStringReader.getAudienceIdFromIvc(IV._currentScript):"";var ivcExdata=this.queryStringReader.getQueryIvcParam(IV._currentScript);if(ivcExdata&&ivcExdata.indexOf("extendedmacros")!==-1){var staticMacros=[{valueToReplace:audienceId,expandPattern:/(\{iv_audienceid\})/ig},{valueToReplace:adId,expandPattern:/(\{iv_adid\})/ig},{valueToReplace:creativeId,expandPattern:/(\{iv_creativeid\})/ig},{valueToReplace:placementId,expandPattern:/(\{iv_placementid\})/ig},{valueToReplace:campaignId,expandPattern:/(\{iv_campaignid\})/ig}];staticMacros.forEach(function(macroExpander){url=_this.mapper.expandStaticMacro(macroExpander.expandPattern,macroExpander.valueToReplace,url);});return url;}
else{return this.mapper.expandCampaignId(this.mapper.expandPlacementId(this.mapper.expandCreativeId(this.mapper.expandAdId(url,adId),creativeId),placementId),campaignId);}};VideoClickHandler.prototype.handleClickthruBehaviour=function(){var clickthruUrl=this.updateUrlToClickThruByVersion(this.adConfig.app_data["video-clicks"]["click-thru-url"]);var videoPlayer=this.core.get("videoPlayer");videoPlayer.pause();this.core.report.clickthru(this.clickThruLabel);var coreId=this.core.get("id");this.eventBus.trigger(coreId+":userClick");this.reportTrackingUrl();this.core.windowOpen(clickthruUrl,this.clickThruLabel);};VideoClickHandler.prototype.reportTrackingUrl=function(){var _this=this;var data=this.adConfig.app_data;if(data["placement-config"]&&data["placement-config"]["hotspot-clicks"]){data["placement-config"]["hotspot-clicks"].filter(function(hotspot){return hotspot.id===_this.clickThruLabel&&_.isArray(hotspot.tracking);}).forEach(function(hotspot){_this.core.report.submit3rdPartyTracking(hotspot.tracking);});}};VideoClickHandler.prototype.logMainClickthruEvent=function(){if(this.core.get("reportEventsToConsole")){console.log(">>>> Main video clickthru");}};VideoClickHandler.prototype.getAttributeFromPlacementConfig=function(key){var data=this.adConfig.app_data;if(data["placement-config"]&&data["placement-config"][key]){return data["placement-config"][key];}
else{return"";}};VideoClickHandler.prototype.shouldHandleClick=function(){var shouldHandleClickthrough=true;var campaignId=this.getAttributeFromPlacementConfig("campaign-id");var videoFormat=this.getAttributeFromPlacementConfig("video-format");if(IV.FormatDetector.isDisplayAd(videoFormat)){var studioPropConf=this.adConfig.app_data["html-studio-properties"];var htmlFile=IV.StudioPropsRetriever.getStudioPropByKey(studioPropConf,"html_file");shouldHandleClickthrough=this.displayCampaignIdsToPreventClick.indexOf(campaignId.toString())<0||!htmlFile;}
return shouldHandleClickthrough;};return VideoClickHandler;})();IV.VideoClickHandler=VideoClickHandler;})(IV||(IV={}));
var IV;(function(IV){var VideoVolumeHandler=(function(){function VideoVolumeHandler(videoElement){this.videoElement=videoElement;}
VideoVolumeHandler.prototype.onVolumeChange=function(volume){if(this.isVolumeValid(volume)){this.setVideoVolume(volume);}};VideoVolumeHandler.prototype.isVolumeValid=function(volume){var currentVolume=this.videoElement.volume;return typeof volume!=="undefined"&&!isNaN(volume)&&volume>=0&&volume<=1&&currentVolume!==volume;};VideoVolumeHandler.prototype.setVideoVolume=function(volume){if(typeof volume!=="number"){volume=parseFloat(volume);}
this.videoElement.volume=volume;};VideoVolumeHandler.prototype.bindVolumeChangeEvent=function(initialVolume){if(this.isVolumeValid(initialVolume)){this.setVideoVolume(initialVolume);}
var onVolumeChange=this.onVolumeChange;IV.Events.on("volumechange",onVolumeChange,this);};VideoVolumeHandler.prototype.unbindVolumeChangeEvent=function(){var onVolumeChange=this.onVolumeChange;IV.Events.off("volumechange",onVolumeChange);};return VideoVolumeHandler;})();IV.VideoVolumeHandler=VideoVolumeHandler;})(IV||(IV={}));
var IV;(function(IV){var ViewModeDetector=(function(){function ViewModeDetector(){}
ViewModeDetector.isPreviewMode=function(config){return _.isUndefined(config["placement-config"])||config["placement-config"]["placement-hash"]==="-1";};return ViewModeDetector;})();IV.ViewModeDetector=ViewModeDetector;})(IV||(IV={}));
var IV;(function(IV){var WindowOpener=(function(){function WindowOpener(){}
WindowOpener.openHtmlTagOnNewTab=function(htmlTag){var tab=window.open("about:blank","_blank");if(tab&&tab.document){tab.document.write(htmlTag);tab.document.close();}};return WindowOpener;})();IV.WindowOpener=WindowOpener;})(IV||(IV={}));
var IV;(function(IV){var ChildPlacementsTrackingEventDispatcher=(function(){function ChildPlacementsTrackingEventDispatcher(coreId){this.coreId=coreId;}
Object.defineProperty(ChildPlacementsTrackingEventDispatcher,"trackingEventMap",{get:function(){return{"init":"init","play":"playingStart","intrct":"adFirstInteraction","vpoint:25":"playingFirstQuartile","vpoint:50":"playingMidpoint","vpoint:75":"playingThirdQuartile","vpoint:100":"playingComplete"};},enumerable:true,configurable:true});ChildPlacementsTrackingEventDispatcher.prototype.trigger=function(action,eventValue,placementHash){var eventKey=action;if(action==="vpoint"){eventKey+=":"+eventValue;}
if(ChildPlacementsTrackingEventDispatcher.trackingEventMap.hasOwnProperty(eventKey)){IV.Events.trigger(this.coreId+":tracking:child:"+placementHash+":"+ChildPlacementsTrackingEventDispatcher.trackingEventMap[eventKey]);}};return ChildPlacementsTrackingEventDispatcher;})();IV.ChildPlacementsTrackingEventDispatcher=ChildPlacementsTrackingEventDispatcher;})(IV||(IV={}));
var IV;(function(IV){var ChildPlacementsTrackingEventListener=(function(){function ChildPlacementsTrackingEventListener(coreId){this.coreId=coreId;}
ChildPlacementsTrackingEventListener.prototype.start=function(childPlacementsTrackingMap,reporter){var _this=this;var childPlacementHashes=Object.keys(childPlacementsTrackingMap);childPlacementHashes.forEach(function(placementHash){var placementTrackingMap=childPlacementsTrackingMap[placementHash];var trackingEventTypes=Object.keys(placementTrackingMap);trackingEventTypes.forEach(function(trackingEventType){var trackingItems=placementTrackingMap[trackingEventType];IV.Events.on(_this.coreId+":tracking:child:"+placementHash+":"+trackingEventType,function(){return reporter.submit3rdPartyTracking(trackingItems);});});});};return ChildPlacementsTrackingEventListener;})();IV.ChildPlacementsTrackingEventListener=ChildPlacementsTrackingEventListener;})(IV||(IV={}));
var IV;(function(IV){var ChildVideoEventHandler=(function(){function ChildVideoEventHandler(coreId,childVideoService){this.coreId=coreId;this.childVideoService=childVideoService;this.triggerChildInteractEventOnce=_.once(this.triggerChildInteractEvent);}
ChildVideoEventHandler.prototype.handleRollover=function(element){$(element).on("mouseover",this.childAction(this.triggerChildInteractEventOnce));};ChildVideoEventHandler.prototype.bindActionToChildInteractEvent=function(reporter){var _this=this;IV.Events.on(this.coreId+":child:interact",_.once(function(){reporter.submit({action:"intrct"},_this.childVideoService.getChildVideoContext());}));};ChildVideoEventHandler.prototype.triggerChildInteractEvent=function(event,coreId){event.stopPropagation();if(IV.device.isDesktop()){IV.Events.trigger(coreId+":child:interact");}};ChildVideoEventHandler.prototype.childAction=function(action){var _this=this;return function(e){if(_this.childVideoService.childVideoPlaying()){action(e,_this.coreId);}
return false;};};return ChildVideoEventHandler;})();IV.ChildVideoEventHandler=ChildVideoEventHandler;})(IV||(IV={}));
var IV;(function(IV){var ChildVideoService=(function(){function ChildVideoService(){this.manualSelectionProjectState=ChildVideoService.DEFAULT_MANUAL_SELECTION_PROJECT_STATE;this.autoSelectionProjectState=ChildVideoService.DEFAULT_AUTO_SELECTION_PROJECT_STATE;this.populateChildVideoDataOnce=_.once(this.populateChildVideoData);}
Object.defineProperty(ChildVideoService,"MANUAL_SELECTION",{get:function(){return"manual_select_project_state";},enumerable:true,configurable:true});Object.defineProperty(ChildVideoService,"AUTO_SELECTION",{get:function(){return"auto_select_project_state";},enumerable:true,configurable:true});Object.defineProperty(ChildVideoService,"DEFAULT_MANUAL_SELECTION_PROJECT_STATE",{get:function(){return 8;},enumerable:true,configurable:true});Object.defineProperty(ChildVideoService,"DEFAULT_AUTO_SELECTION_PROJECT_STATE",{get:function(){return 10;},enumerable:true,configurable:true});ChildVideoService.prototype.initChildVideoData=function(options,context){this.populateChildVideoDataOnce(options,context);return this.childVideoData;};ChildVideoService.prototype.getChildVideoData=function(){return this.childVideoData;};ChildVideoService.prototype.childVideoPlaying=function(){return _.isObject(this.childVideoData);};ChildVideoService.prototype.getChildVideoContext=function(){return this.childVideoData.context;};ChildVideoService.prototype.setSelectionProjectStates=function(manualSelectionProjectState,autoSelectionProjectState){this.manualSelectionProjectState=manualSelectionProjectState;this.autoSelectionProjectState=autoSelectionProjectState;};ChildVideoService.prototype.populateChildVideoData=function(options,context){this.childVideoData={videoId:options.video_id,placementHash:options.placement_hash,context:context,projectState:this.getChildProjectState(context)};};ChildVideoService.prototype.getChildProjectState=function(context){var childProjectStateMap={};childProjectStateMap[ChildVideoService.MANUAL_SELECTION]=this.manualSelectionProjectState;childProjectStateMap[ChildVideoService.AUTO_SELECTION]=this.autoSelectionProjectState;return childProjectStateMap[context];};return ChildVideoService;})();IV.ChildVideoService=ChildVideoService;})(IV||(IV={}));
(function(SCOPE){var EnvironmentDetector=_.memoize(function(){this.isProd=function(){return SCOPE.baseData.environment==="prod";};});SCOPE.EnvironmentDetector=new EnvironmentDetector();})(IV||{});
(function(SCOPE){SCOPE.ErrorDetector=function(iRoll){var id=iRoll.get('id'),that=this;that.startListener=function(){SCOPE.Events.on(id+':video_error',function(e){var eventValue="";if(e&&(e.target instanceof HTMLMediaElement)){eventValue=e.target.error.code;}
that.trigger('video_error',eventValue);});SCOPE.Events.on(id+':video_source_error',function(e){var eventValue="";if(e&&(e.target instanceof HTMLSourceElement)){eventValue=e.target.parentNode.networkState;that.trigger('video_source_error',eventValue);}});SCOPE.Events.on(id+':video_high_buffering_count',function(count){that.trigger('video_high_buffering_count',count);});SCOPE.Events.on(id+':video_long_buffering_time',function(time){if(!isNaN(time)){that.trigger('video_long_buffering_time',time);}});SCOPE.Events.on(id+":ad_started",function(){var winSize=this.canvas.getSize();if(!winSize.width||!winSize.height){that.trigger('bad_window_size_at_video_start');}
if(this.get('checkForVisibility')){if(this.isHidden()){that.trigger('document_not_visible_at_video_start');}}
var now=_.now();var LATE_IMPRESSION_THRESHOLD_MS=3000;if(now-this.initTimestamp>LATE_IMPRESSION_THRESHOLD_MS){that.trigger('late_impression',LATE_IMPRESSION_THRESHOLD_MS);}
var VERY_LATE_IMPRESSION_THRESHOLD_MS=5000;if(now-this.initTimestamp>VERY_LATE_IMPRESSION_THRESHOLD_MS){that.trigger('very_late_impression',VERY_LATE_IMPRESSION_THRESHOLD_MS);}},iRoll);SCOPE.Events.on(id+':video_started',function(){var good_duration=true;var good_currentTime=true;if(iRoll.get('videoPlayer')){var duration=iRoll.get('videoPlayer').getDuration();var currentTime=iRoll.get('videoPlayer').getCurrentTime();good_duration=_.isNumber(duration)&&isFinite(duration);good_currentTime=_.isNumber(currentTime)&&isFinite(currentTime);var sendErrorReports=[sendDurationErrorReport,sendCurrentTimeErrorReport,sendDurationAndCurrentTimeErrorReport];sendErrorReports.forEach(function(sendErrorReport){sendErrorReport();});}
function sendDurationErrorReport(){if(!good_duration&&good_currentTime){that.trigger('video_bad_properties',"duration: "+duration);}}
function sendCurrentTimeErrorReport(){if(!good_currentTime&&good_duration){that.trigger('video_bad_properties',"currentTime: "+currentTime);}}
function sendDurationAndCurrentTimeErrorReport(){if(!good_duration&&!good_currentTime){that.trigger('video_bad_properties',"duration: "+duration+"; currentTime: "+currentTime);}}});SCOPE.Events.on(id+':container_error',function(message,action){var eventValue="";if(_.isString(action)){eventValue+="(Action:"+action+")";}
if(_.isString(message)){eventValue+="(Message:"+message+")";}
that.trigger('container_error',eventValue);});SCOPE.Events.on(id+':video_videoPassed75',function(){[25,50].forEach(function(vp){if(!iRoll.report.wasPixelLoaded({action:'vpoint',event_value:vp})){that.trigger('vpoint_missing',vp);}});});SCOPE.Events.on(id+":ad_interface_error",function(module,e){var msg=e.message?e.message.substr(0,500):"";that.trigger(module+"_error",msg);});SCOPE.Events.on(id+":video_timeupdate_event_missing",function(){that.trigger("video_timeupdate_event_missing");});SCOPE.Events.on(id+":vpaid_clickthru",function(playerHandles){that.trigger("vpaid_clickthru",playerHandles?"PLAYER_HANDLED":"AD_HANDLED");});SCOPE.Events.on(id+":viewability_iframe_type",function(iframeType){that.trigger("viewability_iframe_type",iframeType);});window.onerror=_.throttle(function(e){if(typeof e==="string"){that.trigger('js_error',e.substring(0,256))}},500);};};_.extend(SCOPE.ErrorDetector.prototype,Backbone.Events);})(IV);
(function(SCOPE){SCOPE.Session=function(config){var sampleRateRec=getSampleRateRecord(config);var debugSampleRateRec=getDebugSampleRateRecord();this.isMonitored=function(){return sampleRateRec.isMonitored;};this.getSampleRate=function(){return sampleRateRec.sampleRate;};this.isDebugEnabled=function(){return debugSampleRateRec.isDebugEnabled;};this.getCreativeSampleRate=function(){return debugSampleRateRec.sampleRate;};function getSampleRateRecord(config){var sampleRate=0,isMonitored=false;if(SCOPE.ViewModeDetector.isPreviewMode(config)){sampleRate=1;isMonitored=true;}else if(config["error-monitoring-enabled"]){sampleRate=toSampleRate(config["error-monitoring-rate"]||0);isMonitored=flipCoin(sampleRate);}
return{sampleRate:sampleRate,isMonitored:isMonitored};}
function getDebugSampleRateRecord(){var sampleRate=0.01,isDebugEnabled=false;var configSampleRate=SCOPE.baseData.app_data["debug-sample-rate"];if(SCOPE.ViewModeDetector.isPreviewMode(config)){sampleRate=1;isDebugEnabled=true;}else if(typeof configSampleRate==="number"&&(configSampleRate>=0&&configSampleRate<=100)&&configSampleRate){sampleRate=toSampleRate(SCOPE.baseData.app_data["debug-sample-rate"]);isDebugEnabled=flipCoin(sampleRate);}
return{sampleRate:sampleRate,isDebugEnabled:isDebugEnabled};}
function toSampleRate(val){var rate=val|0;return rate/100.0;}
function flipCoin(sampleRate){var rand=Math.random(),result=false;if(rand<sampleRate){result=true;}
return result;}};_.extend(SCOPE.Session.prototype,Backbone.Events);})(IV);
(function(SCOPE){SCOPE.Canvas=function(iroll,canvasAppender){var el=document.createElement("DIV"),defaultFontSize=16,that=this,currentWidth,currentHeight,currentOrientation;el.id="iv-iroll";canvasAppender.appendToContainer(el);iroll.childVideoEventHandler.handleRollover(el);$(el).one('mouseover',"*",function(event){event.stopPropagation();if(SCOPE.device.isDesktop()){SCOPE.Events.trigger(iroll.get('id')+':interact');}});function init(){var adSize=that.getSize();currentWidth=adSize.width;currentHeight=adSize.height;currentOrientation=SCOPE.device.getDeviceOrientation(adSize.width,adSize.height);setInterval(monitorWindowWidth,500);if(typeof $.fn.registerTouch==='function'){$(el).registerTouch();}
$(el).attr("platform-type",SCOPE.device.getPlatformType());$(el).attr("os-type",SCOPE.device.getOSType());addMouseCaptureOverlay();}
function monitorWindowWidth(){var adSize=that.getSize();if(currentWidth!==adSize.width||currentHeight!==adSize.height){currentWidth=adSize.width;currentHeight=adSize.height;SCOPE.Events.trigger('winResize');}
var newOrientation=SCOPE.device.getDeviceOrientation(adSize.width,adSize.height);if(currentOrientation!==newOrientation){currentOrientation=newOrientation;SCOPE.Events.trigger('orientationChange');}
$(el).attr("orientation",newOrientation);}
function addMouseCaptureOverlay(){var overlay=buildResponsiveContainer();overlay.addClass("iv-mouse-capture-overlay");$(el).append(overlay);$(overlay).on(iroll.getVideoClickEventType(),function(ev){SCOPE.Events.trigger("video_click",ev);});$(overlay).on("touchmove",function(ev){ev.preventDefault();})}
function buildResponsiveContainer(className){var cont=$('<div/>'),sizes=that.getSize();cont.addClass(className);cont.width(sizes.width).height(sizes.height);SCOPE.Events.on('winResize',function(){var newSizes=that.getSize();cont.width(newSizes.width).height(newSizes.height);});return cont;}
this.addElement=function(elem){if(elem){$(el).append(elem);}};this.addResponsiveElement=function(elem){if(elem){var cont=buildResponsiveContainer("iv-elem-cont");cont.append(elem);$(el).append(cont);}};this.getSize=function(){return canvasAppender.getSize();};this.getScale=function(){var adSize=this.getSize(),config=iroll.get('config'),platformScale=SCOPE.toolkit.getPlatformScaleParameter(config.platformScaling)
var maxAdDimension=Math.max(adSize.width,adSize.height),adScale=maxAdDimension/config.previewParam.width;return adScale/platformScale;};this.getDefaultFontSize=function(){return defaultFontSize};this.setScale=function(scale){$(el).css({fontSize:scale});};this.remove=function(){if(el!==null){while(el.firstChild){el.removeChild(el.firstChild);}
el.parentNode.removeChild(el);el=null;}};this.injectCss=function(cssPath){var ownerDoc=el.ownerDocument;var linkRef=ownerDoc.createElement("link");linkRef.setAttribute("rel","stylesheet");linkRef.setAttribute("type","text/css");linkRef.setAttribute("href",cssPath);(ownerDoc.head||ownerDoc.getElementsByTagName("head")[0]).appendChild(linkRef);};this.registerInteractEvent=function(){$(el).on(iroll.get('mainEngagementEvent'),"*",function(event){event.stopPropagation();$(event.currentTarget).trigger("interact",event);});$(el).on(iroll.getVideoClickEventType(),"*",function(event){event.stopPropagation();$(event.currentTarget).trigger("interact-to-play",event);});};init.apply(this);};})(IV);
(function(SCOPE){SCOPE.AppsCore=Backbone.Model.extend({defaults:{contextWindow:window,sendLogs:false,playStartTime:null,interface:null,debug:false,autoscale:false,appPath:'',servicePath:'',nonCdnServicePath:'',reportUrl:'',errorReportUrl:'',runtimeConfigUrl:'',version:'unknown',el:null,mainContainer:null,videoContainer:null,appsContainer:null,durationBar:null,plugins:{},data:{},config:{},toolbar:null,id:null,sysLog:[],CloseButton:false,BackButton:false,CloseButtonTimeout:5000,windowOpen:null,appModeCustomEvents:{iOSPauseURL:'EXTENSION_STOP',iOSPlayURL:'EXTENSION_PLAY',iOSClickThrewURL:'EXTENSION_OPEN_URL:'},showClickToResume:true,delayAppVisibility:true,mainEngagementEvent:'tap',displayVideo:true,supportHLS:true,inlinePlaybackForced:false,videoPlayer:null,enableErrorReporting:true,checkForVisibility:false,linearOverStream:false,reportDummyErrorPixel:false,sessionMonitoringRate:1,reportImpressionsToLog:true,reportEventsToConsole:false,initialized:false,waitForCreativeToLoad:false,wrapCreativeWithIframe:false},canvas:null,session:null,report:null,errorDetector:null,videoClickHandler:null,initTimestamp:0,progressReporter:null,macroMapper:null,childVideoService:null,childVideoEventHandler:null,childPlacementsTrackingEventListener:null,clickthruDecorator:null,inAppDetector:null,initialize:function(){var that=this,baseData=SCOPE.baseData;if(!this.get('autoscale')){$('head').append('<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, '+'minimum-scale=1, width=device-width, target-densitydpi=device-dpi">');}
new SCOPE.DataInjector().injectCustomParams(this);this.set({'appPath':baseData.appPath,'servicePath':baseData.servicePath,'nonCdnServicePath':baseData.nonCdnServicePath,'cssPath':baseData.cssPath,'reportUrl':baseData.reportUrl,'errorReportUrl':baseData.errorReportUrl,'runtimeConfigUrl':baseData.runtimeConfigUrl,'version':baseData.mobileCoreVersion});this.set('id',_.uniqueId('IV_'));if(!this.get('sendLogs')){this.bindTrackingEvents();}
var placementConfig=this.get('data')['placement-config'];var videoFormat=placementConfig?placementConfig['video-format']:"";var factory=new SCOPE.CoreFactory(videoFormat);this.set("canvasAppender",factory.createCanvasAppender(this));this.session=new SCOPE.Session(baseData.app_data);this.macroMapper=new SCOPE.MacroMapper(this.get('data'));var iframeInjector=new SCOPE.FriendlyIframeInjector(SCOPE.ThirdPartyTrackingReporter.THIRD_PARTY_TRACKING_IFRAME_ID);var htmlTagInjector=new SCOPE.HtmlTextTagInjector(iframeInjector);var thirdPartyTrackingReporter=new SCOPE.ThirdPartyTrackingReporter(htmlTagInjector,this.macroMapper);var childPlacementsTrackingEventDispatcher=new SCOPE.ChildPlacementsTrackingEventDispatcher(this.get('id'));this.childVideoService=new SCOPE.ChildVideoService();this.childVideoEventHandler=new SCOPE.ChildVideoEventHandler(this.get('id'),this.childVideoService);this.childPlacementsTrackingEventListener=new SCOPE.ChildPlacementsTrackingEventListener(this.get('id'));var getStartTimeFunc=function(){return that.get("playStartTime");};this.report=this.report||factory.createReporter(this,thirdPartyTrackingReporter,childPlacementsTrackingEventDispatcher);var clickthruRedirectHelper=factory.createClickRedirectHelper(this,getStartTimeFunc);this.clickthruDecorator=factory.createClickthruDecorator(this,clickthruRedirectHelper);this.inAppDetector=new SCOPE.InAppDetector(IV.device);this.bindErrorEvents();this.on('init',function(){that.bindAnalyticsEvents();that.bindSystemEvents();that.bindChildPlacementsTrackingEvents();var id=that.get('id');SCOPE.Events.on(id+':video_videoPassed1Sec',function(){if(that.get('delayAppVisibility')){$(".iv-in-app-icon, #iv-tray, .iv-floating-icon-container").css({"visibility":"visible"});}});that.createCanvas();SCOPE.Events.trigger("IRollInit",that);that.initTimestamp=new Date().getTime();if(!that.shouldWaitForCreativeToLoad()){that.set('initialized',true);SCOPE.Events.trigger(id+':core_initialized',that);}});SCOPE.Events.on(this.get('id')+':appClickThru',function(){if(this.get('videoPlayer')&&this.get('videoPlayer').isPlaying()){this.get('videoPlayer').pause();}},that);},shouldWaitForCreativeToLoad:function(){return!!this.get("waitForCreativeToLoad");},shouldWrapCreativeWithIframe:function(){return!!this.get("wrapCreativeWithIframe");},setAttribute:function(attrs){if(_.isObject(attrs)){this.set(attrs,{silent:true});}},$log:function(){if(this.get('debug')){}},injectVideo:function(){var data=this.get('data'),that=this;if(!this.has('videoPlayer')){this.set('videoPlayer',new SCOPE.InternalVideoPlayer(this));}
this.get('videoPlayer').init(data,this);if(data.video){this.loadVideoSource(data.video.renditions,this);}},loadVideoSource:function(renditions){if(this.get('linearOverStream')!==true){this.get('videoPlayer').loadVideoSource(renditions);}},injectCSSToDoc:function(){this.canvas.injectCss(this.get('cssPath'));},removeVideo:function(){if(this.get('videoPlayer')){this.get('videoPlayer').pause();}},cleanUp:function(){SCOPE.Events.off();if(this.get('videoPlayer')&&typeof this.get('videoPlayer').cleanUp==='function'){this.get('videoPlayer').cleanUp();}
this.canvas.remove();},initAppsSystem:function(){var that=this;if(this.get('reportDummyErrorPixel')){this.report.reportLog({event_id:'dummy'});}
if(this.get('displayVideo')){this.injectVideo();}
this.videoClickHandler=new SCOPE.VideoClickHandler(this,SCOPE.baseData,SCOPE.Events,this.macroMapper);this.get('videoPlayer').on("interact",function(ev){that.videoClickHandler.handleClick(ev);});SCOPE.Events.trigger('IRollReady',this,this.get('data'));SCOPE.Events.trigger(this.get('id')+':impression',this);},createCanvas:function(){var canvasContainer=null;if(_.isNull(this.get("mainContainer"))){canvasContainer=document.body;}else{canvasContainer=this.get("mainContainer");}
var canvasAppender=this.get("canvasAppender");canvasAppender.setContainer(canvasContainer);this.canvas=new SCOPE.Canvas(this,canvasAppender);},windowOpen:function(url,label){var sessionId=this.report.get('reportData')['session_id'];url=this.clickthruDecorator.decorate(url,label,sessionId);SCOPE.Events.trigger(this.get('id')+':openUrl',url);SCOPE.Events.trigger(this.get('id')+':appClickThru',url);if(_.isFunction(this.get('interface')['windowOpen'])){this.get('interface')['windowOpen'](url);}},supportFeature:function(feature){var externalInterface=this.get('interface');if(externalInterface!==null&&typeof externalInterface.supports==='function'){return externalInterface.supports(feature);}else{return false;}},onInteract:function(elem,func){elem.on(this.get('mainEngagementEvent'),func);},reportEngage:function(eventId){var that=this;that.report.submit({action:'engage',event_id:eventId});SCOPE.Events.trigger(that.get('id')+":engage");},reportInteract:function(){this.report.submit({action:'intrct'});this.fireTrackingEvent('adFirstInteraction');},bindAnalyticsEvents:function(){var that=this,id=this.get('id'),playFired=false,engaged=false,interactedBeforePlay=false,customMetrics=that.get('data').customMetrics;SCOPE.Events.on(id+':userClick',function(){if(engaged){return;}
engaged=true;that.reportEngage('user');});SCOPE.Events.on(id+':auto_engage',function(){if(engaged){return;}
engaged=true;that.reportEngage('default');});SCOPE.Events.on(id+':core_initialized',function(){var adSize=that.canvas.getSize();that.report.submit({action:'init',size:parseInt(adSize.width)+'x'+parseInt(adSize.height)});});SCOPE.Events.on(id+':interact',_.once(function(){if(playFired){that.reportInteract();}
else{interactedBeforePlay=true;}}));this.childVideoEventHandler.bindActionToChildInteractEvent(that.report);this.progressReporter=new SCOPE.AdProgressReporter(id,this.report,customMetrics,this.fireTrackingEvent.bind(this));this.progressReporter.startReporting(function(){playFired=true;that.set({playStartTime:new Date().getTime()});if(that.get('reportImpressionsToLog')){that.report.reportLog({event_id:'impression',event_value:Date.now()});}
if(interactedBeforePlay){that.reportInteract();}});},bindSystemEvents:function(){SCOPE.Events.on('appsDataReady',this.initAppsSystem,this);SCOPE.Events.on('startApps',this.initAppsSystem,this);SCOPE.Events.on('orientationchange',function(){SCOPE.Events.trigger('repaint');});this.on('start',this.initAppsSystem,this);},bindTrackingEvents:function(){var that=this,id=this.get('id');var eventsList={};if(_.isObject(this.get('data')['placement-config'])){eventsList=this.get('data')['placement-config']['tracking-events'];}
_.forEach(eventsList,function(trackingItems,eventName){var handler=_.bind(that.reportTrackingEvent,that,eventName,trackingItems);SCOPE.Events.on(id+':tracking:'+eventName,handler);});},bindChildPlacementsTrackingEvents:function(){var placementConfig=this.get('data')['placement-config'];if(_.isObject(placementConfig)){var childPlacementsTracking=placementConfig['child-placements-tracking'];if(_.isObject(childPlacementsTracking)){this.childPlacementsTrackingEventListener.start(childPlacementsTracking,this.report);}}},bindErrorEvents:function(){this.errorDetector=new SCOPE.ErrorDetector(this);this.errorDetector.on("all",function(eventId,eventValue){this.report.reportLog({event_id:eventId,event_value:eventValue||''});},this);this.errorDetector.startListener();},fireTrackingEvent:function(eventName){var id=this.get('id'),event=id+':tracking:'+eventName;SCOPE.Events.trigger(event);},reportTrackingEvent:function(eventName,trackingItems){this.report.submit3rdPartyTracking(trackingItems);},getVideoClickEventType:function(){if(SCOPE.device.needsClickEventToPlay()){return'click';}else{return this.get('mainEngagementEvent');}},isHidden:function(){var prop=SCOPE.device.getHiddenProp();if(!prop)return false;return document[prop];},shouldForceInternalPlayer:function(){return this.get("data").forceInternalPlayer||(this.get("data").forceInternalPlayerOnDesktopOnly&&SCOPE.device.isDesktop());},isResponsive:function(){var ECP_RESPONSIVE_KEY="ivc_responsive";var EFP_RESPONSIVE_KEY="iv_responsive";var appData=this.get("data");var customData=appData[SCOPE.DataInjector.HTML_DATA];var ecpParams=customData?customData[SCOPE.DataInjector.EXTERNAL_CUSTOM_PARAMETERS]:{};var efpParams=customData?customData[SCOPE.DataInjector.EXTERNAL_FEED_PARAMETERS]:{};var isResponsiveByEcp=ecpParams&&ecpParams[ECP_RESPONSIVE_KEY]&&ecpParams[ECP_RESPONSIVE_KEY]==="1";var isResponsiveByEfp=efpParams&&efpParams[EFP_RESPONSIVE_KEY]&&efpParams[EFP_RESPONSIVE_KEY]==="1";return isResponsiveByEcp||isResponsiveByEfp;}});})(IV);
(function(SCOPE){SCOPE.CoreFactory=function(videoFormat){videoFormat=videoFormat||"";this.createReporter=function(core,thirdPartyTrackingReporter,childPlacementsTrackingEventDispatcher){if(SCOPE.FormatDetector.isDisplayAd(videoFormat)){return new SCOPE.DisplayReportAnalytics({instance:core.toJSON(),instanceClass:core,session:core.session,thirdPartyTrackingReporter:thirdPartyTrackingReporter,childVideoService:core.childVideoService,childPlacementsTrackingEventDispatcher:childPlacementsTrackingEventDispatcher});}else{return new SCOPE.reportAnalytics({instance:core.toJSON(),instanceClass:core,session:core.session,thirdPartyTrackingReporter:thirdPartyTrackingReporter,childVideoService:core.childVideoService,childPlacementsTrackingEventDispatcher:childPlacementsTrackingEventDispatcher});}};this.createClickRedirectHelper=function(core,getStartTimeFunc){if(SCOPE.FormatDetector.isDisplayAd(videoFormat)){return new SCOPE.DisplayClickthruRedirectHelper(SCOPE.baseData,core.report,getStartTimeFunc,core.macroMapper);}else{return new SCOPE.ClickthruRedirectHelper(SCOPE.baseData,core.report,getStartTimeFunc);}};this.createClickthruDecorator=function(core,clickthruRedirectHelper){return new SCOPE.CoreClickthruDecorator(core.macroMapper,clickthruRedirectHelper);}
this.createCanvasAppender=function(core){if(SCOPE.FormatDetector.isDisplayAd(videoFormat)){return new SCOPE.DisplayCanvasAppender(core);}else{return new SCOPE.CanvasAppender(core);}}};})(IV);
(function(SCOPE){SCOPE.CurrentScriptPopulator.populateCurrentScript(document);})(IV);
(function(SCOPE){if(_.isUndefined(SCOPE.Events)){SCOPE.Events=function(){};_.extend(SCOPE.Events,Backbone.Events);}})(IV);
(function(SCOPE){SCOPE.Events.on("IRollInit",function(core){try{var heavyAdsReporter=new SCOPE.HeavyAdsReporter(window,core.report,SCOPE.baseData);var reportingApiObserver=new SCOPE.ReportingApiObserver(window,heavyAdsReporter);if(reportingApiObserver.isObserverInitSuccessfully()){var reportingApiListener=new SCOPE.ReportingApiListener(window,heavyAdsReporter,reportingApiObserver);var heavyAdsMessageListener=new SCOPE.HeavyAdsMessageListener(window,heavyAdsReporter,reportingApiObserver);reportingApiListener.startListening();heavyAdsMessageListener.startListening();}}catch(err){heavyAdsReporter.reportReportingApiError("reportingApiInitializer: "+err.message);}});}(IV));
(function(SCOPE){SCOPE.VideoSpy=function(videoElem){this.videoElem=videoElem;this.state=null;var instance=this,activityLog=new SCOPE.ActivityLog(),passedPoints={pass1sec:false,pass25:false,pass50:false,pass75:false,cvv:false},customPoint=null,lastPlayingTime=0,timeUpdateIntervalId=0,timeUpdateEventFired=false,lastTimeUpdated=0;this.MAX_BUFFERING_TIMES_AFTER_STALLED=2;this.MAX_BUFFERING_COUNT=5;this.MAX_BUFFERING_TIMES=[4000,6000,8000];this.SHORT_BUFFERING_TIME=200;this.setCustomPoint=function(time){customPoint=time};function fireEvent(eventName,newState,ev){instance.trigger(eventName,ev);if(newState)
{if(isValidState(newState))
{instance.state=newState;activityLog.log(newState);}
else
{throw("invalid video state");}}}
function fireErrorEvent(errorType,ev){instance.trigger(errorType,ev);}
function isValidState(state){var validStates=['playing','paused','ended'];return(validStates.indexOf(state)!=-1);}
function onTimeUpdate(elem,ev){timeUpdateEventFired=true;updateTime(elem,ev);}
function playingHeartbeat(currentTime){lastPlayingTime=currentTime;activityLog.log('playing');}
function setPassedPoint(currentTime,duration){var currentProgress=100*currentTime/duration;if(currentTime>1&&!passedPoints.pass1sec){passedPoints.pass1sec=true;fireEvent('video_videoPassed1Sec',null);}
if(currentProgress>25&&!passedPoints.pass25){passedPoints.pass25=true;fireEvent('video_videoPassed25',null);}
if(currentProgress>50&&!passedPoints.pass50){passedPoints.pass50=true;fireEvent('video_videoPassed50',null);}
if(currentProgress>75&&!passedPoints.pass75){passedPoints.pass75=true;fireEvent('video_videoPassed75',null);}
if(customPoint!==null){if(currentTime>customPoint&&!passedPoints.cvv){passedPoints.cvv=true;fireEvent('video_videoPassedCustomPoint',null);}}}
function startBackupTimeUpdate(){timeUpdateIntervalId=setInterval(updateTime.bind({},videoElem),500);}
function stopBackupTimeUpdate(){if(timeUpdateIntervalId)clearInterval(timeUpdateIntervalId);timeUpdateIntervalId=0;}
function missingTimeUpdateCheck(){if(!timeUpdateEventFired)instance.trigger("video_timeupdate_event_missing");}
function updateTime(elem,ev){if(lastTimeUpdated!==elem.getCurrentTime()&&isFinite(elem.getCurrentTime())&&!isNaN(elem.getCurrentTime())){lastTimeUpdated=elem.getCurrentTime();var tDelta=(elem.getCurrentTime()-lastPlayingTime);if(tDelta>1.0){playingHeartbeat(elem.getCurrentTime());}
setPassedPoint(elem.getCurrentTime(),elem.getDuration());var data={"currentTime":elem.getCurrentTime(),"duration":elem.getDuration(),"ev":ev};fireEvent('video_timeupdate',null,data);}}
videoElem.on('stalled',function(){if(instance.state!=="paused"){activityLog.log('buffering');fireEvent("buffering",null);videoElem.on('timeupdate',_.after(instance.MAX_BUFFERING_TIMES_AFTER_STALLED,_.once(fireEvent.bind({},'not_buffering',null))));}});videoElem.on('waiting',function(){if(instance.state!=="paused"){activityLog.log('buffering');fireEvent("buffering",null);}});videoElem.on('playing',function(){activityLog.log('playing');});videoElem.on('playing',_.once(startBackupTimeUpdate));videoElem.on('ended',stopBackupTimeUpdate);videoElem.on('ended',missingTimeUpdateCheck);videoElem.on('durationchange',fireEvent.bind({},'video_durationchange',null));videoElem.on('playing',fireEvent.bind({},'video_play','playing'));videoElem.on('playing',_.once(fireEvent.bind({},'video_started',null)));videoElem.on('pause',fireEvent.bind({},'video_pause','paused'));videoElem.on('timeupdate',onTimeUpdate.bind({},videoElem));videoElem.on('ended',fireEvent.bind({},'video_ended','ended'));videoElem.on('webkitendfullscreen',fireEvent.bind({},'video_exitfullscreen',null));videoElem.on('error',fireErrorEvent.bind({},'video_error'));_.each(videoElem.getAllSourceChildren(),function(elem){$(elem).on('error',fireErrorEvent.bind({},'video_source_error'));});activityLog.onCount('buffering',this.MAX_BUFFERING_COUNT,fireErrorEvent.bind({},'video_high_buffering_count',this.MAX_BUFFERING_COUNT));_.each(this.MAX_BUFFERING_TIMES,function(time){activityLog.onTime('buffering',time,fireErrorEvent.bind({},'video_long_buffering_time',time));});activityLog.onTime('buffering',this.SHORT_BUFFERING_TIME,fireEvent.bind({},"video_short_buffering_time",null));};_.extend(SCOPE.VideoSpy.prototype,Backbone.Events);})(IV);
var IV;(function(IV){var InterventionsListener=(function(){function InterventionsListener(win,reporter){this.win=win;this.reporter=reporter;}
return InterventionsListener;})();IV.InterventionsListener=InterventionsListener;})(IV||(IV={}));
var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var IV;(function(IV){var HeavyAdsMessageListener=(function(_super){__extends(HeavyAdsMessageListener,_super);function HeavyAdsMessageListener(){var _this=this;_super.apply(this,arguments);this.onMessageEvent=function(message){try{if(typeof message.data!=="string"||message.data.indexOf(HeavyAdsMessageListener.HEAVY_ADS_INTERVENTION_ID)===-1){return;}
_this.reporter.reportHeavyAdsIntervention([JSON.parse(message.data)]);}
catch(err){_this.reporter.reportReportingApiError("onMessageEvent: "+err.message);}};}
Object.defineProperty(HeavyAdsMessageListener,"HEAVY_ADS_INTERVENTION_ID",{get:function(){return"HeavyAdIntervention";},enumerable:true,configurable:true});HeavyAdsMessageListener.prototype.startListening=function(){this.win.addEventListener("message",this.onMessageEvent,false);};return HeavyAdsMessageListener;})(IV.InterventionsListener);IV.HeavyAdsMessageListener=HeavyAdsMessageListener;})(IV||(IV={}));
var IV;(function(IV){var HeavyAdsReporter=(function(){function HeavyAdsReporter(win,reporter,adConfig){var _this=this;this.reportHeavyAdsInterventionOnce=_.once(function(report){var data=_this.reporter.prepareReportData();_this.win.navigator.sendBeacon(_this.buildHeavyAdsInterventionUrl(data),_this.buildHeavyAdsReportData(data,report));});this.win=win;this.reporter=reporter;this.adConfig=adConfig;}
Object.defineProperty(HeavyAdsReporter,"EVENT_VALUE_MAX_LENGTH",{get:function(){return 250;},enumerable:true,configurable:true});Object.defineProperty(HeavyAdsReporter,"ERROR_ACTION",{get:function(){return"error";},enumerable:true,configurable:true});Object.defineProperty(HeavyAdsReporter,"INTERVENTION_EVENT_ID",{get:function(){return{"display":"display_heavy_ads_error","video":"vpaid_heavy_ads_error","unknown":"unknown_heavy_ads_error"};},enumerable:true,configurable:true});HeavyAdsReporter.prototype.reportReportingApiError=function(error){this.reporter.submit({action:HeavyAdsReporter.ERROR_ACTION,event_id:"reporting-api",event_value:error.substring(0,250)});};HeavyAdsReporter.prototype.reportHeavyAdsIntervention=function(reports){if(Array.isArray(reports)){for(var _i=0;_i<reports.length;_i++){var report=reports[_i];if(report.body&&report.body.id==="HeavyAdIntervention"){if(this.win.navigator&&this.win.navigator.sendBeacon){this.reportHeavyAdsInterventionOnce(report);break;}}}}};HeavyAdsReporter.prototype.buildHeavyAdsReportData=function(data,report){var reportData=new this.win.FormData();this.updateHeavyAdsInterventionData(data,report);for(var key in data){if(data.hasOwnProperty(key)){reportData.append(key,data[key]);}}
return reportData;};HeavyAdsReporter.prototype.buildHeavyAdsInterventionUrl=function(data){return this.adConfig.dtsUrl+"/placement/"+data.placement_hash+"/action/error";};HeavyAdsReporter.prototype.updateHeavyAdsInterventionData=function(data,report){data.action=HeavyAdsReporter.ERROR_ACTION;data.event_id=HeavyAdsReporter.INTERVENTION_EVENT_ID[data.format]||HeavyAdsReporter.INTERVENTION_EVENT_ID.unknown;data.event_value=this.buildEventValue(report);};HeavyAdsReporter.prototype.buildEventValue=function(report){var eventValue=this.extractDomainFromUrl(report.url)+" "+report.body.message;return encodeURIComponent(eventValue).substring(0,HeavyAdsReporter.EVENT_VALUE_MAX_LENGTH);};HeavyAdsReporter.prototype.extractDomainFromUrl=function(url){var element=this.win.document.createElement("a");element.href=url;return element.hostname;};return HeavyAdsReporter;})();IV.HeavyAdsReporter=HeavyAdsReporter;})(IV||(IV={}));
var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var IV;(function(IV){var ReportingApiListener=(function(_super){__extends(ReportingApiListener,_super);function ReportingApiListener(win,reporter,observer){var _this=this;_super.call(this,win,reporter);this.onUnloadEvent=function(){try{var reports=_this.observer.takeRecords();_this.reporter.reportHeavyAdsIntervention(reports);_this.observer.disconnect();}
catch(err){_this.reporter.reportReportingApiError("listenOnUnload: "+err.message);}
_this.win.removeEventListener("unload",_this.onUnloadEvent,false);};this.observer=observer;}
Object.defineProperty(ReportingApiListener,"INTERVENTION_TYPE",{get:function(){return"intervention";},enumerable:true,configurable:true});ReportingApiListener.prototype.startListening=function(){this.observer.observe();this.win.addEventListener("unload",this.onUnloadEvent,false);};return ReportingApiListener;})(IV.InterventionsListener);IV.ReportingApiListener=ReportingApiListener;})(IV||(IV={}));
var IV;(function(IV){var ReportingApiObserver=(function(){function ReportingApiObserver(win,reporter){var _this=this;this.observerCb=function(reports){try{_this.reporter.reportHeavyAdsIntervention(reports);}
catch(err){_this.reporter.reportReportingApiError("observerCb: "+err.message);}};this.win=win;this.reporter=reporter;this.initObserver();}
ReportingApiObserver.prototype.isObserverInitSuccessfully=function(){return typeof this.observer!=="undefined";};ReportingApiObserver.prototype.takeRecords=function(){return this.isObserverInitSuccessfully()?this.observer.takeRecords():[];};ReportingApiObserver.prototype.disconnect=function(){if(this.isObserverInitSuccessfully()){this.observer.disconnect();}};ReportingApiObserver.prototype.observe=function(){if(this.isObserverInitSuccessfully()){this.observer.observe();}};ReportingApiObserver.prototype.initObserver=function(){try{if(typeof this.win.ReportingObserver!=="undefined"){this.observer=new this.win.ReportingObserver(this.observerCb,{types:[IV.ReportingApiListener.INTERVENTION_TYPE],buffered:true});}}
catch(err){this.reporter.reportReportingApiError("initObserver: "+err.message);}};return ReportingApiObserver;})();IV.ReportingApiObserver=ReportingApiObserver;})(IV||(IV={}));
(function(SCOPE){SCOPE.ActivityLog=function(){var eventsMap=[],countListeners=[],timers=[],runningTimers=[];this.log=function(event){var now=new Date().getTime(),newCount;if(this.has(event)){newCount=++eventsMap[event].count;eventsMap[event].time=now;}else{newCount=1;eventsMap[event]={"count":newCount,"time":now};}
resetAllTimers();startEventTimers(event);notifyCountListeners(event,newCount);return this;};this.getCount=function(event){var count=0;if(this.has(event)){count=eventsMap[event].count;}
return count;};this.has=function(event){return event in eventsMap;};this.onCount=function(event,count,cb,context){if(!(event in countListeners)){countListeners[event]=[];}
if(!(count in countListeners[event])){countListeners[event][count]=[];}
countListeners[event][count].push({"callback":cb,"context":context});};this.onTime=function(event,time,cb,context){if(!(event in timers)){timers[event]=[];}
timers[event].push({"time":time,"cb":cb,"context":context});};function notifyCountListeners(ev,count){if(ev in countListeners&&count in countListeners[ev]){for(var cb in countListeners[ev][count]){if(countListeners[ev][count].hasOwnProperty(cb)){var listenerObj=countListeners[ev][count][cb];var context=listenerObj.context!=='undefined'?listenerObj.context:null;listenerObj.callback.call(context,ev,count);}}}}
function resetAllTimers(){for(var i=0;i<runningTimers.length;i++){if(typeof runningTimers[i]==="number"){clearTimeout(runningTimers[i]);}}}
function startEventTimers(ev){if(ev in timers){for(var i=0;i<timers[ev].length;i++){var job=timers[ev][i];var taskId=createTimeoutTask(job.cb,job.context,job.time);runningTimers.push(taskId);}}}
function createTimeoutTask(cb,context,time){return setTimeout(function(){cb.apply(context)},time);}};})(IV);
(function(SCOPE){var device=function(){var that=this;this.getPlatformType=_.memoize(function(){var ua=that.getNavigatorUserAgent();return ua.match(/GoogleTV|SmartTV|Internet.TV|NetCast|NETTV|AppleTV|boxee|Kylo|Roku|DLNADOC|CE\-HTML/i)?'tv':ua.match(/Xbox|PLAYSTATION.3|PLAYSTATION.4|Wii/i)?'tv':ua.match(/iPad/i)||ua.match(/tablet/i)&&!ua.match(/RX-34/i)||ua.match(/FOLIO/i)?'tablet':ua.match(/Linux/i)&&ua.match(/Android/i)&&!ua.match(/Fennec|mobi|HTC.Magic|HTCX06HT|Nexus.One|SC-02B|fone.945/i)?'tablet':ua.match(/Kindle/i)||ua.match(/Mac.OS/i)&&ua.match(/Silk/i)?'tablet':ua.match(/Opera/i)&&ua.match(/Windows.NT.5/i)&&ua.match(/HTC|Xda|Mini|Vario|SAMSUNG\-GT\-i8000|SAMSUNG\-SGH\-i9/i)?'mobile':ua.match(/Windows.(NT|XP|ME|9)/)&&!ua.match(/Phone/i)||ua.match(/Win(9|.9|NT)/i)?'desktop':ua.match(/Macintosh|PowerPC/i)&&!ua.match(/Silk/i)?'desktop':ua.match(/Linux/i)&&ua.match(/X11/i)?'desktop':ua.match(/Solaris|SunOS|BSD/i)?'desktop':'mobile';});this.isAndroid=function(){var userAgent=this.getNavigatorUserAgent();return(userAgent.match(/android/i)!==null);};this.is_iOS=function(){var userAgent=this.getNavigatorUserAgent();return userAgent.match('iPod')||userAgent.match('iPhone')||userAgent.match('iPad');};this.getOSType=function(){if(this.is_iOS()){return"ios";}
else if(this.isAndroid()){return"android";}
else{return"other"}};this.isFirefoxBrowser=_.memoize(function(){var userAgent=that.getNavigatorUserAgent();return userAgent.match(/Firefox/i)&&!userAgent.match(/Seamonkey/i);});this.getDeviceName=function(){var userAgent=this.getNavigatorUserAgent();if(userAgent.match('iPod')){return'iPod';}else if(userAgent.match('iPad')){return'iPad';}else if(userAgent.match('iPhone')){return'iPhone';}else if(userAgent.match(/android/i)){return'Android';}else if(this.isDesktop()){return'Desktop';}
return undefined;};this.isDeviceHLSSupported=function(){if(this.is_iOS()){return true;}else if(this.isAndroid()&&versionAtLeastAsNewAs(this.getAndroidOSVersion(),"5.0")){return true;}
return false;};this.isDesktop=function(){return this.getPlatformType()==="desktop";};this.getDeviceInformation=function(){var device,resolution,version,orientation,os;var userAgent=this.getNavigatorUserAgent();if(userAgent.match('iPod')){device='iPod';os='iOS';}else if(userAgent.match('iPad')){device='iPad';os='iOS';}else if(userAgent.match('iPhone')){device='iPhone';os='iOS';}else if(userAgent.match(/android/i)){device='Android';os='Android';}
else{return userAgent;}
resolution='('+window.screen.width+'x'+window.screen.height+')';if(os=="iOS"){version=this.getiPhoneOSVersion();}else if(os=="Android"){version=this.getAndroidOSVersion();}
orientation=this.getDeviceOrientation();return[device,resolution,version,orientation].join(', ');};this.getWebsiteHost=function(){var website;try{website=this.getLocationHost();}catch(e){}
if(_.isUndefined(website)){website=getHostName(document.referrer);}
return website;};this.canPlayInline=function(){var deviceName=this.getDeviceName();if(deviceName==="iPod"||deviceName==="iPhone"){return supportsInline(this);}else{return true;}};this.getLocationHost=function(){return window.top.location.host;};this.getDeviceScreenSize=function(){return{w:Math.round(window.screen.width*window.devicePixelRatio),h:Math.round(window.screen.height*window.devicePixelRatio)};};this.getiPhoneOSVersion=function(){var match,userAgent=this.getNavigatorUserAgent();var version=this.is_iOS()?1.0:false;if(!(match=/iP.+ OS (.*) like Mac OS X/.exec(userAgent))){}else{version=match[1].split('_').join('.');}
return version;};this.getAndroidOSVersion=function(){var match,userAgent=this.getNavigatorUserAgent();var version='';if(!(match=/Android (\d+(?:\.\d+)+)/.exec(userAgent))){}else{version=match[1];}
return version;};this.getDeviceOrientation=function(width,height){var deviceHeight=_.isUndefined(height)?window.innerHeight:height,deviceWidth=_.isUndefined(width)?window.innerWidth:width,aspectRatio=1.3;return(deviceHeight*aspectRatio>deviceWidth)?'Portrait':'Landscape';};this.getDeviceScreenSizeClass=function(){var dim=this.getDeviceScreenSize();if(!this.getiPhoneOSVersion()&&!this.getAndroidOSVersion())return'small';return(dim.h>=960||dim.w>=1280)?'big':'small';};this.supportsAnimations=function(){return(this.isAndroid()&&versionAtLeastAsNewAs(this.getAndroidOSVersion().toString(),"4.1"))||(this.is_iOS()&&versionAtLeastAsNewAs(this.getiPhoneOSVersion().toString(),"5.2"));};this.getNavigatorUserAgent=function(){return navigator.userAgent;};this.needsClickEventToPlay=function(){return this.isAndroid();};this.getHiddenProp=function(){var prefixes=['webkit','moz','ms','o'];if('hidden'in document)return'hidden';for(var i=0;i<prefixes.length;i++){if((prefixes[i]+'Hidden')in document)
return prefixes[i]+'Hidden';}
return null;};this.needsElemForcedRedraw=function(){return this.isAndroid();};this.getDocumentQueryString=function(){return document.location.search;};this.getDeviceIdFromRequest=function(){var queryStringReader=new SCOPE.QueryStringReader();return queryStringReader.getDeviceIdFromRequest(SCOPE._currentScript,this.getDocumentQueryString());};function getHostName(url){var a=document.createElement('a');a.href=url;return a.hostname;}
function supportsInline(currentDeviceInfo){var canDoInline=SCOPE.InlineVideoValidator.shouldTransformToInlineVideo(currentDeviceInfo);if(!canDoInline&&currentDeviceInfo.is_iOS()){var currentDeviceVersion=currentDeviceInfo.getiPhoneOSVersion();canDoInline=versionAtLeastAsNewAs(currentDeviceVersion.toString(),"10.0.0");}
return canDoInline;}
function versionAtLeastAsNewAs(version,comparedTo){if(!_.isString(version)){return false;}
var versionParts=version.split('.');var compareToParts=comparedTo.split('.');var i=0,isNewer=true;while(isNewer===true&&i<compareToParts.length){if(i<versionParts.length){var versionPartNum=parseInt(versionParts[i],10);var compareToPartNum=parseInt(compareToParts[i],10);var delta=versionPartNum-compareToPartNum;if(delta>0){break;}else if(delta<0){isNewer=false;}}else{isNewer=false;}
i++;}
return isNewer;}};SCOPE.device=new device();})(IV||{});
(function(SCOPE){var html5video=function(options,container,initialVolume){var that=this,params=options||{},defaults={},iroll=options.iroll;var videoControls=options.controls||['resume'];var _videoControls=function(args){var defaults={show:false,showControls:videoControls||['resume']};var params=args||{};var options=_.extend(defaults,params);var controlsBar=_.template('<div class="video-controls"></div>');var controlsButtons={resume:'<a class="control control-resume" data-fn="play">&nbsp;</a>',play:'<a class="control control-play" data-fn="play">&nbsp;</a>'};if(options.show){if(container.find('.video-controls').length>0){$(container.find('.video-controls').remove());}
var controls=$(controlsBar());_.each(options.showControls,function(control){var ctrl=controlsButtons[control];controls.append(ctrl);controls.find('.control').each(function(){$(this).css({display:'inline-block',cursor:'pointer'});});});$(container).append(controls).on(iroll.getVideoClickEventType(),'.control',function(ev){ev.preventDefault();var action=$(this).attr('data-fn');if(_.isFunction(that[action]))that[action]();});}
else{$(container.find('.video-controls').remove());}};var _init=function(){that.el=document.createElement('video');if(SCOPE.InlineVideoValidator.shouldTransformToInlineVideo(SCOPE.device)){SCOPE.InlineVideoFactory.create(that.el);}
SCOPE.InlineVideoTransformer.checkAndOverrideFastSeek(that.el);$(that.el).css({width:"100%",height:"100%",top:0,left:0,position:'absolute','pointer-events':'visible'});that.el.preload=true;that.el.controls=false;$(that.el).attr('webkit-playsinline','webkit-playsinline');$(that.el).attr('playsinline','playsinline');$(that.el).addClass('iv-main-video');if(that.params.preview){$(that.el).attr("poster",that.params.preview);}else{$(that.el).attr("poster","data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=");}
var videoVolumeHandler=new SCOPE.VideoVolumeHandler(that.el);videoVolumeHandler.bindVolumeChangeEvent(initialVolume);};this.setVideoSource=function(renditions){var elem=new SCOPE.VideoElementWrapper(that.el);var videoLoader=new SCOPE.VideoSourceLoader(elem,iroll);videoLoader.loadVideoSource(renditions);return videoLoader.isLoaded();};this.play=function(){this.el.play();_videoControls({show:false});};this.resume=this.play;this.pause=function(hideControls){this.el.pause();if(hideControls!==true){_videoControls({show:true});}};this.stop=function(){this.el.stop();_videoControls({show:false});};this.showControls=function(controls){_videoControls(_.extend({show:true},controls||{}));};this.setSrc=function(src){this.el.src=src;};this.getDuration=function(){return this.el.duration;};this.getCurrentTime=function(){return this.el.currentTime;};this.getRemainingTime=function(){return this.getDuration()-this.getCurrentTime();};this.load=function(){this.el.load();};this.events=_.extend({},Backbone.Events);this.params=_.extend(defaults,params);_init();};SCOPE.html5video=html5video;})(IV);
(function(SCOPE){SCOPE.IRollSimpleTracker=function(eventHandler,eventPrefix){var map={"expand":"dialogOpened","clickthru":"openUrl","engage":"engage","impression":"ad_started","firstquartile":"video_videoPassed25","midpoint":"video_videoPassed50","thirdquartile":"video_videoPassed75","completion":"ad_ended"};this.registerCustomPixels=function(customPixels){_.each(customPixels,function(urls,eventName){var iRollEventName=mapEventNameToIRollEventName(eventPrefix,eventName);if(iRollEventName!==null){var urlArr=urls;if(!_.isArray(urlArr)){urlArr=new Array(urlArr);}
_.each(urlArr,function(val){eventHandler.on(iRollEventName,function(){fireCustomPixel(val);});});}});};function fireCustomPixel(url){var req=new Image();req.src=url;}
function mapEventNameToIRollEventName(eventPrefix,eventName){if(map.hasOwnProperty(eventName)){return eventPrefix+map[eventName];}else{return null;}}};})(IV);
(function(SCOPE){SCOPE.reportAnalytics=Backbone.Model.extend({defaults:{sendLogs:true,instance:null,instanceClass:null,session:null,thirdPartyTrackingReporter:null,childVideoService:null,childPlacementsTrackingEventDispatcher:null,ivcExdataEnabled:false,defaultReportData:{'ad_criteria':null,placement_tag_id:0,r:'',viewer_id:'',action:'',session_id:'',client_id:-1,channel_id:0,project_state:0,video_id:0,project_hash:'',placement_hash:-1,impression_id:'',event_id:'',website:'unknown',publisher_id:0,event_value:'',fver:null,real_estate_id:0}},CONTEXT:{MANUAL_SELECT:SCOPE.ChildVideoService.MANUAL_SELECTION,AUTO_SELECT:SCOPE.ChildVideoService.AUTO_SELECTION},reportedUrls:[],reportedOptions:[],errorLogQueue:[],loadedOptions:[],postLoadedPixelCallbackActions:{},postReportedPixelCallbackActions:{},initialize:function(){var that=this,instanceData=this.get('instance'),reportData={},placementConfig=instanceData.data['placement-config'];_.extend(reportData,this.get('defaultReportData'));reportData.fver=SCOPE.baseData.mobileCoreVersion||null;that.childVideoService=this.get('childVideoService');that.childPlacementsTrackingEventDispatcher=this.get('childPlacementsTrackingEventDispatcher');that.reportedUrls=[];that.errorLogQueue=[];that.reportedOptions=[];that.loadedOptions=[];that.postLoadedPixelCallbackActions={};that.postReportedPixelCallbackActions={};that.get('instanceClass').set({sendLogs:true});reportData.session_id=SCOPE.toolkit.randomId();reportData.viewer_id=SCOPE.toolkit.randomId();reportData.impression_id=SCOPE.toolkit.randomId();reportData.ver=instanceData.data['version']||reportData.fver;reportData.website=(SCOPE.device.isDesktop()?SCOPE.device.getWebsiteHost():SCOPE.device.getDeviceInformation()).substring(0,128);that.queryStringReader=new SCOPE.QueryStringReader();if(_.isObject(placementConfig)){reportData.placement_hash=placementConfig['placement-hash']||'';reportData.placement_tag_id=placementConfig['placement-tag-id']||0;reportData.publisher_id=placementConfig['publisher-id'];reportData.channel_id=placementConfig['channel-id'];reportData.client_id=placementConfig['client-id'];reportData.project_hash=placementConfig['project-hash'];reportData.video_id=placementConfig['video-id'];reportData.project_state=placementConfig['project-state'];reportData.real_estate_id=placementConfig['real_estate_id'];reportData.format=getPlacementFormat(placementConfig['video-format']);that.childVideoService.setSelectionProjectStates(placementConfig['child-manual-project-state'],placementConfig['child-auto-project-state']);that.ivcExdataEnabled=placementConfig['ivcexdata-enabled'];that.placementFormat=placementConfig['video-format'];}else{reportData.project_hash=instanceData.data['id'];}
var deviceId=SCOPE.device.getDeviceIdFromRequest();if(deviceId){reportData.device_id=deviceId;}
this.url=this.get('instance').reportUrl;this.set("reportData",reportData);this.set("placementConfig",placementConfig);var versionId=this.queryStringReader.getVersionIdFromIvc(IV._currentScript);this.setVersionId(versionId);var audienceId=this.queryStringReader.getAudienceIdFromIvc(IV._currentScript);if(audienceId){reportData.audience_id=audienceId;}
var ivcExdata=this.queryStringReader.getQueryIvcParam(IV._currentScript);this.set("ivcExdata",ivcExdata);},submit3rdPartyTracking:function(trackingItems){if(!this.get('sendLogs'))return;var that=this;_.each(trackingItems,function(trackingItem){var reportData=that.get("reportData");var placementConfig=that.get("placementConfig");reportData.campaign_id=placementConfig['campaign-id'];reportData.placements_group_id=placementConfig['placements-group-id'];reportData.advertiser_id=placementConfig['advertiser-id'];var staticMacrosFeatureBit=that.get('ivcExdata')&&that.get('ivcExdata').indexOf('extendedmacros')!==-1
var thirdPartyTrackingReporter=that.get("thirdPartyTrackingReporter");thirdPartyTrackingReporter.report(trackingItem.data,trackingItem.type,reportData,that.firePixel.bind(that),that.reportLog.bind(that),staticMacrosFeatureBit);});},addReportDataToReportUrl:function(reportData,reportUrl){var userEvents=['click','clktruevt','clkint','cxon','cxoff','engage'];var userEventsWithoutEngage=userEvents.filter(function(eventName){return eventName!=="engage";});var queryParams=Object.keys(reportData).reduce(function(params,key){var val=reportData[key];if(val==='')return params;if(key==='relative_time'){val=(val/1000).toFixed(3);}
if(_.indexOf(['init','play','vpoint','engage'],reportData.action)!==-1){if(key==='impression_id')return params;}
if(key==='ad_criteria'){if(_.indexOf(userEventsWithoutEngage,reportData.action)!==-1){val=null;}else{return params;}}
if(key==='real_estate_id'){if(_.indexOf(userEvents,reportData.action)===-1){return params;}}
params[key]=encodeURIComponent(val);return params;},{});return reportUrl+SCOPE.toolkit.buildQueryString(queryParams);},prepareReportData:function(options,context){var reportData=_.extend({},this.toJSON()['reportData']);var pixelData=options||{};var isChildContext=typeof context!=='undefined';if(isChildContext){var childVideoData=this.childVideoService.initChildVideoData(options,context);_.extend(pixelData,{video_id:childVideoData.videoId,placement_hash:childVideoData.placementHash});_.extend(reportData,{project_state:childVideoData.projectState});this.childPlacementsTrackingEventDispatcher.trigger(pixelData.action,pixelData.event_value,pixelData.placement_hash);}
_.extend(reportData,pixelData);reportData.r=SCOPE.toolkit.randomId();return reportData;},setVersionId:function(versionId){if(versionId){var reportData=this.get("reportData");reportData.version_id=versionId;}},submit:function(options,context){if(!this.get('sendLogs'))return;options=options||{};options=replaceOption(options,'action','clktru','clktruevt');var reportData=this.prepareReportData(options,context);var reportUrlPrefix=this.get('instance').reportUrl+'?';var reportUrl=this.addReportDataToReportUrl(reportData,reportUrlPrefix);if(this.isIvcExdataEnabled()){reportUrl=this.decorateUrlWithExdata(reportUrl);}
if(_.indexOf(['click','clktruevt','engage'],reportData.action)!==-1){var that=this;setTimeout(function(){that.firePixel(reportUrl,options);},100);}else{this.firePixel(reportUrl,options);}},decorateUrlWithExdata:function(reportUrl){var ivcExdata=this.get("ivcExdata");if(_.isUndefined(ivcExdata)){return reportUrl;}
var pixelTemplate=_.template("<%= reportUrl %>&ivc_exdata=<%= ivcExdata %>");return pixelTemplate({reportUrl:reportUrl,ivcExdata:ivcExdata});},isIvcExdataEnabled:function(){return this.ivcExdataEnabled;},getReportingTrackingItems:function(action,reporting){if(!this.get('sendLogs')){return[];}
var reportingData=_.clone(reporting),eventName=action||'',resultArr=[];if(reportingData.hotspots&&_.size(reportingData.hotspots)&&reportingData.hotspots[eventName]){_.each(reportingData.hotspots[eventName],function(item){if(!_.isUndefined(item['tracking'])){_.each(item['tracking'],function(url){resultArr.push(url);});}});}
return resultArr;},click:function(ev){this.submit({action:'click',event_id:'position',event_value:ev.pageX+'x'+ev.pageY});},clickthru:function(event_id,event_value){this.submit({action:"clktruevt",event_id:event_id,event_value:event_value||"",relative_time:(_.now()-this.get('instanceClass').get("playStartTime"))});},submitCreativeDebug:function(options)
{options.action='creative';options.sample_rate=this.get('session').getCreativeSampleRate();this.submitCustomEvent(options);},submitError:function(options)
{options.action='error';options.sample_rate=this.get('session').getSampleRate();this.submitCustomEvent(options);},submitCustomEvent:function(options){options.runtime_type='html';options.suffix=this.get('instance').version.split('.').splice(0,2).join('_');this.cutPixel(options);var params=options||{},data=_.extend({},this.toJSON()['reportData']),reportData=_.extend(data,params);delete reportData.website;reportData.r=SCOPE.toolkit.randomId();var reportUrlPrefix=this.get('instance').errorReportUrl;reportUrlPrefix+='?';var reportUrl=this.addReportDataToReportUrl(reportData,reportUrlPrefix);this.fireErrorPixel(reportUrl);},reportCreativeDebugLog:function(options){if(this.get('session').isDebugEnabled()){this.submitCreativeDebug(options);}},reportLog:function(options){if(this.get('instance').enableErrorReporting&&this.get('instance').errorReportUrl){if(this.get('session').isMonitored(options.event_id)){this.submitError(options);}else{this.errorLogQueue.push(options);}}},flushErrorQueue:function(){for(var i=0;i<this.errorLogQueue.length;i++){if(this.get('session').isMonitored(this.errorLogQueue[i].event_id)){this.submitError(this.errorLogQueue[i]);}}
this.errorLogQueue=[];},firePixel:function(reportUrl,options){SCOPE.toolkit.debug("Fire Pixel - ",reportUrl);var that=this;var img=new Image(1,1);if(options){img.onload=this.loadedPixelCallback.bind(this,options);}
img.onerror=function(){that.reportLog({event_id:"pixel_error",event_value:reportUrl});};try{img.src=reportUrl;this.reportedUrls.push(reportUrl);if(options){this.reportedPixelCallback(options);}}catch(e){this.reportLog({event_id:"pixel_error_message",event_value:e.message+": "+reportUrl});}
return img;},fireErrorPixel:function(reportUrl){var img=this.firePixel(reportUrl);var irollAd=this.get('instanceClass');var appendImageToElement=function(element,img){if(element&&_.isElement(element)){try{img.style.display="none";element.ownerDocument.body.appendChild(img);return true;}catch(e){return false;}}else{return false;}};var videoContainer=irollAd.get("videoContainer");var mainContainer=irollAd.get("mainContainer");if(!appendImageToElement(videoContainer,img)){appendImageToElement(mainContainer,img);}},cutPixel:function(options){var MAX_LEN=125;if(!options.event_value)
return;options.event_value=options.event_value.length>MAX_LEN?options.event_value.substring(0,MAX_LEN):options.event_value;},reportedPixelCallback:function(options){pixelCallback(this.reportedOptions,this.postReportedPixelCallbackActions,options);},wasPixelReported:function(options){return!!_.findWhere(this.reportedOptions,options);},addPostReportedPixelCallback:function(cb,action){addActionCallback(this.postReportedPixelCallbackActions,cb,action);},loadedPixelCallback:function(options){pixelCallback(this.loadedOptions,this.postLoadedPixelCallbackActions,options);},wasPixelLoaded:function(options){return!!_.findWhere(this.loadedOptions,options);},addPostLoadedPixelCallback:function(cb,action){addActionCallback(this.postLoadedPixelCallbackActions,cb,action);},});function replaceOption(options,key,original,replacement){options[key]=options.hasOwnProperty(key)?(options[key]===original?replacement:options[key]):options[key];return options;}
function pixelCallback(pixelOptionsArr,callbackActionsObj,options){pixelOptionsArr.push(options);if(callbackActionsObj.hasOwnProperty(options.action)){callbackActionsObj[options.action].forEach(function(postReportPixelCb){postReportPixelCb();});}}
function addActionCallback(callbackActionsObj,cb,action){if(callbackActionsObj.hasOwnProperty(action)){callbackActionsObj[action].push(cb);}else{callbackActionsObj[action]=[cb];}}
function getPlacementFormat(format){return SCOPE.FormatDetector.isDisplayAd(format)?SCOPE.FormatDetector.DISPLAY_FORMAT:SCOPE.FormatDetector.VIDEO_FORMAT;}})(IV);
(function(SCOPE){SCOPE.Events.on("IRollInit",_.once(function(core){var report=core.report;var reporter=new SCOPE.DisplayAdMeasurementReporter(report)
var listener=new SCOPE.DisplayAdMeasurementListener(core);SCOPE.Events.on(core.get("id")+':detected_invalid_ad_size',function(){listener.onValidAdSize(function(validSize){reporter.reportValidSize(validSize);});});}));})(IV);
(function(SCOPE){SCOPE.DisplayReportAnalytics=SCOPE.reportAnalytics.extend({DISPLAY_ALLOWED_ACTIONS:["invid","init","play","intrct","engage","clktruevt","clktru","clkint","click","version","view1px","viewmraid","subload","viewomid","measure"],ALLOWED_ACTIONS_WITHOUT_PREFIX:["error"],PREFETCH_PROJECT_STATE:98,DISPLAY_PIXEL_PREFIX:"d",submit:function(options,context){if(this.isPixelAllowedForDisplay(options["action"])){SCOPE.reportAnalytics.prototype.submit.apply(this,arguments);}},prepareReportData:function(options,context){if(this.queryStringReader.isPrefetchMacroEnabled(IV._currentScript)){this.get("reportData").project_state=this.PREFETCH_PROJECT_STATE;}
return SCOPE.reportAnalytics.prototype.prepareReportData.apply(this,arguments);},addReportDataToReportUrl:function(reportData,reportUrl){if(this.shouldIncludeDisplayPrefix(reportData.action)){reportData.action=this.DISPLAY_PIXEL_PREFIX+reportData.action;this.addSizeToImpression(reportData);}
return SCOPE.reportAnalytics.prototype.addReportDataToReportUrl.apply(this,arguments);},isPixelAllowedForDisplay:function(action){return this.DISPLAY_ALLOWED_ACTIONS.indexOf(action)>-1;},shouldIncludeDisplayPrefix:function(action){return this.ALLOWED_ACTIONS_WITHOUT_PREFIX.every(function(nonPrefixAction){return action!==nonPrefixAction;});},addSizeToImpression:function(reportData){if(reportData.action==="dplay"){var core=this.get("instanceClass");var contextWindow=core.get("contextWindow");var width=contextWindow.innerWidth;var height=contextWindow.innerHeight;reportData.event_id="adsize";reportData.event_value=width+"x"+height;this.fireMeasurePixel(core,width,height);}},fireMeasurePixel:function(core,width,height){if(!SCOPE.DisplayAdSizeValidator.isValidAdSize(width,height)){IV.Events.trigger(core.get("id")+':detected_invalid_ad_size');}}});})(IV);
(function(SCOPE){SCOPE.Events.on("IRollInit",_.once(function(core){var listener=new SCOPE.DisplaySubloadListener(core);listener.startListening();}));})(IV);
(function(SCOPE){SCOPE.Events.on("IRollInit",_.once(function(core){var reporter=new SCOPE.DisplayViewabilityReporter(core.report);var listener=new SCOPE.DisplayViewabilityListener(core,new SCOPE.DisplayMraidImpl(),reporter);listener.startListening();}));})(IV);
(function(SCOPE){if(!_.isObject(SCOPE.toolkit)){SCOPE.toolkit={};}
var logger=null;SCOPE.toolkit.debug=function(){if(logger===null){logger=createLogger();}
logger.debug.apply(logger,arguments);};function createLogger(){var queryReader=new SCOPE.QueryStringReader();var customParams=new SCOPE.DataInjector(queryReader,SCOPE.toolkit).getCustomParams();var isDebugMode=customParams.hasOwnProperty("innovid_debug")?customParams["innovid_debug"]==="1":false;return new SCOPE.InnovidLogger(isDebugMode);}
SCOPE.toolkit.randomId=function(){var res="";for(var i=0;i<8;i++){res+=(0x10000|Math.random()*0x10000).toString(16).substr(1);}
return res;};SCOPE.toolkit.getEnvironmentFromURL=function(url){url=url.replace(/^https?:\/\//,'');var urlParts=url.split("/");var host=urlParts[0];return host.split(".").slice(-2).join(".");};SCOPE.toolkit.getURLparts=function(url){var uriBreakeDownRexExp=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?");var urlPartsArray=url.split(uriBreakeDownRexExp);var urlPartObj={scheme:urlPartsArray[2],authority:urlPartsArray[4],path:urlPartsArray[5],query:urlPartsArray[7],fragment:urlPartsArray[9]};return urlPartObj;};SCOPE.toolkit.getURISchemeFromURL=function(url){return SCOPE.toolkit.getURLparts(url).scheme;};SCOPE.toolkit.trim=function(str){return str.replace(/^\s+|\s+$/g,"");};SCOPE.toolkit.getRGBcolorFromMScolor=function(color){var red,blue,green;red=Math.floor(Math.floor(color/256)/256);color=color-red*256*256;green=Math.floor(color/256);blue=color-green*256;return{red:red,green:green,blue:blue};};SCOPE.toolkit.dayCodesToDaysInWeek=function(recurrence){var pos,days=recurrence.split(","),daysInWeek=[],dayCodes=["SU","MO","TU","WE","TH","FR","SA"];_.each(days,function(dayCode){pos=dayCodes.indexOf(dayCode);if(pos!=-1){daysInWeek.push(pos);}});return daysInWeek;};SCOPE.toolkit.dateToString=function(date){var weekday=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var dateParts=date.toDateString().split(" ");return weekday[date.getDay()]+", "+dateParts[1]+". "+dateParts[2]+", "+dateParts[3];};SCOPE.toolkit.getExpirationDate=function(date){var expires=new Date(date);expires.setFullYear(expires.getFullYear()+1);return expires.getFullYear()
+"-"+SCOPE.toolkit.padDigits((expires.getUTCMonth()+1),2)
+"-"+SCOPE.toolkit.padDigits(expires.getUTCDate(),2)
+"T"
+SCOPE.toolkit.padDigits(expires.getUTCHours(),2)
+":"+SCOPE.toolkit.padDigits(expires.getUTCMinutes(),2)
+":"+SCOPE.toolkit.padDigits(expires.getUTCSeconds(),2);};SCOPE.toolkit.padDigits=function(number,digits){return Array(Math.max(digits-String(number).length+1,0)).join(0)+number;};SCOPE.toolkit.getIconImageSize=function(sizeArray,iconSize){var iconImageSize=null;var nextIndex=0;for(var i in sizeArray){if(iconImageSize==null||Math.abs(sizeArray[i]-iconSize)<Math.abs(iconImageSize-iconSize)){iconImageSize=sizeArray[i];nextIndex++;}}
if((nextIndex<sizeArray.length)&&(iconSize>iconImageSize)){iconImageSize=sizeArray[nextIndex];}
return iconImageSize};SCOPE.toolkit.getPlatformScaleParameter=function(platformScaling){var scale=1;var platform=SCOPE.device.getPlatformType();switch(platform){case"mobile":scale=platformScaling.mobile;break;case"tablet":scale=platformScaling.tablet;break;case"desktop":scale=platformScaling.desktop;break;case"tv":scale=platformScaling.tv;break;}
return scale};SCOPE.toolkit.secondsToHMS=function(seconds){var seconds=Number(seconds);var h=Math.floor(seconds/3600);var m=Math.floor(seconds%3600/60);var s=Math.floor(seconds%3600%60);return((h>0?h+":":"")+(m>0?(m<10?"0":"")+m+":":"00:")+(s<10?"0":"")+s);};SCOPE.toolkit.addDaySuffix=function(i){var j=i%10;if(j==1&&i!=11){return i+"st";}
if(j==2&&i!=12){return i+"nd";}
if(j==3&&i!=13){return i+"rd";}
return i+"th";};SCOPE.toolkit.getDateLabel=function(date){var daysDiff=SCOPE.toolkit.calcDiffInDays(date,new Date());switch(daysDiff)
{case 0:return"Today";case 1:return"Tomorrow";default:return date.toDateString().split(" ")[1]+" "+SCOPE.toolkit.addDaySuffix(date.getDate());}};SCOPE.toolkit.calcDiffInDays=function(from,to){var diff=from-to;return Math.max(Math.ceil(diff/1000/60/60/24),0);};function removeQuestionMark(str){return str.charAt(0)==="?"?str.substring(1):str;}
SCOPE.toolkit.parseQueryString=function(querystring){var res={};var queryStringMap=SCOPE.toolkit.parseQueryStringWithoutUrlDecoding(querystring);_.each(queryStringMap,function(value,key){try{res[key]=value?decodeURIComponent(value):"";}catch(ignore){res[key]="";}});return res;};SCOPE.toolkit.parseQueryStringWithoutUrlDecoding=function(querystring){var res={};if(querystring&&typeof querystring==="string"){var paramString=removeQuestionMark(querystring);var paramPartArray=paramString.split("&");_.each(paramPartArray,function(paramPart){var splittedParam=paramPart.split("=");try{res[splittedParam[0]]=splittedParam[1]?splittedParam[1]:"";}catch(ignore){res[splittedParam[0]]="";}});}
return res;}
SCOPE.toolkit.buildQueryString=function(queryParams){var queryString=Object.keys(queryParams).reduce(function(queryStringBuilder,key){return queryStringBuilder.concat(key,"=",queryParams[key].toString(),"&");},"");queryString=queryString.charAt(queryString.length-1)==="&"?queryString.slice(0,-1):queryString;return queryString;}
SCOPE.toolkit.addCssPrefixes=function(prop,value){var cssStyle={};_.each(this.getCssPrefixes(),function(prefix){cssStyle[prefix+prop]=value;});return cssStyle;};SCOPE.toolkit.getCssPrefixes=function(){return['','-webkit-','-moz-','-ms-','-o-'];};SCOPE.toolkit.generateDate=function(){var now=new Date();var date=[now.getFullYear(),now.getMonth()+1,now.getDate()];var time=[now.getHours(),now.getMinutes(),now.getSeconds()];return date.join('-')+' '+time.join(':')+'.'+now.getMilliseconds();}})(IV);
(function(SCOPE){SCOPE.VideoRenditions=(function(){function VideoRenditions(){var renditionsMap={"iphone_stream":{"mimetype":"application/x-mpegurl","device":["iPhone","iPod","iPad","Android"],"extension":"m3u8","isHLS":true},"low.mp4":{"mimetype":"video/mp4"},"mp4":{"mimetype":"video/mp4"},"high.mp4":{"mimetype":"video/mp4","device":["Desktop"]},"webm":{"mimetype":"video/webm"},"specificRendition":{}};var extensionToRenditionMap={"m3u8":"iphone_stream","mp4":"mp4","webm":"webm"};var renditionsPriority=["specificRendition","high.mp4","iphone_stream","low.mp4","mp4","webm"];this.disableSupport=function(name){if(supported(name)){delete renditionsMap[name];}
return this;};this.add=function(name,url){if(supported(name)){renditionsMap[name]["src"]=filterURL(name,url);}
return this;};this.isDeviceSupported=function(name,device,supportsHLS){var deviceSupported=false;if(supported(name)){var rend=renditionsMap[name];if(rend.hasOwnProperty("device")){deviceSupported=(rend["isHLS"])?(rend["device"].indexOf(device)!=-1)&&supportsHLS:(rend["device"].indexOf(device)!=-1);}
else{deviceSupported=true;}}
return deviceSupported;};this.getIterator=function(){return new VideoRenditionsIterator(renditionsMap,renditionsPriority);};function supported(name){return renditionsMap.hasOwnProperty(name);}
function filterURL(name,url){if(renditionsMap.hasOwnProperty(name)){var rendition=renditionsMap[name];if(rendition.hasOwnProperty("extension")){url=url.replace("."+name,"."+rendition["extension"]);}}
return url;}
this.hasMimeType=function(name){return renditionsMap[name].hasOwnProperty('mimetype');};function getMimeTypeFromSource(extension){var renditionInMap=extensionToRenditionMap[extension];return renditionsMap[renditionInMap]['mimetype'];}
this.setMimeTypeBySource=function(name,src){var extension=src.substring(src.lastIndexOf('.')+1);if(extensionToRenditionMap.hasOwnProperty(extension)){renditionsMap[name]['mimetype']=getMimeTypeFromSource(extension);}};}
var VideoRenditionsIterator=(function(){function VideoRenditionsIterator(renditions,order){this.renditions=renditions;this.order=order;this.current=0;}
VideoRenditionsIterator.prototype.next=function(){var i=this.current;var rendWithSrc=null;while(i<_.size(this.order)&&rendWithSrc===null){var rend=this.renditions[this.order[i]];if(_.isObject(rend)&&rend.hasOwnProperty("src")){rendWithSrc=rend;this.current=i+1;}
i++;}
return rendWithSrc;};VideoRenditionsIterator.prototype.reset=function(){this.current=0;};return VideoRenditionsIterator;})();return VideoRenditions;})();})(IV);
(function(SCOPE){function renderCloseButton(core){var closeButton=$('<div id="iv-close-btn" />');closeButton.on(core.get('mainEngagementEvent'),function(ev){ev.preventDefault();core.report.submit({action:'close',event_value:'click'});SCOPE.Events.trigger(core.get('id')+':close');});core.canvas.addElement(closeButton);SCOPE.Events.trigger("closeButtonRendered");}
function unrenderCloseButton(){SCOPE.Events.trigger("closeButtonUnrendered");}
SCOPE.Events.on("IRollReady",function(core){var showCloseButton=core.get('CloseButton'),waitTillImpression=core.get('CloseButtonWaitToImpression');if(showCloseButton||waitTillImpression){SCOPE.Events.trigger("closeButtonEnabled");var renderFn;if(showCloseButton){renderFn=_.once(renderCloseButton.bind(this,core));}else{renderFn=unrenderCloseButton;}
var timeout=parseInt(core.get('CloseButtonTimeout'),10);if(isNaN(timeout))timeout=0;var timer=setTimeout(function(){renderFn();},timeout);SCOPE.Events.on(core.get('id')+':ad_started',function(){clearTimeout(timer);renderFn();});}});})(IV);
(function(SCOPE){SCOPE.VideoElementWrapper=function(elem){this.elem=elem;this.fallbackDuration=0;};SCOPE.VideoElementWrapper.prototype.play=function(){this.elem.play();};SCOPE.VideoElementWrapper.prototype.pause=function(){this.elem.pause();};SCOPE.VideoElementWrapper.prototype.getAllSourceChildren=function(){return this.elem.children||[];};SCOPE.VideoElementWrapper.prototype.setSrc=function(src){this.elem.src=src;};SCOPE.VideoElementWrapper.prototype.hasSrc=function(){return!!this.elem.src;};SCOPE.VideoElementWrapper.prototype.getDuration=function(){return(isFinite(this.elem.duration)&&this.elem.duration>0)?this.elem.duration:this.fallbackDuration;};SCOPE.VideoElementWrapper.prototype.setFallbackDuration=function(fallbackDuration){this.fallbackDuration=fallbackDuration;};SCOPE.VideoElementWrapper.prototype.getCurrentTime=function(){return this.elem.currentTime;};SCOPE.VideoElementWrapper.prototype.getElem=function(){return this.elem;};SCOPE.VideoElementWrapper.prototype.on=function(event,callback){this.elem.addEventListener(event,callback);};SCOPE.VideoElementWrapper.prototype.canPlayType=function(mimeType){var canPlay;if(this.elem.canPlayType){canPlay=this.elem.canPlayType(mimeType);}else{var tempVideo=document.createElement('video');if(typeof tempVideo.canPlayType==="function"){canPlay=tempVideo.canPlayType(mimeType);}}
return(canPlay==='probably'||canPlay==='maybe');};SCOPE.VideoElementWrapper.prototype.load=function(){if(this.elem.load){this.elem.load();}};SCOPE.VideoElementWrapper.prototype.seekTo=function(secs){this.elem.currentTime=secs;};SCOPE.VideoElementWrapper.prototype.getVolume=function(){if(typeof this.elem.volume!=='undefined'){return this.elem.volume;}else{return-1;}};SCOPE.VideoElementWrapper.prototype.setVolume=function(val){if(typeof this.elem.volume!=='undefined'){var volumeNum=parseFloat(val);if(!isNaN(volumeNum)&&volumeNum>=0&&volumeNum<=1){this.elem.volume=volumeNum;}}};SCOPE.VideoElementWrapper.prototype.exitFullScreen=function(){if(this.elem.exitFullscreen){this.elem.exitFullscreen();}
else if(this.elem.webkitExitFullscreen){this.elem.webkitExitFullscreen();}};SCOPE.VideoElementWrapper.prototype.hasTracks=function(){return _.isElement(this.elem)&&$(this.elem).find("track").size()>0;};SCOPE.VideoElementWrapper.prototype.setMute=function(isMuted){this.elem.muted=isMuted;};})(IV);
(function(SCOPE){SCOPE.InternalVideoPlayer=function(core,initialVolume){var elem;this.video=null;this.core=null;this.spy=null;this.loaded=false;this.everPlayed=false;var videoOptions={preview:false,controls:[],autoplay:true,iroll:core};var startMuted=!!core.get("startMuted");this.videoContainer=$('<div class="video-container" />');var initialVol=_.isUndefined(initialVolume)?(startMuted?0:1):initialVolume;this.video=new SCOPE.html5video(videoOptions,this.videoContainer,initialVol);elem=new SCOPE.VideoElementWrapper(this.video.el);elem.setMute(startMuted);this.init=function(data,core){var that=this;this.spy=new SCOPE.VideoSpy(elem);if(data.customMetricsEnabled){this.spy.setCustomPoint(data.customMetricsTime)}
this.spy.on("all",function(eventName,ev){SCOPE.Events.trigger(core.get('id')+':'+eventName,ev);if(eventName==="video_short_buffering_time"||eventName==="video_long_buffering_time"){SCOPE.Events.trigger('buffering');}
else if(eventName!=="video_timeupdate"&&eventName!=="buffering"){SCOPE.Events.trigger('not_buffering');}});this.core=core;this.videoContainer.append(this.video.el);core.canvas.addElement(this.videoContainer);SCOPE.Events.on("video_click",function(ev){that.trigger("interact",ev)});SCOPE.Events.on('winResize',setSizes.bind(null,this));setSizes(this);SCOPE.Events.trigger("videoPlayerReady",core,this,this.spy);};this.loadVideoSource=function(renditionsConfig){this.loaded=this.video.setVideoSource(renditionsConfig);};var setSizes=function(context){var core=context.core;var adSize=core.canvas.getSize();context.videoContainer.css({width:adSize.width,height:adSize.height});};this.getDuration=function(){return this.video.getDuration();};this.getRemainingTime=function(){return this.video.getRemainingTime();};this.getCurrentTime=function(){return this.video.getCurrentTime();};this.play=function(){if(this.loaded){this.video.play();this.everPlayed=true;}
else{throw("Failed to load video");}};this.resume=function(){this.video.resume();};this.pause=function(){this.video.pause(true);};this.getState=function(){return this.spy.state;};this.isPlaying=function(){return(this.spy.state==="playing");};this.isEverPlayed=function(){return this.everPlayed;};this.preparePlay=function(){if(!this.everPlayed){this.video.load();}};this.getVolume=function(){return elem.getVolume();};this.setVolume=function(val){elem.setVolume(val);};this.exitFullScreen=function(){elem.exitFullScreen();};};_.extend(SCOPE.InternalVideoPlayer.prototype,Backbone.Events);})(IV);
(function(SCOPE){SCOPE.Events.on("videoPlayerReady",function(core,videoPlayer,videoSpy){var elem,coreId=core.get('id'),enabled=true;function buildElem(){elem=$("<div class='iv-video-controls' />");elem.hide();elem.on(core.getVideoClickEventType(),function(){videoPlayer.play();IV.Events.trigger(coreId+":video_controls_play");});}
function bindEvents(){var pauseTimerId=null;["video_play","video_ended","buffering"].forEach(function(ev){videoSpy.on(ev,function(){hideControls();});});videoSpy.on("video_pause",function(){showControls();});["dialogClosed","slateClosed"].forEach(function(ev){IV.Events.on(coreId+':'+ev,function(){enabled=true});});["dialogOpened","slateOpened"].forEach(function(ev){IV.Events.on(coreId+':'+ev,function(){enabled=false});});function hideControls(){if(pauseTimerId){clearTimeout(pauseTimerId);pauseTimerId=null;}
elem.hide();}
function showControls(){pauseTimerId=setTimeout(function(){if(enabled&&!hasVideoEnded())elem.show();pauseTimerId=null;},500);}}
function hasVideoEnded(){return videoPlayer.getState()==="ended";}
if(core.get('showClickToResume')===true){buildElem();core.canvas.addResponsiveElement(elem);bindEvents();}});SCOPE.Events.on("previewPlayerReady",function(core){var elem=$('<div class="iv-video-controls" />');elem.on(core.getVideoClickEventType(),function(){IV.Events.trigger(core.get('id')+":preview_play_click");elem.hide();});$("#iv-iroll").append(elem);});})(IV);
(function(SCOPE){SCOPE.VideoSourceLoader=function(videoElem,core){SCOPE.toolkit.debug("VideoSourceLoader");var isLoaded=false;this.loadVideoSource=function(renditionsConfig){var renditions=new SCOPE.VideoRenditions(),foundSuitableSource=false;if(!core.get('supportHLS')||videoElem.hasTracks()){renditions.disableSupport("iphone_stream");}
if(SCOPE.InlineVideoValidator.shouldTransformToInlineVideo(SCOPE.device)){renditions.disableSupport("iphone_stream");}
if(_.isObject(renditionsConfig)&&_.size(renditionsConfig)>0){_.each(renditionsConfig,function(src,name){if(renditions.isDeviceSupported(name,SCOPE.device.getDeviceName(),SCOPE.device.isDeviceHLSSupported())){renditions.add(name,src);if(!renditions.hasMimeType(name)){renditions.setMimeTypeBySource(name,src);}}});var iterator=renditions.getIterator();var rend=iterator.next();while(rend!==null&&foundSuitableSource===false){if(videoElem.canPlayType(rend['mimetype'])){var hadSrc=videoElem.hasSrc();var sourceURL=getSourceURL(rend['src']);videoElem.setSrc(sourceURL);if(hadSrc){videoElem.load();}
foundSuitableSource=true;}else{rend=iterator.next();}}
if(!foundSuitableSource){SCOPE.Events.trigger(core.get('id')+':video_error');}}
isLoaded=foundSuitableSource;};function getSourceURL(renditionURL){if(shouldReplaceURLTags(renditionURL)){var queryStringReader=new SCOPE.QueryStringReader();var versionId=queryStringReader.getVersionIdFromIvc(IV._currentScript);var mediaFolder=queryStringReader.getMediaFolderFromIvc(IV._currentScript);SCOPE.toolkit.debug("Replacing URL: "+versionId+","+mediaFolder+" -> "+renditionURL);var replacedURL=renditionURL.replace("VERSIONID",versionId);replacedURL=replacedURL.replace("MEDIAFOLDER",mediaFolder);SCOPE.toolkit.debug("Replaced URL: "+replacedURL);return replacedURL;}
else{return renditionURL;}}
function shouldReplaceURLTags(renditionURL){var allowDynamicVPAID=IV.FeatureBitsResolver.isEnabled(IV.FeatureBitsResolver.FEATURE_NAMES.ALLOW_VPAID_DYNAMIC_VIDEO_PLACEMENTS);var includeTAGS=renditionURL&&renditionURL.indexOf('VERSIONID')!=-1;return includeTAGS&&allowDynamicVPAID;}
this.isLoaded=function(){return isLoaded;}};})(IV);
var IV;(function(IV){var PassThruPlayer=(function(){function PassThruPlayer(){this.remainingTime=-2;this.duration=-2;this.volume=-2;this.playing=false;this.events={};_.extend(this.events,Backbone.Events);}
PassThruPlayer.prototype.init=function(){var _this=this;console.log("PTP: called init");IV.Events.on("video_click",function(ev){_this.trigger("interact",ev);});};PassThruPlayer.prototype.getRemainingTime=function(){return this.remainingTime;};PassThruPlayer.prototype.getDuration=function(){return this.duration;};PassThruPlayer.prototype.getCurrentTime=function(){if(this.duration>0&&this.remainingTime>0){return(this.duration-this.remainingTime);}
else{return-2;}};PassThruPlayer.prototype.getCurrentProgress=function(){var currentTime=this.getCurrentTime();if(currentTime>0){return 100*currentTime/this.duration;}
else{return 0;}};PassThruPlayer.prototype.getVolume=function(){console.log("PTP: called getVolume");return this.volume;};PassThruPlayer.prototype.preparePlay=function(){console.log("PTP: called preparePlay");};PassThruPlayer.prototype.play=function(){console.log("PTP: called play");this.playing=true;this.trigger("play");};PassThruPlayer.prototype.resume=function(){console.log("PTP: called resume");this.playing=true;this.trigger("resume");};PassThruPlayer.prototype.pause=function(){console.log("PTP: called pause");this.playing=false;this.trigger("pause");};PassThruPlayer.prototype.setVolume=function(vol){this.volume=vol;console.log("PTP: called setVolume: "+vol);this.trigger("volumeChange",vol);};PassThruPlayer.prototype.loadVideoSource=function(){console.log("PTP: called loadVideoSource");};PassThruPlayer.prototype.getState=function(){console.log("PTP: called getState");return null;};PassThruPlayer.prototype.isPlaying=function(){console.log("PTP: called isPlaying");return this.playing;};PassThruPlayer.prototype.isEverPlayer=function(){console.log("PTP: called isEverPlayer");return null;};PassThruPlayer.prototype.exitFullScreen=function(){console.log("PTP: called exitFullScreen");};PassThruPlayer.prototype.cleanUp=function(){console.log("PTP: called cleanUp");this.playing=false;this.trigger("stop");};PassThruPlayer.prototype.setRemainingTime=function(remainingTime){this.remainingTime=remainingTime;};PassThruPlayer.prototype.setDuration=function(duration){this.duration=duration;};PassThruPlayer.prototype.on=function(eventName,callback){this.events.on(eventName,callback);};PassThruPlayer.prototype.trigger=function(eventName,value){this.events.trigger(eventName,value);};PassThruPlayer.prototype.off=function(eventName,value){this.events.off(eventName,value);};return PassThruPlayer;})();IV.PassThruPlayer=PassThruPlayer;})(IV||(IV={}));
;
(function(SCOPE){var updateOrientation=function(){$('body').attr('orientation',SCOPE.device.getDeviceOrientation());SCOPE.Events.trigger('orientationchange');};$(document).on('ready',function(){SCOPE.Events.trigger('domReady');});$(window).on('load',function(){SCOPE.Events.trigger('winLoad');});$(window).on('resize',function(){$('body').attr('orientation',SCOPE.device.getDeviceOrientation());});window.onorientationchange=updateOrientation;SCOPE.enableAnimations=SCOPE.device.supportsAnimations();$(function(){SCOPE.editingMode=false;$('body').css({"margin":0,"padding":0,"border":0,"fontSize":"100%","font":"inherit","verticalAlign":"baseline"});$('body').attr('orientation',SCOPE.device.getDeviceOrientation());$('html').attr('screen-size',SCOPE.device.getDeviceScreenSizeClass()).attr('auto-scale',SCOPE.device.getAndroidOSVersion()!=='');$('body').on('focus',".editable",function(){SCOPE.editingMode=true;});$('body').on("blur",".editable",function(){SCOPE.editingMode=false;});});})(IV);
var IV;(function(IV){var InUnitVideoQuartileReporter=(function(){function InUnitVideoQuartileReporter(iroll,spy,videoName,playStartTimeFunc,consoleLogUtil){this.iroll=iroll;this.reporter=this.iroll.report;this.spy=spy;this.videoName=videoName;this.getPlayStartTime=playStartTimeFunc;this.consoleLogUtil=consoleLogUtil;}
InUnitVideoQuartileReporter.prototype.start=function(){var _this=this;this.spy.on("video_play",_.once(function(){_this.sendReport(IV.Action.INVPLY,_this.videoName);}));this.spy.on("video_videoPassed25",_.once(function(){_this.sendReport(IV.Action.INVPT,_this.videoName,25);}));this.spy.on("video_videoPassed50",_.once(function(){_this.sendReport(IV.Action.INVPT,_this.videoName,50);}));this.spy.on("video_videoPassed75",_.once(function(){_this.sendReport(IV.Action.INVPT,_this.videoName,75);}));this.spy.on("video_ended",_.once(function(){_this.sendReport(IV.Action.INVPT,_this.videoName,100);}));};InUnitVideoQuartileReporter.prototype.stop=function(){this.spy.off("video_play");this.spy.off("video_videoPassed25");this.spy.off("video_videoPassed50");this.spy.off("video_videoPassed75");this.spy.off("video_ended");};InUnitVideoQuartileReporter.prototype.sendReport=function(action,eventId,eventValue){if(this.iroll.get("reportEventsToConsole")){this.consoleLogUtil.log(IV.InUnitVideoQuartileActionUtil.toMessage(action,eventId,eventValue));}
this.reporter.submit({action:IV.InUnitVideoQuartileActionUtil.toValue(action),relative_time:(new Date().getTime()-this.getPlayStartTime()),event_id:eventId,event_value:eventValue||""});};return InUnitVideoQuartileReporter;})();IV.InUnitVideoQuartileReporter=InUnitVideoQuartileReporter;})(IV||(IV={}));
var IV;(function(IV){var QueryStringReader=(function(){function QueryStringReader(tool){if(tool===void 0){tool=IV.toolkit;}
this.DEVICE_ID_PARAM_NAME="deviceid";this.PREFETCH_PARAM_NAME="pref";this.DCO_MACROS="DCO";this.CLICK_THRU_URL_BY_VERSION="inv_fd_clickthroughUrl";this.VERSION_ID="version_id";this.MEDIA_FOLDER="media_folder";this.AUDIENCE_ID="audience_id";this.toolkit=tool;}
QueryStringReader.prototype.getExternalCustomParams=function(currentScript,locationSearch){if(currentScript&&currentScript.src){locationSearch=currentScript.src.split("?")[1];}
return this.toolkit.parseQueryString(locationSearch);};QueryStringReader.prototype.getQueryIvcParam=function(currentScript){var filteredQueryParams=this.getQueryIvcParamDecoded(currentScript);filteredQueryParams=IV.MacroExcluder.excludeMacros(filteredQueryParams,this.DCO_MACROS);return!_.isUndefined(filteredQueryParams)?encodeURIComponent(filteredQueryParams):void 0;};QueryStringReader.prototype.getQueryIvcParamDecoded=function(currentScript){var parsedQueryParams=this.getParsedQueryParamsFromScript(currentScript);if(parsedQueryParams&&"ivc"in parsedQueryParams){return parsedQueryParams["ivc"];}
else{return(void 0);}};QueryStringReader.prototype.getDeviceIdFromRequest=function(currentScript,locationsSearch){locationsSearch=this.fromCurrentScript(currentScript,locationsSearch);var params=this.toolkit.parseQueryString(locationsSearch);return this.isDeviceIdValid(params[this.DEVICE_ID_PARAM_NAME])?params[this.DEVICE_ID_PARAM_NAME]:undefined;};QueryStringReader.prototype.isPrefetchMacroEnabled=function(currentScript){var parsedQueryParams=this.getParsedQueryParamsFromScript(currentScript);return(parsedQueryParams&&parsedQueryParams[this.PREFETCH_PARAM_NAME])?parsedQueryParams[this.PREFETCH_PARAM_NAME]==="true":false;};QueryStringReader.prototype.clickThruUrlByVersion=function(currentScript){return this.getValueFromIvcParams(currentScript,this.CLICK_THRU_URL_BY_VERSION);};QueryStringReader.prototype.getVersionIdFromIvc=function(currentScript){return this.getValueFromIvcParams(currentScript,this.VERSION_ID);};QueryStringReader.prototype.getMediaFolderFromIvc=function(currentScript){return this.getValueFromIvcParams(currentScript,this.MEDIA_FOLDER);};QueryStringReader.prototype.getAudienceIdFromIvc=function(currentScript){return this.getValueFromIvcParams(currentScript,this.AUDIENCE_ID);};QueryStringReader.prototype.getValueFromIvcParams=function(currentScript,key){var ivcQueryParamsDecoded=this.getQueryIvcParamDecoded(currentScript);var ivcParsedQueryParams=this.toolkit.parseQueryString(ivcQueryParamsDecoded);var invFeedParams;if(currentScript&&currentScript.dataset&&currentScript.dataset["invFeed"]){invFeedParams=this.toolkit.parseQueryString(decodeURIComponent(currentScript.dataset["invFeed"]));}
return(_.isObject(ivcParsedQueryParams)&&ivcParsedQueryParams[key])?ivcParsedQueryParams[key]:(_.isObject(invFeedParams)&&invFeedParams[key])?invFeedParams[key]:void 0;};QueryStringReader.prototype.getParsedQueryParamsFromScript=function(currentScript){if(!currentScript||!currentScript.src||currentScript.src.indexOf("?")<0){return(void 0);}
var locationSearch=currentScript.src.split("?")[1];return this.toolkit.parseQueryString(locationSearch);};QueryStringReader.prototype.fromCurrentScript=function(currentScript,defaultValue){if(currentScript&&currentScript.src){var scriptQueryString=currentScript.src.split("?")[1];if(scriptQueryString&&scriptQueryString.indexOf(this.DEVICE_ID_PARAM_NAME)!==-1){defaultValue=scriptQueryString;}}
return defaultValue;};QueryStringReader.prototype.isDeviceIdValid=function(dId){return dId&&dId.length>0;};return QueryStringReader;})();IV.QueryStringReader=QueryStringReader;})(IV||(IV={}));
var IV;(function(IV){var FingerprintHandler=(function(){function FingerprintHandler(){}
Object.defineProperty(FingerprintHandler,"FINGERPIRINT_STORAGE_KEY",{get:function(){return"invid";},enumerable:true,configurable:true});FingerprintHandler.prototype.listenToIrollReady=function(){var _this=this;IV.Events.on("IRollInit",function(core){try{var result=_this.detectOrCreate();_this.store(result.fingerprint);_this.report(core.report,result);}
catch(e){IV.toolkit.debug(e.message||e.description||e);}});};FingerprintHandler.prototype.detectOrCreate=function(){var fingerprint=localStorage.getItem(FingerprintHandler.FINGERPIRINT_STORAGE_KEY);if(fingerprint){return{fingerprint:fingerprint,type:"cache"};}
else{return{fingerprint:IV.toolkit.randomId(),type:"new"};}};FingerprintHandler.prototype.store=function(fingerprint){localStorage.setItem(FingerprintHandler.FINGERPIRINT_STORAGE_KEY,fingerprint);};FingerprintHandler.prototype.report=function(reporter,result){reporter.submit({action:FingerprintHandler.FINGERPIRINT_STORAGE_KEY,event_id:result.type,event_value:result.fingerprint});};return FingerprintHandler;})();IV.FingerprintHandler=FingerprintHandler;})(IV||(IV={}));
var IV;(function(IV){IV.doFingerprinting=function(){var handler=new IV.FingerprintHandler();handler.listenToIrollReady();};})(IV||(IV={}));IV.doFingerprinting();
var IV;(function(IV){var InlineVideoValidator=(function(){function InlineVideoValidator(){}
Object.defineProperty(InlineVideoValidator,"VALID_DEVICE_NAMES",{get:function(){return["iPhone","iPod"];},enumerable:true,configurable:true});;Object.defineProperty(InlineVideoValidator,"VALID_iOS_VERSIONS",{get:function(){return["8.","9."];},enumerable:true,configurable:true});;InlineVideoValidator.shouldTransformToInlineVideo=function(deviceInfo,force){if(force===void 0){force=false;}
if(InlineVideoValidator.config===null){InlineVideoValidator.config=window["IV"].baseData.app_data;}
if(force){return true;}
if(typeof InlineVideoValidator.config!=="undefined"&&InlineVideoValidator.config.hasOwnProperty("iphone-inline")&&InlineVideoValidator.config["iphone-inline"]===false){return false;}
if(typeof deviceInfo==="undefined"){return false;}
return InlineVideoValidator.isMobileBrowserPlatform()&&InlineVideoValidator.isIOS(deviceInfo)&&InlineVideoValidator.isValidDeviceName(deviceInfo)&&InlineVideoValidator.isValidOS(deviceInfo);};InlineVideoValidator.isValidOS=function(deviceInfo){var valid=false;InlineVideoValidator.VALID_iOS_VERSIONS.forEach(function(osVersionPrefix){if(deviceInfo.getiPhoneOSVersion().indexOf(osVersionPrefix)===0){valid=true;}});return valid;};InlineVideoValidator.isValidDeviceName=function(deviceInfo){var valid=false;InlineVideoValidator.VALID_DEVICE_NAMES.forEach(function(deviceName){if(deviceInfo.getDeviceName()===deviceName){valid=true;}});return valid;};InlineVideoValidator.isMobileBrowserPlatform=function(){if(typeof window["IVAPPS"]!=="undefined"){if(window["IVAPPS"]===window["IV"].default){return true;}}
return false;};InlineVideoValidator.isIOS=function(deviceInfo){return deviceInfo.is_iOS();};InlineVideoValidator.config=null;return InlineVideoValidator;})();IV.InlineVideoValidator=InlineVideoValidator;})(IV||(IV={}));
var IV;(function(IV){var IframeInjector=(function(){function IframeInjector(id,container,iframeConfig){if(container===void 0){container=null;}
if(iframeConfig===void 0){iframeConfig=null;}
this.container=null;this.id=id;this.container=container;this.iframeConfig=iframeConfig?iframeConfig:this.getDefaultIframeConfig();}
IframeInjector.prototype.createIframe=function(){return document.createElement("IFRAME");};IframeInjector.prototype.injectIframeIntoDoc=function(targetDoc,createdIframe){if(targetDoc===void 0){targetDoc=null;}
if(createdIframe===void 0){createdIframe=null;}
var ifr=(createdIframe)?createdIframe:this.createIframe();ifr.id=("iv-ext-ifr-"+this.id+"-")+(new Date().getTime()).toString();ifr.width=this.iframeConfig.width;ifr.height=this.iframeConfig.height;ifr.frameBorder=this.iframeConfig.border;this.setIframeSpecificAttributes(ifr);if(!this.injectIframe(targetDoc,this.container,ifr)){return null;}
return ifr;};IframeInjector.prototype.injectIframeOnElement=function(container,ifr){if(container){container.appendChild(ifr);return true;}
return false;};IframeInjector.prototype.getDefaultIframeConfig=function(){return new IV.IframeConfigBuilder().setWidth("0").setHeight("0").setDisplay("none").setBorder("0").build();};return IframeInjector;})();IV.IframeInjector=IframeInjector;})(IV||(IV={}));
var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var IV;(function(IV){var FriendlyIframeInjector=(function(_super){__extends(FriendlyIframeInjector,_super);function FriendlyIframeInjector(){_super.apply(this,arguments);}
FriendlyIframeInjector.prototype.injectIframe=function(targetDoc,container,ifr){return this.injectIframeOnElement(targetDoc.body,ifr)||this.injectIframeOnElement(container,ifr);};FriendlyIframeInjector.prototype.setIframeSpecificAttributes=function(ifr){ifr.style.display=this.iframeConfig.display;};return FriendlyIframeInjector;})(IV.IframeInjector);IV.FriendlyIframeInjector=FriendlyIframeInjector;})(IV||(IV={}));
var IV;(function(IV){var IframeConfig=(function(){function IframeConfig(builder){this._width=builder.width;this._height=builder.height;this._display=builder.display;this._border=builder.border;this._src=builder.src;this._zIndex=builder.zIndex;this._position=builder.position;this._left=builder.left;this._top=builder.top;this._visibility=builder.visibility;}
Object.defineProperty(IframeConfig.prototype,"width",{get:function(){return this._width;},enumerable:true,configurable:true});Object.defineProperty(IframeConfig.prototype,"height",{get:function(){return this._height;},enumerable:true,configurable:true});Object.defineProperty(IframeConfig.prototype,"display",{get:function(){return this._display;},enumerable:true,configurable:true});Object.defineProperty(IframeConfig.prototype,"border",{get:function(){return this._border;},enumerable:true,configurable:true});Object.defineProperty(IframeConfig.prototype,"src",{get:function(){return this._src;},enumerable:true,configurable:true});Object.defineProperty(IframeConfig.prototype,"zIndex",{get:function(){return this._zIndex;},enumerable:true,configurable:true});Object.defineProperty(IframeConfig.prototype,"position",{get:function(){return this._position;},enumerable:true,configurable:true});Object.defineProperty(IframeConfig.prototype,"left",{get:function(){return this._left;},enumerable:true,configurable:true});Object.defineProperty(IframeConfig.prototype,"top",{get:function(){return this._top;},enumerable:true,configurable:true});Object.defineProperty(IframeConfig.prototype,"visibility",{get:function(){return this._visibility;},enumerable:true,configurable:true});return IframeConfig;})();IV.IframeConfig=IframeConfig;})(IV||(IV={}));
var IV;(function(IV){var IframeConfigBuilder=(function(){function IframeConfigBuilder(){}
Object.defineProperty(IframeConfigBuilder.prototype,"width",{get:function(){return this._width;},enumerable:true,configurable:true});Object.defineProperty(IframeConfigBuilder.prototype,"height",{get:function(){return this._height;},enumerable:true,configurable:true});Object.defineProperty(IframeConfigBuilder.prototype,"display",{get:function(){return this._display;},enumerable:true,configurable:true});Object.defineProperty(IframeConfigBuilder.prototype,"zIndex",{get:function(){return this._zIndex;},enumerable:true,configurable:true});Object.defineProperty(IframeConfigBuilder.prototype,"border",{get:function(){return this._border;},enumerable:true,configurable:true});Object.defineProperty(IframeConfigBuilder.prototype,"src",{get:function(){return this._src;},enumerable:true,configurable:true});Object.defineProperty(IframeConfigBuilder.prototype,"position",{get:function(){return this._position;},enumerable:true,configurable:true});Object.defineProperty(IframeConfigBuilder.prototype,"left",{get:function(){return this._left;},enumerable:true,configurable:true});Object.defineProperty(IframeConfigBuilder.prototype,"top",{get:function(){return this._top;},enumerable:true,configurable:true});Object.defineProperty(IframeConfigBuilder.prototype,"visibility",{get:function(){return this._visibility;},enumerable:true,configurable:true});IframeConfigBuilder.prototype.setWidth=function(value){this._width=value;return this;};IframeConfigBuilder.prototype.setHeight=function(value){this._height=value;return this;};IframeConfigBuilder.prototype.setDisplay=function(value){this._display=value;return this;};IframeConfigBuilder.prototype.setZIndex=function(value){this._zIndex=value;return this;};IframeConfigBuilder.prototype.setPosition=function(value){this._position=value;return this;};IframeConfigBuilder.prototype.setLeft=function(value){this._left=value;return this;};IframeConfigBuilder.prototype.setTop=function(value){this._top=value;return this;};IframeConfigBuilder.prototype.setBorder=function(value){this._border=value;return this;};IframeConfigBuilder.prototype.setSrc=function(value){this._src=value;return this;};IframeConfigBuilder.prototype.setVisibility=function(value){this._visibility=value;return this;};IframeConfigBuilder.prototype.build=function(){return new IV.IframeConfig(this);};return IframeConfigBuilder;})();IV.IframeConfigBuilder=IframeConfigBuilder;})(IV||(IV={}));
var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var IV;(function(IV){var NonFriendlyIframeInjector=(function(_super){__extends(NonFriendlyIframeInjector,_super);function NonFriendlyIframeInjector(){_super.apply(this,arguments);}
NonFriendlyIframeInjector.prototype.injectIframe=function(targetDoc,container,ifr){return this.injectIframeOnElement(container,ifr);};NonFriendlyIframeInjector.prototype.setIframeSpecificAttributes=function(ifr){ifr.src=this.iframeConfig.src;ifr.style.zIndex=this.iframeConfig.zIndex;ifr.style.position=this.iframeConfig.position;ifr.style.left=this.iframeConfig.left;ifr.style.top=this.iframeConfig.top;ifr.style.visibility=this.iframeConfig.visibility;};return NonFriendlyIframeInjector;})(IV.IframeInjector);IV.NonFriendlyIframeInjector=NonFriendlyIframeInjector;})(IV||(IV={}));
var IV;(function(IV){var DisplayAdMeasurementListener=(function(){function DisplayAdMeasurementListener(core){this.core=core;}
Object.defineProperty(DisplayAdMeasurementListener,"AD_SIZE_MEASUREMENT_INTERVAL_MS",{get:function(){return 200;},enumerable:true,configurable:true});;DisplayAdMeasurementListener.prototype.onValidAdSize=function(callback){var _this=this;var startIntervalSizeMeasurement=null;startIntervalSizeMeasurement=setInterval(function(){var contextWindow=_this.core.get("contextWindow");if(IV.DisplayAdSizeValidator.isValidAdSize(contextWindow.innerWidth,contextWindow.innerHeight)){callback({width:contextWindow.innerWidth,height:contextWindow.innerHeight});clearInterval(startIntervalSizeMeasurement);}},DisplayAdMeasurementListener.AD_SIZE_MEASUREMENT_INTERVAL_MS);};return DisplayAdMeasurementListener;})();IV.DisplayAdMeasurementListener=DisplayAdMeasurementListener;})(IV||(IV={}));
var IV;(function(IV){var DisplayAdMeasurementReporter=(function(){function DisplayAdMeasurementReporter(irollReporter){this.irollReporter=irollReporter;}
DisplayAdMeasurementReporter.prototype.reportValidSize=function(validSize){this.irollReporter.submit({action:"measure",event_id:"size",event_value:validSize.width+"x"+validSize.height});};return DisplayAdMeasurementReporter;})();IV.DisplayAdMeasurementReporter=DisplayAdMeasurementReporter;})(IV||(IV={}));
var IV;(function(IV){var DisplayAdSizeValidator=(function(){function DisplayAdSizeValidator(){}
DisplayAdSizeValidator.isValidAdSize=function(width,height){var invalidSizes=[0,1];return invalidSizes.indexOf(width)<0||invalidSizes.indexOf(height)<0;};return DisplayAdSizeValidator;})();IV.DisplayAdSizeValidator=DisplayAdSizeValidator;})(IV||(IV={}));
var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var IV;(function(IV){var DisplayCanvasAppender=(function(_super){__extends(DisplayCanvasAppender,_super);function DisplayCanvasAppender(core){_super.call(this,core);}
DisplayCanvasAppender.prototype.getSize=function(){if(this.core.isResponsive()){return{width:"100%",height:"100%"};}
var adData=this.core.get("data").video;return{width:adData.width,height:adData.height};};DisplayCanvasAppender.prototype.setContainer=function(mainContainer){if(!this.isParentElementReallyAnElement(IV._currentScript)||this.isParentElementOfTypeHead(IV._currentScript)){_super.prototype.setContainer.call(this,mainContainer);}
else{this.mainContainer=IV._currentScript.parentElement;}};DisplayCanvasAppender.prototype.appendToContainer=function(elem){var adSize=this.getSize();$(elem).css({width:adSize.width+"px",height:adSize.height+"px"});_super.prototype.appendToContainer.call(this,elem);};DisplayCanvasAppender.prototype.isParentElementOfTypeHead=function(currentScript){return _.isString(IV._currentScript.parentElement.nodeName)&&IV._currentScript.parentElement.nodeName.toUpperCase()==="HEAD";};DisplayCanvasAppender.prototype.isParentElementReallyAnElement=function(currentScript){return IV._currentScript&&_.isElement(IV._currentScript)&&_.isElement(IV._currentScript.parentElement);};return DisplayCanvasAppender;})(IV.CanvasAppender);IV.DisplayCanvasAppender=DisplayCanvasAppender;})(IV||(IV={}));
var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var IV;(function(IV){var DisplayClickthruRedirectHelper=(function(_super){__extends(DisplayClickthruRedirectHelper,_super);function DisplayClickthruRedirectHelper(adConfig,reporter,getPlayStartTime,macroMapper){_super.call(this,adConfig,reporter,getPlayStartTime);this.macroMapper=macroMapper;}
DisplayClickthruRedirectHelper.prototype.redirect=function(clickthruUrl,label,value){var replacedClickthruUrl=IV.DisplayPublisherClickthruHandler.replaceClickthru(this.macroMapper,clickthruUrl);this.reporter.reportLog({event_id:"display-click-through",event_value:replacedClickthruUrl||""});return _super.prototype.redirect.call(this,replacedClickthruUrl,label,value||this.publisherTrackerValue(clickthruUrl,replacedClickthruUrl));};DisplayClickthruRedirectHelper.prototype.publisherTrackerValue=function(clickthruUrl,replacedClickthruUrl){return this.hasPublisherTracker(clickthruUrl,replacedClickthruUrl)?(void 0):"no-publisher-tracker";};DisplayClickthruRedirectHelper.prototype.hasPublisherTracker=function(clickthruUrl,replacedClickthruUrl){return clickthruUrl!==replacedClickthruUrl||this.reporter.get("display-publisher-tracker")===true;};return DisplayClickthruRedirectHelper;})(IV.ClickthruRedirectHelper);IV.DisplayClickthruRedirectHelper=DisplayClickthruRedirectHelper;})(IV||(IV={}));
var IV;(function(IV){var DisplayEventListener=(function(){function DisplayEventListener(){}
DisplayEventListener.startListenToDisplayEvents=function(){IV.Events.on("IRollInit",function(irollCore){var player=new IV.PassThruPlayer();irollCore.set("videoPlayer",player);player.init();IV.DisplayPublisherClickthruHandler.initData(irollCore);});};return DisplayEventListener;})();IV.DisplayEventListener=DisplayEventListener;DisplayEventListener.startListenToDisplayEvents();})(IV||(IV={}));
var IV;(function(IV){var DisplayMraidImpl=(function(){function DisplayMraidImpl(win,mraidScriptSource,mraidScriptLoader){if(win===void 0){win=window;}
if(mraidScriptSource===void 0){mraidScriptSource=DisplayMraidImpl.MRAID_SCRIPT_SOURCE;}
if(mraidScriptLoader===void 0){mraidScriptLoader=new IV.DisplayMraidScriptLoader();}
this.win=win;this.mraidScriptSource=mraidScriptSource;this.mraidScriptLoader=mraidScriptLoader;}
Object.defineProperty(DisplayMraidImpl,"MRAID_EVENTS",{get:function(){return{READY:"ready",VIEWABLE_CHANGE:"viewableChange"};},enumerable:true,configurable:true});Object.defineProperty(DisplayMraidImpl,"MRAID_STATES",{get:function(){return{LOADING:"loading"};},enumerable:true,configurable:true});Object.defineProperty(DisplayMraidImpl,"MRAID_SCRIPT_SOURCE",{get:function(){return"mraid.js";},enumerable:true,configurable:true});DisplayMraidImpl.prototype.loadMraid=function(onMraidFound,onViewable,onException){try{var mraidAd=this.getMraid();if(!mraidAd){this.loadMraidScript(onMraidFound,onViewable);}
else{onMraidFound(true);this.triggerMraidAvailableEvent(true);this.listenToReady(mraidAd,onViewable);}}
catch(e){onException(e.message||e.description||e);this.triggerMraidAvailableEvent(false);}};DisplayMraidImpl.prototype.loadMraidScript=function(onMraidFound,onViewable){var _this=this;this.mraidScriptLoader.loadScript(this.mraidScriptSource,function(){var mraidAd=_this.getMraid();onMraidFound(true);_this.listenToReady(mraidAd,onViewable);_this.triggerMraidAvailableEvent(true);},function(){onMraidFound(false);_this.triggerMraidAvailableEvent(false);});};DisplayMraidImpl.prototype.triggerMraidAvailableEvent=function(isMraidAvailable){IV.Events.trigger("mraid:available",isMraidAvailable);};DisplayMraidImpl.prototype.getMraid=function(){try{return this.win.top.mraid;}
catch(e){return null;}};DisplayMraidImpl.prototype.listenToReady=function(mraidAd,onViewable){var _this=this;if(mraidAd.getState()===DisplayMraidImpl.MRAID_STATES.LOADING){var onReady=function(){_this.listenToViewable(mraidAd,onViewable);mraidAd.removeEventListener(DisplayMraidImpl.MRAID_EVENTS.READY,onReady);};mraidAd.addEventListener(DisplayMraidImpl.MRAID_EVENTS.READY,onReady);}
else{this.listenToViewable(mraidAd,onViewable);}};DisplayMraidImpl.prototype.listenToViewable=function(mraidAd,onViewable){if(mraidAd.isViewable()){onViewable();}
else{var onViewableChange=function(viewable){if(viewable===true||viewable==="true"){onViewable();mraidAd.removeEventListener(DisplayMraidImpl.MRAID_EVENTS.VIEWABLE_CHANGE,onViewableChange);}};mraidAd.addEventListener(DisplayMraidImpl.MRAID_EVENTS.VIEWABLE_CHANGE,onViewableChange);}};return DisplayMraidImpl;})();IV.DisplayMraidImpl=DisplayMraidImpl;})(IV||(IV={}));
var IV;(function(IV){var DisplayMraidScriptLoader=(function(){function DisplayMraidScriptLoader(win){if(win===void 0){win=window;}
this.win=win;}
DisplayMraidScriptLoader.prototype.loadScript=function(mraidScriptSource,onLoad,onError){try{var topDoc=this.win.top.document;var scr=topDoc.createElement("script");var head=topDoc.head||topDoc.getElementsByTagName("head")[0];scr.src=mraidScriptSource;scr.onload=onLoad;scr.onerror=onError;head.appendChild(scr);}
catch(e){onError();}};return DisplayMraidScriptLoader;})();IV.DisplayMraidScriptLoader=DisplayMraidScriptLoader;})(IV||(IV={}));
var IV;(function(IV){var DisplayPublisherClickthruHandler=(function(){function DisplayPublisherClickthruHandler(){}
DisplayPublisherClickthruHandler.initData=function(irollCore){var macroMapper=irollCore.macroMapper;var reporter=irollCore.report;var hotSpotClicks=irollCore.get("data")["placement-config"]["hotspot-clicks"];var pubTracking=decodeURIComponent(macroMapper.expandAll("{ivc_click_tracker}"));if(pubTracking){reporter.set("display-publisher-tracker",true);hotSpotClicks.forEach(function(hotspot){if(hotspot.type==="click-thru"){hotspot.tracking=hotspot.tracking||[];hotspot.tracking.push({data:pubTracking,type:IV.ThirdPartyTrackingReporter.URL_TRACKING_TYPE});}});}};DisplayPublisherClickthruHandler.replaceClickthru=function(macroMapper,url){var pubClickthru=decodeURIComponent(macroMapper.expandAll("{ivc_click_through}"));if(pubClickthru&&pubClickthru.indexOf("http")===0){url=pubClickthru+url;}
return url;};return DisplayPublisherClickthruHandler;})();IV.DisplayPublisherClickthruHandler=DisplayPublisherClickthruHandler;})(IV||(IV={}));
var IV;(function(IV){var DisplaySubloadListener=(function(){function DisplaySubloadListener(core){this.reporter=core.report;this.core=core;}
DisplaySubloadListener.prototype.startListening=function(){var _this=this;IV.Events.on(this.core.get("id")+":subload",_.once(function(eventId){_this.reporter.submit({action:"subload",event_id:eventId});}));};return DisplaySubloadListener;})();IV.DisplaySubloadListener=DisplaySubloadListener;})(IV||(IV={}));
var IV;(function(IV){var DisplayViewabilityListener=(function(){function DisplayViewabilityListener(core,mraidImpl,reporter){this.core=core;this.mraidImpl=mraidImpl;this.reporter=reporter;}
DisplayViewabilityListener.prototype.startListening=function(){var _this=this;IV.Events.on(this.core.get("id")+":viewability:start",_.once(function(){_this.mraidImpl.loadMraid(_.once(function(found){_this.reporter.reportMraidFound(found);}),_.once(function(){_this.reporter.reportMraidViewable();}),_.once(function(message){_this.reporter.reportMraidError(message);}));}));};return DisplayViewabilityListener;})();IV.DisplayViewabilityListener=DisplayViewabilityListener;})(IV||(IV={}));
var IV;(function(IV){var DisplayViewabilityReporter=(function(){function DisplayViewabilityReporter(reporter){this.reporter=reporter;}
DisplayViewabilityReporter.prototype.reportMraidFound=function(found){if(found){this.reporter.submit({action:"viewmraid",event_id:"found"});}
else{this.reporter.submit({action:"viewmraid",event_id:"no-mraid"});}};DisplayViewabilityReporter.prototype.reportMraidViewable=function(){this.reporter.submit({action:"viewmraid",event_id:"viewable"});};DisplayViewabilityReporter.prototype.reportMraidError=function(message){this.reporter.reportLog({event_id:"mraid-error",event_value:message});};return DisplayViewabilityReporter;})();IV.DisplayViewabilityReporter=DisplayViewabilityReporter;})(IV||(IV={}));
;
(function(SCOPE){var CLICK_THROUGH_PREVIEW_TEMPLATE=_.template("<%= appPath %>jsapps/html/click/preview?cb=<%= cb %>&label=<%= label %>");var format;SCOPE.CustomFormat=function(iroll,data){var that=this,disableClickTruReporting=false,inUnitVidQuartileReporters=[],videoVolumeHandlers=[];this.iroll=iroll;this.data=data;this.Events=function(){};_.extend(this.Events,Backbone.Events);this.play=function(){var videoPlayer=iroll.get('videoPlayer');if(videoPlayer.isPlaying()){this.Events.trigger("video_play");}
videoPlayer.play();};this.pause=function(){iroll.get('videoPlayer').pause();};this.skip=function(){var skipAdHandler=new SCOPE.SkipAdHandler(iroll);skipAdHandler.skipAd();};this.preparePlay=function(){iroll.get('videoPlayer').preparePlay();};this.getDevicePlatformType=function(){return SCOPE.device.getPlatformType();};this.getDeviceOSType=function(){return SCOPE.device.getOSType();};this.canPlayInline=function(){return SCOPE.device.canPlayInline()||this.iroll.supportFeature("inlineVideo");};this.initVideo=function(videoElem,videoData){var elem=new SCOPE.VideoElementWrapper(videoElem),videoLoader=new SCOPE.VideoSourceLoader(elem,iroll),spy=new SCOPE.VideoSpy(elem);if(_.isUndefined(videoData.media))
{throw"could not find a video 'media' data in config";}
if(_.isUndefined(videoData.media.renditions))
{throw"could not find a video 'renditions' data in the config";}
bindInUnitVideoVolumeHandler();bindInUnitVideoQuartileReporter();videoLoader.loadVideoSource(videoData.media.renditions);function bindInUnitVideoVolumeHandler(){var videoVolumeHandler=new SCOPE.VideoVolumeHandler(videoElem);videoVolumeHandler.bindVolumeChangeEvent(iroll.get("videoPlayer").getVolume());videoVolumeHandlers.push(videoVolumeHandler);}
function bindInUnitVideoQuartileReporter(){var inUnitVidQuartileReporter=new SCOPE.InUnitVideoQuartileReporter(iroll,spy,videoData.name,function(){return iroll.get('playStartTime');},new SCOPE.ConsoleLogUtil());inUnitVidQuartileReporter.start();inUnitVidQuartileReporters.push(inUnitVidQuartileReporter);}};this.disableClickTruReporting=function(){disableClickTruReporting=true;};this.enableClickTruReporting=function(){disableClickTruReporting=false;};this.reportHotSpotTracking=function(eventId){if(_.isObject(this.iroll.get('data')['placement-config'])){var hotSpotClicks=this.iroll.get('data')['placement-config']['hotspot-clicks'];if(hotSpotClicks){hotSpotClicks.forEach(function(hotspot){if(hotspot.id===eventId&&hotspot.tracking){that.iroll.report.submit3rdPartyTracking(hotspot.tracking);}});}}};this.transformToInlineVideo=function(videoElem){SCOPE.InlineVideoFactory.create(videoElem);};this.shouldTransformToInlineVideo=function(){return SCOPE.InlineVideoValidator.shouldTransformToInlineVideo(SCOPE.device);};this.checkAndOverrideFastSeek=function(videoElem){SCOPE.InlineVideoTransformer.checkAndOverrideFastSeek(videoElem);};this.openUrl=function(label){SCOPE.Events.trigger(iroll.get('id')+':userClick');if(!disableClickTruReporting&&!iroll.childVideoService.childVideoPlaying()){iroll.report.clickthru(label);}
that.reportHotSpotTracking(label);if(iroll.get('videoPlayer').isPlaying()){iroll.get('videoPlayer').pause();}
if(iroll.get('reportEventsToConsole')){console.log(">>>> HTML Custom clickthru label: "+label);}};this.getStudioProperties=function(studioPropConf,key){return SCOPE.StudioPropsRetriever.getStudioPropByKey(studioPropConf,key);};this.reportSlateEvent=function(action){var relativeTime=0;if(iroll.get('playStartTime')){relativeTime=new Date().getTime()-iroll.get('playStartTime');}
iroll.report.submit({action:action,event_id:'slate',event_value:'click',relative_time:relativeTime});};this.shouldWrapCreativeWithIframe=function(){return iroll.shouldWrapCreativeWithIframe();};this.checkViewability=function(elem){SCOPE.Events.trigger(iroll.get('id')+':viewability:start',elem);};this.triggerSubload=function(eventId){SCOPE.Events.trigger(iroll.get('id')+':subload',eventId);};this.isPreviewMode=function(){return SCOPE.ViewModeDetector.isPreviewMode(this.iroll.get('data'));};this.redirectClickthroughPage=function(label,url){if(_.isUndefined(url)||_.isEmpty(url)){window.open(CLICK_THROUGH_PREVIEW_TEMPLATE({appPath:SCOPE.baseData.appPath,cb:SCOPE.baseData.mobileCoreVersion,label:label}));}else{window.open(url);}};var reportEventHandler=function(type,label,value){var logParam="";iroll.report.submit({action:'clkint',relative_time:(new Date().getTime()-iroll.get('playStartTime')),event_id:label,event_value:value||''});that.reportHotSpotTracking(label);if(type==="reportEventWithoutEngagement"){logParam="- no engagement"}
if(iroll.get('reportEventsToConsole')){console.log(">>>> HTML Custom in-unit label%s: %s (event value = %s)",logParam,label,value);}};var reportCreativeDebugHandler=function(label,value){iroll.report.reportCreativeDebugLog({action:'creative',relative_time:(new Date().getTime()-iroll.get('playStartTime')),event_id:label,event_value:value||''});};var reportCreativeDebugListener=function(){that.Events.on('reportCreativeDebugEvent',function(label,value){reportCreativeDebugHandler(label,value);});};var setAndReportVersionId=function(versionIdLabel,versionIdValue){iroll.report.setVersionId(iroll.get('version_id'));iroll.report.submit({action:'version',relative_time:(new Date().getTime()-iroll.get('playStartTime')),event_id:versionIdLabel,event_value:versionIdValue||''});};var versionIdListener=function(){that.Events.on('setAndReportVersionId',function(label,value){setAndReportVersionId(label,value);})};function mapFormatEventsToCoreActions(){that.Events.on('ad_play',function(forceImmediateImpression){SCOPE.Events.trigger(iroll.get('id')+':ad_play',forceImmediateImpression);});that.Events.on('ad_ended',function(){SCOPE.Events.trigger(iroll.get('id')+':ad_ended');});that.Events.on('userClick',function(){SCOPE.Events.trigger(iroll.get('id')+':userClick');});that.Events.on('reportEvent',function(label,value){SCOPE.Events.trigger(iroll.get('id')+':userClick');reportEventHandler("reportEvent",label,value);});that.Events.on('reportEventWithoutEngagement',function(label,value){reportEventHandler("reportEventWithoutEngagement",label,value);});that.Events.on('timeEarnedStart',function(){that.pause();that.reportSlateEvent('cxon');});that.Events.on('slateOpened',function(){SCOPE.Events.trigger(iroll.get('id')+':slateOpened');that.iroll.fireTrackingEvent("adOverlayShowExpanded");if(!(SCOPE.device.canPlayInline()||iroll.get("inlinePlaybackForced"))){iroll.get("videoPlayer").exitFullScreen();}});that.Events.on('surveyOpened',function(){SCOPE.Events.trigger(iroll.get('id')+':surveyOpened');});that.Events.on('timeEarnedStop',function(playAgain){if(playAgain)that.play();that.reportSlateEvent('cxoff');});that.Events.on('slateClosed',function(){SCOPE.Events.trigger(iroll.get('id')+':slateClosed');that.iroll.fireTrackingEvent("adOverlayHideExpanded");});that.Events.on('surveyClosed',function(){SCOPE.Events.trigger(iroll.get('id')+':surveyClosed');});that.Events.on('auto_engage',function(){SCOPE.Events.trigger(iroll.get('id')+':auto_engage');});}
function mapCoreEventsToFormatEvents(){SCOPE.Events.on('winResize',function(){var scale=iroll.canvas.getDefaultFontSize()*iroll.canvas.getScale();iroll.canvas.setScale(scale);that.Events.trigger('winResize');});SCOPE.Events.on('orientationChange',function(){that.Events.trigger('orientationChange');});SCOPE.Events.on("volumechange",function(vol){that.Events.trigger("volumechange",vol);});SCOPE.Events.on(iroll.get('id')+':video_play',function(){that.Events.trigger('video_play');});SCOPE.Events.on(iroll.get('id')+':video_pause',function(){that.Events.trigger('video_pause');});SCOPE.Events.on(iroll.get('id')+':video_ended',function(){that.Events.trigger('video_ended');});SCOPE.Events.on(iroll.get('id')+':video_videoPassed25',function(){that.Events.trigger('video_videoPassed25');});SCOPE.Events.on(iroll.get('id')+':video_videoPassed50',function(){that.Events.trigger('video_videoPassed50');});SCOPE.Events.on(iroll.get('id')+':video_videoPassed75',function(){that.Events.trigger('video_videoPassed75');});}
SCOPE.Events.on(iroll.get('id')+':video_exitfullscreen',function(){SCOPE.Events.trigger('video_ended');});mapFormatEventsToCoreActions();mapCoreEventsToFormatEvents();reportCreativeDebugListener();versionIdListener();};SCOPE.Events.on("IRollInit",function(core){var forceInternalPlayer=core.shouldForceInternalPlayer();var initialVolume=core.has("videoPlayer")?core.get("videoPlayer").getVolume():1;if(forceInternalPlayer){core.setAttribute({videoPlayer:new SCOPE.InternalVideoPlayer(core,initialVolume)});}});SCOPE.Events.on("IRollReady",function(iroll,data){format=new SCOPE.CustomFormat(iroll,data);var canvas=iroll.canvas;var loadingSpinner=$('<div id="iv-buffering-spinner"></div>');loadingSpinner.width(canvas.getSize().width).height(canvas.getSize().height);canvas.addElement(loadingSpinner);SCOPE.Events.on('winResize',function(){loadingSpinner.width(canvas.getSize().width).height(canvas.getSize().height);});SCOPE.Events.on('buffering',function(){loadingSpinner.addClass("iv-buffering");});SCOPE.Events.on('not_buffering',function(){loadingSpinner.removeClass("iv-buffering");});var scale=canvas.getDefaultFontSize()*canvas.getScale();canvas.setScale(scale);canvas.registerInteractEvent();SCOPE.Events.trigger("CustomFormatReady",format);},this);})(IV);
(function(SCOPE){SCOPE.DisplayApiListener=function(context){var iroll=context.getIroll();var TARGET_NAME="innovid";var eventsMap={"open-url":openURL,"user-interaction-event":reportEvent,"custom-creative-event":reportEventWithoutEngagement,"enable-user-interaction-events":disableMainClickthru};this.startListening=function(){window.addEventListener("message",onMsgFromBanner);};function onMsgFromBanner(event){var eventData;try{eventData=JSON.parse(event.data);}catch(e){return;}
if(!eventData.target||eventData.target.toLowerCase()!==TARGET_NAME){return;}
console.log(">>> Banner Event Data: ",eventData);if(eventsMap.hasOwnProperty(eventData.type)){eventsMap[eventData.type](eventData);}else if(eventData.target.toLowerCase()==TARGET_NAME){throw new Error("Innovid Display: Invalid Event Type ["+eventData.type+"]");}}
function openURL(data){iroll.openURL(data.label,data.url);}
function reportEvent(data){iroll.reportEvent(data.label,data.value);}
function reportEventWithoutEngagement(data){iroll.reportEventWithoutEngagement(data.label,data.value);}
function disableMainClickthru(){console.log("Disabling Main Clickthru");$(".iv-mouse-capture-overlay").hide();$("#iv-buffering-spinner").hide();$("#iva-display-sub-load-html-banner").css("pointer-events","auto");}};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.DisplayCreativeBuilder=function(context,iframe){var DEFAULT_TIMEOUT_SEC=4;var props={timeoutSec:DEFAULT_TIMEOUT_SEC};var mandatoryFields=["sourceUrl","size"];this.withSourceUrl=function(sourceUrl){props.sourceUrl=sourceUrl;return this;};this.withId=function(id){props.id=id;return this;};this.withSize=function(size){props.size=size;return this;};this.withTimeoutSec=function(timeoutSec){props.timeoutSec=timeoutSec;return this;};this.buildInitialLoader=function(type){var banner=buildBannerByType(type);return new SCOPE.InitialLoader(context,banner);};this.buildSubLoader=function(type){var banner=buildBannerByType(type);return new SCOPE.SubLoader(context,banner,props.timeoutSec);};this.buildEmptySubLoader=function(){var banner=new SCOPE.EmptyImageBanner(context);return new SCOPE.SubLoader(context,banner,props.timeoutSec);};function buildBannerByType(type){throwOnMandatoryFieldNotDefined();var typeBuilder={};typeBuilder[SCOPE.DisplayCreativeBuilder.HtmlType]=buildHTMLBanner;typeBuilder[SCOPE.DisplayCreativeBuilder.ImageType]=buildImageBanner;var banner=typeBuilder[type]();if(props.id){banner.setId(props.id);}
return banner;}
function throwOnMandatoryFieldNotDefined(){if(!mandatoryFields.every(isFieldDefined)){throw Error("Not all madaotry fields defined: "+mandatoryFields.join(","));}}
function isFieldDefined(field){return typeof props[field]!=="undefined";}
function buildHTMLBanner(){return new SCOPE.HTMLBanner(context,buildBannerProps());}
function buildImageBanner(){return new SCOPE.ImageBanner(context,buildBannerProps());}
function buildBannerProps(){return{sourceUrl:props.sourceUrl,size:props.size,iframe:iframe};}};SCOPE.DisplayCreativeBuilder.ImageType="IMAGE";SCOPE.DisplayCreativeBuilder.HtmlType="HTML";})(IVA||(IVA={}));
(function(SCOPE){var StudioProp={POLITE_IMAGE_FILE:"polite_image_file",IMAGE_BANNER_FILE:"image_file",HTML_BANNER_FILE:"html_file",PAGE_LOAD_TIMEOUT:"page_load_timeout_sec",AD_WIDTH:"ad_width",AD_HEIGHT:"ad_height"};SCOPE.DisplayStudioPropertiesRetriever=function(){function getSubLoadType(htmlSubLoadSource){return htmlSubLoadSource?SCOPE.DisplayCreativeBuilder.HtmlType:SCOPE.DisplayCreativeBuilder.ImageType;}
this.getStudioProperties=function(context){var onlyInitialLoading=false;var initialLoadSource=context.getStudioPropertiesConfig(StudioProp.POLITE_IMAGE_FILE);var imageSubLoadSource=context.getStudioPropertiesConfig(StudioProp.IMAGE_BANNER_FILE);var htmlSubLoadSource=context.getStudioPropertiesConfig(StudioProp.HTML_BANNER_FILE);var timeoutSec=context.getStudioPropertiesConfig(StudioProp.PAGE_LOAD_TIMEOUT);var adWidth=context.getStudioPropertiesConfig(StudioProp.AD_WIDTH);var adHeight=context.getStudioPropertiesConfig(StudioProp.AD_HEIGHT);var adSize={width:adWidth,height:adHeight};var subLoadType=getSubLoadType(htmlSubLoadSource);var initialLoadType=SCOPE.DisplayCreativeBuilder.ImageType;if(!initialLoadSource){initialLoadSource=imageSubLoadSource||htmlSubLoadSource;imageSubLoadSource=null;htmlSubLoadSource=null;onlyInitialLoading=true;initialLoadType=subLoadType;}
return{onlyInitialLoading:onlyInitialLoading,initialLoadSource:initialLoadSource,imageSubLoadSource:imageSubLoadSource,htmlSubLoadSource:htmlSubLoadSource,timeoutSec:timeoutSec,adSize:adSize,subLoadType:subLoadType,initialLoadType:initialLoadType};};};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.EmptyImageBanner=function(){var el,onLoadCallback;this.onLoad=function(callback){onLoadCallback=callback;};this.load=function(){onLoadCallback('empty');};this.component=SCOPE.createSlate({render:function(){el=$("<div data-ignore='true' class='iva-empty-display-banner-container'/>");return el;},open:function(){},close:function(){}});};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.HTMLBanner=function(context,bannerProps){var el,onLoadCallback,htmlBanner=bannerProps.iframe||createIframe(bannerProps);this.getElement=function(){return htmlBanner[0];};this.load=function(){htmlBanner.on('load',onLoadCallback);htmlBanner[0].style.backgroundColor="transparent";htmlBanner[0].src=bannerProps.sourceUrl+"?"+getExternalParams(false);};this.onLoad=function(callback){onLoadCallback=function(){callback("html");};};this.setId=function(id){htmlBanner[0].id=id;};this.component=SCOPE.createSlate({render:function(){el=$("<div class='iva-display-banner-container'/>");return el;},open:function(){if(!bannerProps.iframe){htmlBanner[0].setAttribute('name',getExternalFeedParams());el.append(htmlBanner);}},close:function(){}});function getExternalParams(shouldStringify){var params=context.getConfig().object("EXTERNAL_CUSTOM_PARAMETERS",{});var feedParams=context.getConfig().object("EXTERNAL_FEED_PARAMETERS",{});for(var key in feedParams){if(params[key]){delete params[key];}}
if(shouldStringify){return"ivc_data="+JSON.stringify(params);}else{return paramsToURL(params);}}
function getExternalFeedParams(){var params=context.getConfig().object("EXTERNAL_CUSTOM_PARAMETERS",{});var feedParams=context.getConfig().object("EXTERNAL_FEED_PARAMETERS",{});for(var key in feedParams){if(params[key]){feedParams[key]=params[key];}}
return paramsToURL(feedParams);}
function paramsToURL(params){return params?Object.keys(params).map(function(key){return encodeURIComponent(key)+'='+encodeURIComponent(params[key]);}).join('&'):'';}
function createIframe(bannerProps){var ifr=$("<iframe scrolling='no' frameborder='0' allowtransparency='true'/>").attr("referrerpolicy",window["referrerpolicy"]).attr("scrolling","no");if(_.isString(bannerProps.size.width)&&_.isString(bannerProps.size.height)){ifr.attr("width",bannerProps.size.width).attr("height",bannerProps.size.height);}else{ifr.width(bannerProps.size.width+"px").height(bannerProps.size.height+"px");}
return ifr;}};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.ImageBanner=function(context,bannerProps){var el,imageElem=createImage(bannerProps),onLoadCb;this.getElement=function(){return imageElem;};this.onLoad=function(callback){onLoadCb=function(){callback("image");};};this.load=function(){imageElem.onload=onLoadCb;imageElem.src=bannerProps.sourceUrl;};this.setId=function(id){imageElem.id=id;};this.component=SCOPE.createSlate({render:function(){el=$("<div class='iva-display-banner-container'/>");return el;},open:function(){el.append($(imageElem));},close:function(){}});function createImage(bannerProps){var $img=$("<img />").attr("width",bannerProps.size.width).attr("height",bannerProps.size.height);if(_.isString(bannerProps.size.width)&&_.isString(bannerProps.size.height)){$img[0].style.objectFit="contain";}
return $img[0];}};})(IVA||(IVA={}));
(function(SCOPE){var PRERENDER_VISIBILITY_STATE="prerender";SCOPE.InitialLoader=function(context,initialLoadBanner){var iroll=context.getIroll();function isPageInPreRenderMode(){return document.visibilityState===PRERENDER_VISIBILITY_STATE;}
function waitForPageToBeInNonPreRenderMode(onNonPreRender){document.addEventListener("visibilitychange",function(){if(!isPageInPreRenderMode()){onNonPreRender();}});}
this.load=function(){var fireImpressionOnce=_.once(function(){console.log("Polite Loaded. Fire impression!");iroll.getProgram().now().close(initialLoadBanner.component);context.__contextImpl.checkViewability(initialLoadBanner.getElement());});initialLoadBanner.onLoad(function(){if(isPageInPreRenderMode()){waitForPageToBeInNonPreRenderMode(fireImpressionOnce);}else{fireImpressionOnce();}});iroll.getProgram().preContentSurvey().open(initialLoadBanner.component);initialLoadBanner.load();return initialLoadBanner;};};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.SubLoader=function(context,subLoadBanner,timeoutSec){var _timeoutId=null;var _timedout=false;this.load=function(){subLoadBanner.onLoad(getOnLoadBannerFunction);context.getIroll().getProgram().beforeVideo().open(subLoadBanner.component);var pageDoc=window.document;try{pageDoc=window.top.document;}catch(ignore){}
waitForPageToBeFullyLoaded(pageDoc,timeoutSec);return subLoadBanner;};function waitForPageToBeFullyLoaded(pageDoc,timeoutSec){var timeoutMs=1000*parseFloat(timeoutSec);_timeoutId=setTimeout(function(){_timedout=true;context.getIroll().reportCreativeDebugEvent("Display_Page_Load_Timeout",1);},timeoutMs);checkPageFullyLoadedOrTimedOut(pageDoc);}
function checkPageFullyLoadedOrTimedOut(pageDoc){if(pageDoc.readyState==='complete'||_timedout){clearTimeout(_timeoutId);subLoadBanner.load();}else{requestAnimationFrame(function(){checkPageFullyLoadedOrTimedOut(pageDoc);});}}
function getOnLoadBannerFunction(eventId){context.__contextImpl.triggerSubload(eventId);}};})(IVA||(IVA={}));
(function(SCOPE){var BannerId={INITIAL_LOAD:"iva-display-initial-load-image",SUB_LOAD_IMAGE:"iva-display-sub-load-image-banner",SUB_LOAD_HTML:"iva-display-sub-load-html-banner"};function subLoadBannerId(htmlSubLoadSource){return htmlSubLoadSource?BannerId.SUB_LOAD_HTML:BannerId.SUB_LOAD_IMAGE;}
function initialLoadBannerId(politeType){return politeType===SCOPE.DisplayCreativeBuilder.ImageType?BannerId.INITIAL_LOAD:BannerId.SUB_LOAD_HTML;}
SCOPE.Display=function(){this.start=function(context,iframe){var iroll=context.getIroll();var displayStudioPropertiesRetriever=new SCOPE.DisplayStudioPropertiesRetriever();var displayStudioProperties=displayStudioPropertiesRetriever.getStudioProperties(context);if(iroll.isResponsive()){displayStudioProperties.adSize.width="100%";displayStudioProperties.adSize.height="100%";}
var displayApiListener=new SCOPE.DisplayApiListener(context);displayApiListener.startListening();var initialLoader=new SCOPE.DisplayCreativeBuilder(context,iframe).withSourceUrl(displayStudioProperties.initialLoadSource).withId(initialLoadBannerId(displayStudioProperties.initialLoadType)).withSize(displayStudioProperties.adSize).buildInitialLoader(displayStudioProperties.initialLoadType);var initialLoadBanner=initialLoader.load();var subLoadCreativeBuilder=new SCOPE.DisplayCreativeBuilder(context,iframe).withSourceUrl(displayStudioProperties.htmlSubLoadSource||displayStudioProperties.imageSubLoadSource).withId(subLoadBannerId(displayStudioProperties.htmlSubLoadSource)).withSize(displayStudioProperties.adSize).withTimeoutSec(displayStudioProperties.timeoutSec);var subBannerLoader=displayStudioProperties.onlyInitialLoading?subLoadCreativeBuilder.buildEmptySubLoader():subLoadCreativeBuilder.buildSubLoader(displayStudioProperties.subLoadType);var subLoadBanner=subBannerLoader.load();iroll.start();return{initialLoadBanner:initialLoadBanner,subLoadBanner:displayStudioProperties.onlyInitialLoading?null:subLoadBanner};};};})(IVA||(IVA={}));
(function(omidGlobal,factory,exports){if(typeof exports==='object'&&typeof exports.nodeName!=='string'){factory(omidGlobal,exports);}else{var exports={};var versions=['1.3.8-dev'];var additionalVersionString='';if(!!additionalVersionString){versions.push(additionalVersionString);}
factory(omidGlobal,exports);function deepFreeze(object){for(var key in object){if(object.hasOwnProperty(key)){object[key]=deepFreeze(object[key]);}}
return Object.freeze(object);}
for(var key in exports){if(exports.hasOwnProperty(key)){if(Object.getOwnPropertyDescriptor(omidGlobal,key)==null){Object.defineProperty(omidGlobal,key,{value:{},});}
versions.forEach(function(version){if(Object.getOwnPropertyDescriptor(omidGlobal[key],version)==null){var frozenObject=deepFreeze(exports[key]);Object.defineProperty(omidGlobal[key],version,{get:function(){return frozenObject;},enumerable:true,});}});}}}}(typeof global==='undefined'?this:global,function(omidGlobal,omidExports){'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0};};};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)};};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a);};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;){c.push(b.value);}
return c;};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a));};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b;};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a;}catch(c){}
return!1;};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b){throw new TypeError(a+" is not extensible");}
return a;}:null;$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b);}else{for(c in b){if("prototype"!=c){if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d);}else{a[c]=b[c];}}}}
a.superClass_=b.prototype;};var module$exports$omid$common$argsChecker={assertTruthyString:function(a,b){if(!b){throw Error("Value for "+a+" is undefined, null or blank.");}
if("string"!==typeof b&&!(b instanceof String)){throw Error("Value for "+a+" is not a string.");}
if(""===b.trim()){throw Error("Value for "+a+" is empty string.");}},assertNotNullObject:function(a,b){if(null==b){throw Error("Value for "+a+" is undefined or null");}},assertNumber:function(a,b){if(null==b){throw Error(a+" must not be null or undefined.");}
if("number"!==typeof b||isNaN(b)){throw Error("Value for "+a+" is not a number");}},assertNumberBetween:function(a,b,c,d){(0,module$exports$omid$common$argsChecker.assertNumber)(a,b);if(b<c||b>d){throw Error("Value for "+a+" is outside the range ["+c+","+d+"]");}},assertFunction:function(a,b){if(!b){throw Error(a+" must not be truthy.");}},assertPositiveNumber:function(a,b){(0,module$exports$omid$common$argsChecker.assertNumber)(a,b);if(0>b){throw Error(a+" must be a positive number.");}}};var module$exports$omid$common$VersionUtils={},module$contents$omid$common$VersionUtils_SEMVER_DIGITS_NUMBER=3;module$exports$omid$common$VersionUtils.isValidVersion=function(a){return /\d+\.\d+\.\d+(-.*)?/.test(a);};module$exports$omid$common$VersionUtils.versionGreaterOrEqual=function(a,b){a=a.split("-")[0].split(".");b=b.split("-")[0].split(".");for(var c=0;c<module$contents$omid$common$VersionUtils_SEMVER_DIGITS_NUMBER;c++){var d=parseInt(a[c],10),e=parseInt(b[c],10);if(d>e){break;}else{if(d<e){return!1;}}}
return!0;};var module$exports$omid$common$ArgsSerDe={},module$contents$omid$common$ArgsSerDe_ARGS_NOT_SERIALIZED_VERSION="1.0.3";module$exports$omid$common$ArgsSerDe.serializeMessageArgs=function(a,b){return(0,module$exports$omid$common$VersionUtils.isValidVersion)(a)&&(0,module$exports$omid$common$VersionUtils.versionGreaterOrEqual)(a,module$contents$omid$common$ArgsSerDe_ARGS_NOT_SERIALIZED_VERSION)?b:JSON.stringify(b);};module$exports$omid$common$ArgsSerDe.deserializeMessageArgs=function(a,b){return(0,module$exports$omid$common$VersionUtils.isValidVersion)(a)&&(0,module$exports$omid$common$VersionUtils.versionGreaterOrEqual)(a,module$contents$omid$common$ArgsSerDe_ARGS_NOT_SERIALIZED_VERSION)?b?b:[]:b&&"string"===typeof b?JSON.parse(b):[];};var module$exports$omid$common$constants={AdEventType:{IMPRESSION:"impression",LOADED:"loaded",GEOMETRY_CHANGE:"geometryChange",SESSION_START:"sessionStart",SESSION_ERROR:"sessionError",SESSION_FINISH:"sessionFinish",MEDIA:"media",VIDEO:"video",START:"start",FIRST_QUARTILE:"firstQuartile",MIDPOINT:"midpoint",THIRD_QUARTILE:"thirdQuartile",COMPLETE:"complete",PAUSE:"pause",RESUME:"resume",BUFFER_START:"bufferStart",BUFFER_FINISH:"bufferFinish",SKIPPED:"skipped",VOLUME_CHANGE:"volumeChange",PLAYER_STATE_CHANGE:"playerStateChange",AD_USER_INTERACTION:"adUserInteraction",STATE_CHANGE:"stateChange"},MediaEventType:{LOADED:"loaded",START:"start",FIRST_QUARTILE:"firstQuartile",MIDPOINT:"midpoint",THIRD_QUARTILE:"thirdQuartile",COMPLETE:"complete",PAUSE:"pause",RESUME:"resume",BUFFER_START:"bufferStart",BUFFER_FINISH:"bufferFinish",SKIPPED:"skipped",VOLUME_CHANGE:"volumeChange",PLAYER_STATE_CHANGE:"playerStateChange",AD_USER_INTERACTION:"adUserInteraction"},ImpressionType:{DEFINED_BY_JAVASCRIPT:"definedByJavaScript",UNSPECIFIED:"unspecified",LOADED:"loaded",BEGIN_TO_RENDER:"beginToRender",ONE_PIXEL:"onePixel",VIEWABLE:"viewable",AUDIBLE:"audible",OTHER:"other"},ErrorType:{GENERIC:"generic",VIDEO:"video",MEDIA:"media"},AdSessionType:{NATIVE:"native",HTML:"html",JAVASCRIPT:"javascript"},EventOwner:{NATIVE:"native",JAVASCRIPT:"javascript",NONE:"none"},AccessMode:{FULL:"full",LIMITED:"limited"},AppState:{BACKGROUNDED:"backgrounded",FOREGROUNDED:"foregrounded"},Environment:{APP:"app",WEB:"web"},InteractionType:{CLICK:"click",INVITATION_ACCEPT:"invitationAccept"},CreativeType:{DEFINED_BY_JAVASCRIPT:"definedByJavaScript",HTML_DISPLAY:"htmlDisplay",NATIVE_DISPLAY:"nativeDisplay",VIDEO:"video",AUDIO:"audio"},MediaType:{DISPLAY:"display",VIDEO:"video"},Reason:{NOT_FOUND:"notFound",HIDDEN:"hidden",BACKGROUNDED:"backgrounded",VIEWPORT:"viewport",OBSTRUCTED:"obstructed",CLIPPED:"clipped"},SupportedFeatures:{CONTAINER:"clid",VIDEO:"vlid"},VideoPosition:{PREROLL:"preroll",MIDROLL:"midroll",POSTROLL:"postroll",STANDALONE:"standalone"},VideoPlayerState:{MINIMIZED:"minimized",COLLAPSED:"collapsed",NORMAL:"normal",EXPANDED:"expanded",FULLSCREEN:"fullscreen"},NativeViewKeys:{X:"x",LEFT:"left",Y:"y",TOP:"top",WIDTH:"width",HEIGHT:"height",AD_SESSION_ID:"adSessionId",IS_FRIENDLY_OBSTRUCTION_FOR:"isFriendlyObstructionFor",CLIPS_TO_BOUNDS:"clipsToBounds",CHILD_VIEWS:"childViews",END_X:"endX",END_Y:"endY",OBSTRUCTIONS:"obstructions",OBSTRUCTION_CLASS:"obstructionClass",OBSTRUCTION_PURPOSE:"obstructionPurpose",OBSTRUCTION_REASON:"obstructionReason",PIXELS:"pixels"},MeasurementStateChangeSource:{CONTAINER:"container",CREATIVE:"creative"},ElementMarkup:{OMID_ELEMENT_CLASS_NAME:"omid-element"},CommunicationType:{NONE:"NONE",DIRECT:"DIRECT",POST_MESSAGE:"POST_MESSAGE"},OmidImplementer:{OMSDK:"omsdk"}};var module$contents$omid$common$InternalMessage_GUID_KEY="omid_message_guid",module$contents$omid$common$InternalMessage_METHOD_KEY="omid_message_method",module$contents$omid$common$InternalMessage_VERSION_KEY="omid_message_version",module$contents$omid$common$InternalMessage_ARGS_KEY="omid_message_args",module$exports$omid$common$InternalMessage=function(a,b,c,d){this.guid=a;this.method=b;this.version=c;this.args=d;};module$exports$omid$common$InternalMessage.isValidSerializedMessage=function(a){return!!a&&void 0!==a[module$contents$omid$common$InternalMessage_GUID_KEY]&&void 0!==a[module$contents$omid$common$InternalMessage_METHOD_KEY]&&void 0!==a[module$contents$omid$common$InternalMessage_VERSION_KEY]&&"string"===typeof a[module$contents$omid$common$InternalMessage_GUID_KEY]&&"string"===typeof a[module$contents$omid$common$InternalMessage_METHOD_KEY]&&"string"===typeof a[module$contents$omid$common$InternalMessage_VERSION_KEY]&&(void 0===a[module$contents$omid$common$InternalMessage_ARGS_KEY]||void 0!==a[module$contents$omid$common$InternalMessage_ARGS_KEY]);};module$exports$omid$common$InternalMessage.deserialize=function(a){return new module$exports$omid$common$InternalMessage(a[module$contents$omid$common$InternalMessage_GUID_KEY],a[module$contents$omid$common$InternalMessage_METHOD_KEY],a[module$contents$omid$common$InternalMessage_VERSION_KEY],a[module$contents$omid$common$InternalMessage_ARGS_KEY]);};module$exports$omid$common$InternalMessage.prototype.serialize=function(){var a={};a=(a[module$contents$omid$common$InternalMessage_GUID_KEY]=this.guid,a[module$contents$omid$common$InternalMessage_METHOD_KEY]=this.method,a[module$contents$omid$common$InternalMessage_VERSION_KEY]=this.version,a);void 0!==this.args&&(a[module$contents$omid$common$InternalMessage_ARGS_KEY]=this.args);return a;};var module$exports$omid$common$Communication=function(a){this.to=a;this.communicationType_=module$exports$omid$common$constants.CommunicationType.NONE;};module$exports$omid$common$Communication.prototype.sendMessage=function(a,b){};module$exports$omid$common$Communication.prototype.handleMessage=function(a,b){if(this.onMessage){this.onMessage(a,b);}};module$exports$omid$common$Communication.prototype.serialize=function(a){return JSON.stringify(a);};module$exports$omid$common$Communication.prototype.deserialize=function(a){return JSON.parse(a);};module$exports$omid$common$Communication.prototype.isDirectCommunication=function(){return this.communicationType_===module$exports$omid$common$constants.CommunicationType.DIRECT;};module$exports$omid$common$Communication.prototype.isCrossOrigin=function(){};var module$exports$omid$common$DetectOmid={OMID_PRESENT_FRAME_NAME:"omid_v1_present",isOmidPresent:function(a){try{return a.frames?!!a.frames[module$exports$omid$common$DetectOmid.OMID_PRESENT_FRAME_NAME]:!1;}catch(b){return!1;}},declareOmidPresence:function(a){a.frames&&a.document&&(module$exports$omid$common$DetectOmid.OMID_PRESENT_FRAME_NAME in a.frames||(null==a.document.body&&module$exports$omid$common$DetectOmid.isMutationObserverAvailable_(a)?module$exports$omid$common$DetectOmid.registerMutationObserver_(a):a.document.body?module$exports$omid$common$DetectOmid.appendPresenceIframe_(a):a.document.write('<iframe style="display:none" id="'+(module$exports$omid$common$DetectOmid.OMID_PRESENT_FRAME_NAME+'" name="')+(module$exports$omid$common$DetectOmid.OMID_PRESENT_FRAME_NAME+'"></iframe>'))));},appendPresenceIframe_:function(a){var b=a.document.createElement("iframe");b.id=module$exports$omid$common$DetectOmid.OMID_PRESENT_FRAME_NAME;b.name=module$exports$omid$common$DetectOmid.OMID_PRESENT_FRAME_NAME;b.style.display="none";a.document.body.appendChild(b);},isMutationObserverAvailable_:function(a){return"MutationObserver"in a;},registerMutationObserver_:function(a){var b=new MutationObserver(function(c){c.forEach(function(c){"BODY"===c.addedNodes[0].nodeName&&(module$exports$omid$common$DetectOmid.appendPresenceIframe_(a),b.disconnect());});});b.observe(a.document.documentElement,{childList:!0});}};var module$exports$omid$common$DirectCommunication=function(a){module$exports$omid$common$Communication.call(this,a);this.communicationType_=module$exports$omid$common$constants.CommunicationType.DIRECT;this.handleExportedMessage=module$exports$omid$common$DirectCommunication.prototype.handleExportedMessage.bind(this);};$jscomp.inherits(module$exports$omid$common$DirectCommunication,module$exports$omid$common$Communication);module$exports$omid$common$DirectCommunication.prototype.sendMessage=function(a,b){b=void 0===b?this.to:b;if(!b){throw Error("Message destination must be defined at construction time or when sending the message.");}
b.handleExportedMessage(a.serialize(),this);};module$exports$omid$common$DirectCommunication.prototype.handleExportedMessage=function(a,b){module$exports$omid$common$InternalMessage.isValidSerializedMessage(a)&&this.handleMessage(module$exports$omid$common$InternalMessage.deserialize(a),b);};module$exports$omid$common$DirectCommunication.prototype.isCrossOrigin=function(){return!1;};var module$exports$omid$common$eventTypedefs={};var module$exports$omid$common$exporter={};function module$contents$omid$common$exporter_getOmidExports(){return"undefined"===typeof omidExports?null:omidExports;}
function module$contents$omid$common$exporter_getOrCreateName(a,b){return a&&(a[b]||(a[b]={}));}
module$exports$omid$common$exporter.packageExport=function(a,b,c){if(c=void 0===c?module$contents$omid$common$exporter_getOmidExports():c){a=a.split("."),a.slice(0,a.length-1).reduce(module$contents$omid$common$exporter_getOrCreateName,c)[a[a.length-1]]=b;}};var module$exports$omid$common$guid={generateGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;a="y"===a?(b&3|8).toString(16):b.toString(16);return a;});}};var module$exports$omid$common$logger={error:function(a){for(var b=[],c=0;c<arguments.length;++c){b[c-0]=arguments[c];}
module$contents$omid$common$logger_executeLog(function(){throw new(Function.prototype.bind.apply(Error,[null,"Could not complete the test successfully - "].concat($jscomp.arrayFromIterable(b))));},function(){return console.error.apply(console,$jscomp.arrayFromIterable(b));});},debug:function(a){for(var b=[],c=0;c<arguments.length;++c){b[c-0]=arguments[c];}
module$contents$omid$common$logger_executeLog(function(){},function(){return console.error.apply(console,$jscomp.arrayFromIterable(b));});}};function module$contents$omid$common$logger_executeLog(a,b){"undefined"!==typeof jasmine&&jasmine?a():"undefined"!==typeof console&&console&&console.error&&b();};var module$exports$omid$common$OmidGlobalProvider={},module$contents$omid$common$OmidGlobalProvider_globalThis=eval("this");function module$contents$omid$common$OmidGlobalProvider_getOmidGlobal(){if("undefined"!==typeof omidGlobal&&omidGlobal){return omidGlobal;}
if("undefined"!==typeof global&&global){return global;}
if("undefined"!==typeof window&&window){return window;}
if("undefined"!==typeof module$contents$omid$common$OmidGlobalProvider_globalThis&&module$contents$omid$common$OmidGlobalProvider_globalThis){return module$contents$omid$common$OmidGlobalProvider_globalThis;}
throw Error("Could not determine global object context.");}
module$exports$omid$common$OmidGlobalProvider.omidGlobal=module$contents$omid$common$OmidGlobalProvider_getOmidGlobal();var module$exports$omid$common$windowUtils={};function module$contents$omid$common$windowUtils_isValidWindow(a){return null!=a&&"undefined"!==typeof a.top&&null!=a.top;}
module$exports$omid$common$windowUtils.isCrossOrigin=function(a){if(a===module$exports$omid$common$OmidGlobalProvider.omidGlobal){return!1;}
try{if("undefined"===typeof a.location.hostname){return!0;}
module$contents$omid$common$windowUtils_isSameOriginForIE(a);}catch(b){return!0;}
return!1;};function module$contents$omid$common$windowUtils_isSameOriginForIE(a){return""===a.x||""!==a.x;}
module$exports$omid$common$windowUtils.resolveGlobalContext=function(a){"undefined"===typeof a&&"undefined"!==typeof window&&window&&(a=window);return module$contents$omid$common$windowUtils_isValidWindow(a)?a:module$exports$omid$common$OmidGlobalProvider.omidGlobal;};module$exports$omid$common$windowUtils.resolveTopWindowContext=function(a){return module$contents$omid$common$windowUtils_isValidWindow(a)?a.top:module$exports$omid$common$OmidGlobalProvider.omidGlobal;};module$exports$omid$common$windowUtils.evaluatePageUrl=function(a){if(!module$contents$omid$common$windowUtils_isValidWindow(a)){return null;}
try{var b=a.top;return(0,module$exports$omid$common$windowUtils.isCrossOrigin)(b)?null:b.location.href;}catch(c){return null;}};var module$exports$omid$common$PostMessageCommunication=function(a,b){b=void 0===b?module$exports$omid$common$OmidGlobalProvider.omidGlobal:b;module$exports$omid$common$Communication.call(this,b);var c=this;this.communicationType_=module$exports$omid$common$constants.CommunicationType.POST_MESSAGE;a.addEventListener("message",function(a){if("object"===typeof a.data){var b=a.data;module$exports$omid$common$InternalMessage.isValidSerializedMessage(b)&&(b=module$exports$omid$common$InternalMessage.deserialize(b),a.source&&c.handleMessage(b,a.source));}});};$jscomp.inherits(module$exports$omid$common$PostMessageCommunication,module$exports$omid$common$Communication);module$exports$omid$common$PostMessageCommunication.isCompatibleContext=function(a){return!!(a&&a.addEventListener&&a.postMessage);};module$exports$omid$common$PostMessageCommunication.prototype.sendMessage=function(a,b){b=void 0===b?this.to:b;if(!b){throw Error("Message destination must be defined at construction time or when sending the message.");}
b.postMessage(a.serialize(),"*");};module$exports$omid$common$PostMessageCommunication.prototype.isCrossOrigin=function(){return this.to?(0,module$exports$omid$common$windowUtils.isCrossOrigin)(this.to):!0;};var module$exports$omid$common$Rectangle=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d;};var module$exports$omid$common$serviceCommunication={},module$contents$omid$common$serviceCommunication_EXPORTED_SESSION_COMMUNICATION_NAME=["omid","v1_SessionServiceCommunication"],module$contents$omid$common$serviceCommunication_EXPORTED_VERIFICATION_COMMUNICATION_NAME=["omid","v1_VerificationServiceCommunication"],module$contents$omid$common$serviceCommunication_EXPORTED_SERVICE_WINDOW_NAME=["omidVerificationProperties","serviceWindow"];function module$contents$omid$common$serviceCommunication_getValueForKeypath(a,b){return b.reduce(function(a,b){return a&&a[b];},a);}
function module$contents$omid$common$serviceCommunication_startServiceCommunication(a,b,c,d){if(!(0,module$exports$omid$common$windowUtils.isCrossOrigin)(b)){try{var e=module$contents$omid$common$serviceCommunication_getValueForKeypath(b,c);if(e){return new module$exports$omid$common$DirectCommunication(e);}}catch(f){}}
return d(b)?new module$exports$omid$common$PostMessageCommunication(a,b):null;}
function module$contents$omid$common$serviceCommunication_startServiceCommunicationFromCandidates(a,b,c,d){b=$jscomp.makeIterator(b);for(var e=b.next();!e.done;e=b.next()){if(e=module$contents$omid$common$serviceCommunication_startServiceCommunication(a,e.value,c,d)){return e;}}
return null;}
module$exports$omid$common$serviceCommunication.startSessionServiceCommunication=function(a,b,c){c=void 0===c?module$exports$omid$common$DetectOmid.isOmidPresent:c;var d=[a,(0,module$exports$omid$common$windowUtils.resolveTopWindowContext)(a)];b&&d.unshift(b);return module$contents$omid$common$serviceCommunication_startServiceCommunicationFromCandidates(a,d,module$contents$omid$common$serviceCommunication_EXPORTED_SESSION_COMMUNICATION_NAME,c);};module$exports$omid$common$serviceCommunication.startVerificationServiceCommunication=function(a,b){b=void 0===b?module$exports$omid$common$DetectOmid.isOmidPresent:b;var c=[],d=module$contents$omid$common$serviceCommunication_getValueForKeypath(a,module$contents$omid$common$serviceCommunication_EXPORTED_SERVICE_WINDOW_NAME);d&&c.push(d);c.push((0,module$exports$omid$common$windowUtils.resolveTopWindowContext)(a));return module$contents$omid$common$serviceCommunication_startServiceCommunicationFromCandidates(a,c,module$contents$omid$common$serviceCommunication_EXPORTED_VERIFICATION_COMMUNICATION_NAME,b);};var module$exports$omid$common$VastProperties=function(a,b,c,d){this.isSkippable=a;this.skipOffset=b;this.isAutoPlay=c;this.position=d;};module$exports$omid$common$VastProperties.prototype.toJSON=function(){return{isSkippable:this.isSkippable,skipOffset:this.skipOffset,isAutoPlay:this.isAutoPlay,position:this.position};};var module$exports$omid$common$version={ApiVersion:"1.0",Version:"1.3.8-dev"};var module$contents$omid$verificationClient$VerificationClient_VERIFICATION_CLIENT_VERSION=module$exports$omid$common$version.Version,module$contents$omid$verificationClient$VerificationClient_EventCallback;function module$contents$omid$verificationClient$VerificationClient_getThirdPartyOmid(){var a=module$exports$omid$common$OmidGlobalProvider.omidGlobal.omid3p;return a&&"function"===typeof a.registerSessionObserver&&"function"===typeof a.addEventListener?a:null;}
var module$exports$omid$verificationClient$VerificationClient=function(a){if(this.communication=a||(0,module$exports$omid$common$serviceCommunication.startVerificationServiceCommunication)((0,module$exports$omid$common$windowUtils.resolveGlobalContext)())){this.communication.onMessage=this.handleMessage_.bind(this);}else{if(a=module$contents$omid$verificationClient$VerificationClient_getThirdPartyOmid()){this.omid3p=a;}}
this.remoteIntervals_=this.remoteTimeouts_=0;this.callbackMap_={};this.imgCache_=[];this.injectionId_=(a=module$exports$omid$common$OmidGlobalProvider.omidGlobal.omidVerificationProperties)?a.injectionId:void 0;};module$exports$omid$verificationClient$VerificationClient.prototype.isSupported=function(){return!(!this.communication&&!this.omid3p);};module$exports$omid$verificationClient$VerificationClient.prototype.registerSessionObserver=function(a,b){(0,module$exports$omid$common$argsChecker.assertFunction)("functionToExecute",a);this.omid3p?this.omid3p.registerSessionObserver(a,b,this.injectionId_):this.sendMessage_("addSessionListener",a,b,this.injectionId_);};module$exports$omid$verificationClient$VerificationClient.prototype.addEventListener=function(a,b){(0,module$exports$omid$common$argsChecker.assertTruthyString)("eventType",a);(0,module$exports$omid$common$argsChecker.assertFunction)("functionToExecute",b);this.omid3p?this.omid3p.addEventListener(a,b):this.sendMessage_("addEventListener",b,a);};module$exports$omid$verificationClient$VerificationClient.prototype.sendUrl=function(a,b,c){(0,module$exports$omid$common$argsChecker.assertTruthyString)("url",a);module$exports$omid$common$OmidGlobalProvider.omidGlobal.document&&module$exports$omid$common$OmidGlobalProvider.omidGlobal.document.createElement?this.sendUrlWithImg_(a,b,c):this.sendMessage_("sendUrl",function(a){a&&b?b():!a&&c&&c();},a);};module$exports$omid$verificationClient$VerificationClient.prototype.sendUrlWithImg_=function(a,b,c){var d=this,e=module$exports$omid$common$OmidGlobalProvider.omidGlobal.document.createElement("img");this.imgCache_.push(e);var f=function(a){var b=d.imgCache_.indexOf(e);0<=b&&d.imgCache_.splice(b,1);a&&a();};e.addEventListener("load",f.bind(this,b));e.addEventListener("error",f.bind(this,c));e.src=a;};module$exports$omid$verificationClient$VerificationClient.prototype.injectJavaScriptResource=function(a,b,c){var d=this;(0,module$exports$omid$common$argsChecker.assertTruthyString)("url",a);module$exports$omid$common$OmidGlobalProvider.omidGlobal.document?this.injectJavascriptResourceUrlInDom_(a,b,c):this.sendMessage_("injectJavaScriptResource",function(e,f){e?(d.evaluateJavaScript_(f,a),b()):(module$exports$omid$common$logger.error("Service failed to load JavaScript resource."),c());},a);};module$exports$omid$verificationClient$VerificationClient.prototype.injectJavascriptResourceUrlInDom_=function(a,b,c){var d=module$exports$omid$common$OmidGlobalProvider.omidGlobal.document,e=d.body;d=d.createElement("script");d.onload=b;d.onerror=c;d.src=a;d.type="application/javascript";e.appendChild(d);};module$exports$omid$verificationClient$VerificationClient.prototype.evaluateJavaScript_=function(a,b){try{eval(a);}catch(c){module$exports$omid$common$logger.error('Error evaluating the JavaScript resource from "'+b+'".');}};module$exports$omid$verificationClient$VerificationClient.prototype.setTimeout=function(a,b){(0,module$exports$omid$common$argsChecker.assertFunction)("functionToExecute",a);(0,module$exports$omid$common$argsChecker.assertPositiveNumber)("timeInMillis",b);if(this.hasTimeoutMethods_()){return module$exports$omid$common$OmidGlobalProvider.omidGlobal.setTimeout(a,b);}
var c=this.remoteTimeouts_++;this.sendMessage_("setTimeout",a,c,b);return c;};module$exports$omid$verificationClient$VerificationClient.prototype.clearTimeout=function(a){(0,module$exports$omid$common$argsChecker.assertPositiveNumber)("timeoutId",a);this.hasTimeoutMethods_()?module$exports$omid$common$OmidGlobalProvider.omidGlobal.clearTimeout(a):this.sendOneWayMessage_("clearTimeout",a);};module$exports$omid$verificationClient$VerificationClient.prototype.setInterval=function(a,b){(0,module$exports$omid$common$argsChecker.assertFunction)("functionToExecute",a);(0,module$exports$omid$common$argsChecker.assertPositiveNumber)("timeInMillis",b);if(this.hasIntervalMethods_()){return module$exports$omid$common$OmidGlobalProvider.omidGlobal.setInterval(a,b);}
var c=this.remoteIntervals_++;this.sendMessage_("setInterval",a,c,b);return c;};module$exports$omid$verificationClient$VerificationClient.prototype.clearInterval=function(a){(0,module$exports$omid$common$argsChecker.assertPositiveNumber)("intervalId",a);this.hasIntervalMethods_()?module$exports$omid$common$OmidGlobalProvider.omidGlobal.clearInterval(a):this.sendOneWayMessage_("clearInterval",a);};module$exports$omid$verificationClient$VerificationClient.prototype.hasTimeoutMethods_=function(){return"function"===typeof module$exports$omid$common$OmidGlobalProvider.omidGlobal.setTimeout&&"function"===typeof module$exports$omid$common$OmidGlobalProvider.omidGlobal.clearTimeout;};module$exports$omid$verificationClient$VerificationClient.prototype.hasIntervalMethods_=function(){return"function"===typeof module$exports$omid$common$OmidGlobalProvider.omidGlobal.setInterval&&"function"===typeof module$exports$omid$common$OmidGlobalProvider.omidGlobal.clearInterval;};module$exports$omid$verificationClient$VerificationClient.prototype.handleMessage_=function(a,b){b=a.method;var c=a.guid;a=a.args;if("response"===b&&this.callbackMap_[c]){var d=(0,module$exports$omid$common$ArgsSerDe.deserializeMessageArgs)(module$contents$omid$verificationClient$VerificationClient_VERIFICATION_CLIENT_VERSION,a);this.callbackMap_[c].apply(this,d);}"error"===b&&window.console&&module$exports$omid$common$logger.error(a);};module$exports$omid$verificationClient$VerificationClient.prototype.sendOneWayMessage_=function(a,b){for(var c=[],d=1;d<arguments.length;++d){c[d-1]=arguments[d];}
this.sendMessage_.apply(this,[a,null].concat($jscomp.arrayFromIterable(c)));};module$exports$omid$verificationClient$VerificationClient.prototype.sendMessage_=function(a,b,c){for(var d=[],e=2;e<arguments.length;++e){d[e-2]=arguments[e];}
this.communication&&(e=(0,module$exports$omid$common$guid.generateGuid)(),b&&(this.callbackMap_[e]=b),d=new module$exports$omid$common$InternalMessage(e,"VerificationService."+a,module$contents$omid$verificationClient$VerificationClient_VERIFICATION_CLIENT_VERSION,(0,module$exports$omid$common$ArgsSerDe.serializeMessageArgs)(module$contents$omid$verificationClient$VerificationClient_VERIFICATION_CLIENT_VERSION,d)),this.communication.sendMessage(d));};(0,module$exports$omid$common$exporter.packageExport)("OmidVerificationClient",module$exports$omid$verificationClient$VerificationClient);},typeof exports==='undefined'?undefined:exports));
var IV;(function(IV){var OmidConstants=(function(){function OmidConstants(){}
OmidConstants.GEOMETRY_CHANGE_EVENT="geometryChange";OmidConstants.IMPRESSION_EVENT="impression";OmidConstants.SUPPORTED_FEATURES={CONTAINER:"clid",VIDEO:"vlid"};OmidConstants.SESSION_EVENT_TYPES={SESSION_START:"sessionStart",SESSION_ERROR:"sessionError",SESSION_FINISH:"sessionFinish"};OmidConstants.ACCESS_MODE={FULL:"full",LIMITED:"limited"};OmidConstants.VENDOR_KEY="innovid.com-omid";OmidConstants.SUPPORTED_STATE={SUPPORTED:"supported",NOT_SUPPORTED:"not-supported"};return OmidConstants;})();IV.OmidConstants=OmidConstants;})(IV||(IV={}));
var IV;(function(IV){var OmidClientCommunicator=(function(){function OmidClientCommunicator(omidClient,omidReporter){this.omidClient=omidClient;this.omidReporter=omidReporter;}
return OmidClientCommunicator;})();IV.OmidClientCommunicator=OmidClientCommunicator;})(IV||(IV={}));
var IV;(function(IV){var OmidErrors=(function(){function OmidErrors(){}
OmidErrors.createErrorMessage=function(errPrefix,omidError){var omidErrorMessage=omidError.message?omidError.message:omidError.toString();var errorMessage=errPrefix+omidErrorMessage;return errorMessage.substring(0,this.errorLengthLimit);};OmidErrors.createSessionErrorMessage=function(errPrefix,sessionErrorObj){var errorMessage=errPrefix+(sessionErrorObj?""+JSON.stringify(sessionErrorObj):"");return errorMessage.substring(0,this.errorLengthLimit);};OmidErrors.errorLengthLimit=180;return OmidErrors;})();IV.OmidErrors=OmidErrors;})(IV||(IV={}));
var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var IV;(function(IV){var OmidClientDetector=(function(_super){__extends(OmidClientDetector,_super);function OmidClientDetector(omidClient,omidReporter){_super.call(this,omidClient,omidReporter);}
OmidClientDetector.prototype.detectOmid=function(){try{var isOmidSupported=this.omidClient.isSupported();this.omidReporter.reportOmidSupported(isOmidSupported?IV.OmidConstants.SUPPORTED_STATE.SUPPORTED:IV.OmidConstants.SUPPORTED_STATE.NOT_SUPPORTED);if(isOmidSupported){IV.Events.trigger("omid_supported",this.omidClient,this.omidReporter);}}
catch(err){this.omidReporter.reportOmidError(IV.OmidErrors.createErrorMessage("detect omid failed: ",err));}};return OmidClientDetector;})(IV.OmidClientCommunicator);IV.OmidClientDetector=OmidClientDetector;})(IV||(IV={}));
var IV;(function(IV){var OmidReporter=(function(){function OmidReporter(reporter){this.reporter=reporter;}
OmidReporter.prototype.reportOmidSupported=function(omidSupportState){this.reporter.submit({action:"viewomid",event_id:omidSupportState});};OmidReporter.prototype.reportOmidImpression=function(data){this.reporter.submit({action:"viewomid",event_id:"impression",event_value:this.toGeoEventValue(data)});};OmidReporter.prototype.reportOmidVisible=function(data){this.reporter.submit({action:"viewomid",event_id:"visible",event_value:this.toGeoEventValue(data)});};OmidReporter.prototype.reportOmidValidSize=function(data){this.reporter.submit({action:"viewomid",event_id:"validsize",event_value:this.toGeoEventValue(data)});};OmidReporter.prototype.reportOmidError=function(errorMsg){this.reporter.submit({action:"viewomid",event_id:"error",event_value:errorMsg});};OmidReporter.prototype.reportOmidGeometrySupported=function(geometrySupportState){this.reporter.submit({action:"viewomid",event_id:"geosupported",event_value:geometrySupportState});};OmidReporter.prototype.toGeoEventValue=function(data){return data.percentageInView+";"+this.toGeoValue(data.geometry)+";"+this.toGeoValue(data.onScreenGeometry);};OmidReporter.prototype.toGeoValue=function(geo){return geo.x+","+geo.y+","+geo.width+","+geo.height;};return OmidReporter;})();IV.OmidReporter=OmidReporter;})(IV||(IV={}));
(function(SCOPE){SCOPE.Events.on("IRollInit",function(core){var omidReporter=new SCOPE.OmidReporter(core.report);try{if(window.OmidVerificationClient&&window.OmidVerificationClient["1.3.8-dev"]){var OmidVerificationClient=window.OmidVerificationClient["1.3.8-dev"];var omidClient=new OmidVerificationClient();var omidClientDetector=new SCOPE.OmidClientDetector(omidClient,omidReporter);omidClientDetector.detectOmid();}else{omidReporter.reportOmidSupported(SCOPE.OmidConstants.SUPPORTED_STATE.NOT_SUPPORTED);}}catch(err){omidReporter.reportOmidError(SCOPE.OmidErrors.createErrorMessage("init omid detection failed: ",err));}});}(IV));
var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var IV;(function(IV){var OmidSessionObserver=(function(_super){__extends(OmidSessionObserver,_super);function OmidSessionObserver(omidClient,omidReporter){var _this=this;_super.call(this,omidClient,omidReporter);this.sessionObserverCb=function(event){try{switch(event.type){case IV.OmidConstants.SESSION_EVENT_TYPES.SESSION_START:var sessionStartData=event.data;_this.handleSessionStart(sessionStartData.context);break;case IV.OmidConstants.SESSION_EVENT_TYPES.SESSION_ERROR:var errorData=event.data;_this.omidReporter.reportOmidError(IV.OmidErrors.createSessionErrorMessage("sessionError event was fired: ",errorData));break;}}
catch(err){_this.omidReporter.reportOmidError(IV.OmidErrors.createErrorMessage("error in sessionObserverCb: ",err));}};this.handleSessionStart=function(context){var geometrySupportValue;switch(context.accessMode){case IV.OmidConstants.ACCESS_MODE.LIMITED:geometrySupportValue=IV.OmidConstants.SUPPORTED_STATE.SUPPORTED;break;case IV.OmidConstants.ACCESS_MODE.FULL:geometrySupportValue=Array.isArray(context.supports)&&context.supports.indexOf(IV.OmidConstants.SUPPORTED_FEATURES.CONTAINER)>-1?IV.OmidConstants.SUPPORTED_STATE.SUPPORTED:IV.OmidConstants.SUPPORTED_STATE.NOT_SUPPORTED;break;default:geometrySupportValue=IV.OmidConstants.SUPPORTED_STATE.NOT_SUPPORTED;}
_this.omidReporter.reportOmidGeometrySupported(geometrySupportValue);};}
OmidSessionObserver.prototype.registerSessionObserver=function(){this.omidClient.registerSessionObserver(this.sessionObserverCb,IV.OmidConstants.VENDOR_KEY);};return OmidSessionObserver;})(IV.OmidClientCommunicator);IV.OmidSessionObserver=OmidSessionObserver;})(IV||(IV={}));
var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var IV;(function(IV){var OmidEventsListener=(function(_super){__extends(OmidEventsListener,_super);function OmidEventsListener(omidClient,omidReporter){var _this=this;_super.call(this,omidClient,omidReporter);this.onGeometryChangeEvent=function(event){if(_this.isVisible(event.data)){_this.reportOmidVisibleOnce(event.data.adView);}
if(_this.isValidSize(event.data)){_this.reportOmidValidSizeOnce(event.data.adView);}};this.onImpressionEvent=function(event){if(event&&event.data&&event.data.adView){_this.reportOmidImpressionOnce(event.data.adView);}};this.reportOmidImpressionOnce=_.once(function(data){return _this.omidReporter.reportOmidImpression(data);});this.reportOmidValidSizeOnce=_.once(function(data){return _this.omidReporter.reportOmidValidSize(data);});this.reportOmidVisibleOnce=_.once(function(data){return _this.omidReporter.reportOmidVisible(data);});}
OmidEventsListener.prototype.startListening=function(){this.omidClient.addEventListener(IV.OmidConstants.GEOMETRY_CHANGE_EVENT,this.onGeometryChangeEvent);this.omidClient.addEventListener(IV.OmidConstants.IMPRESSION_EVENT,this.onImpressionEvent);};OmidEventsListener.prototype.isVisible=function(data){return data.adView.percentageInView>0&&data.adView.onScreenGeometry.height>=1&&data.adView.onScreenGeometry.width>=1;};OmidEventsListener.prototype.isValidSize=function(data){return data.adView.geometry.height>1&&data.adView.geometry.width>1;};return OmidEventsListener;})(IV.OmidClientCommunicator);IV.OmidEventsListener=OmidEventsListener;})(IV||(IV={}));
(function(SCOPE){SCOPE.Events.on("omid_supported",function(omidClient,omidReporter){try{var sessionObserver=new SCOPE.OmidSessionObserver(omidClient,omidReporter);sessionObserver.registerSessionObserver();var listener=new SCOPE.OmidEventsListener(omidClient,omidReporter);listener.startListening();}catch(err){omidReporter.reportOmidError(SCOPE.OmidErrors.createErrorMessage("init omid visibility failed: ",err));}});}(IV));
var IVA;(function(SCOPE){SCOPE.registerCreative=function(onReadyCallback){if(typeof IV==="undefined"){throw new Error("IV is undefined. Did you include the core library in your project?");}
IV.Events.on('CustomFormatReady',function(contextImpl){if(!contextImpl.shouldWrapCreativeWithIframe()){SCOPE.Events.trigger("StartCreative",contextImpl);}});SCOPE.Events.on("StartCreative",_.once(function(contextImpl){IVA.creativeContext=new SCOPE.Context(contextImpl);onReadyCallback.call(this,IVA.creativeContext);contextImpl.preparePlay();}));};SCOPE.Events=function(){};_.extend(SCOPE.Events,Backbone.Events);})(IVA||(IVA={}));
(function(SCOPE){SCOPE.IRoll=function(contextImpl){var iroll=contextImpl.iroll,program=new SCOPE.Program(contextImpl),preloadCache={},_volume=1;this.start=function(){var preSurvey=program.preContentSurvey();var beforeNode=program.beforeVideo();var afterNode=program.afterVideo();var postSurvey=program.postContentSurvey();preSurvey.execute(function(){beforeNode.execute(function(){contextImpl.play();});contextImpl.Events.on('video_ended',function(){afterNode.execute(function(){postSurvey.execute(function(){contextImpl.Events.trigger("ad_ended");});});});var forceImpression=beforeNode.willOpen()?true:false;contextImpl.Events.trigger("ad_play",forceImpression);});};this.openURL=function(label,customURL){if(!_.isString(label)||_.isEmpty(label)){throw new TypeError("label must be a non empty string");}
var url=customURL||getUrl(label);if(!_.isUndefined(iroll.videoClickHandler)){url=iroll.videoClickHandler.replaceMacrosInClickThruUrl(url);}
var isPreviewMode=contextImpl.isPreviewMode();handleClickthrough(isPreviewMode,label,url);if(iroll.get('playStartTime')){contextImpl.openUrl(label);openIrollWindow(isPreviewMode,label,url);SCOPE.Events.trigger("openURL",label);}};this.skip=function(){program.finish(function(){contextImpl.skip();});};this.reportEvent=function(label,value){triggerReportEvent("reportEvent",label,value);};this.reportCreativeDebugEvent=function(label,value){triggerReportEvent("reportCreativeDebugEvent",label,value);};this.reportEventWithoutEngagement=function(label,value){triggerReportEvent("reportEventWithoutEngagement",label,value);};this.setAndReportVersionIdOnce=_.once(function(versionId,versionString){iroll.set('version_id',versionId);triggerReportEvent("setAndReportVersionId","versionTrack",versionString+"_"+versionId);});this.getVolume=function(){var vol=iroll.get('videoPlayer').getVolume();if(typeof vol==='undefined'){vol=null;}else if(typeof vol!=='number'){vol=parseFloat(vol);}
return vol===null||vol===-1?_volume:vol;};this.onVolumeChange=function(handlerFn){if(typeof handlerFn!=='function')return;contextImpl.Events.on("volumechange",function(vol){_volume=vol;handlerFn(vol);},this);};this.getProgram=function(){return program;};this.injectCSS=function(assetName){var cssSuffix=".css";if(typeof assetName==="string"&&assetName.indexOf(cssSuffix,assetName.length-cssSuffix.length)!==-1){var path=SCOPE.Utils.getAssetPathWithCB(assetName);iroll.canvas.injectCss(path);}
else{throw"assetName is not a valid asset name";}};this.preloadAssets=function(assets,callback){var failedAssets=[],loadedAssetsCount=0,assetArr;function toArray(value){return _.isArray(value)?value:[value];}
assetArr=toArray(assets).filter(function(asset){return _.isString(asset)&&asset.length>0;}).filter(function(asset){return!preloadCache.hasOwnProperty(asset);});var preloader=new SCOPE.Preloader({onSuccess:function(){loadedAssetsCount++;},onError:function(asset){loadedAssetsCount++;failedAssets.push(asset);},onDone:function(){if(loadedAssetsCount===assetArr.length){callback(failedAssets);}}});assetArr.forEach(function(asset){preloader.preloadAsset(asset,SCOPE.Utils.getAssetPath(asset));preloadCache[asset]=true;});};this.isResponsive=function(){return iroll.isResponsive();};var getUrl=function(label){var url;if(_.isObject(iroll.get('data')['placement-config'])){url=getHotspotUrl(label);}
else if(_.isObject(iroll.get('data')['html-click-thrus'])){url=iroll.get('data')['html-click-thrus'][label];}
return url;};var getHotspotUrl=function(label){var hotspotUrl;var hotSpotClicks=iroll.get('data')['placement-config']['hotspot-clicks'];if(hotSpotClicks){_.every(hotSpotClicks,function(hotspot){if(hotspot.id===label){hotspotUrl=hotspot.main;return false;}
else{return true;}});}
return hotspotUrl;};var triggerReportEvent=function(type,label,value){if(typeof type!=="string"||type.length===0){throw new TypeError("type must be a non empty string");}
if(typeof label!=="string"||label.length===0){throw new TypeError("label must be a non empty string");}
contextImpl.Events.trigger(type,label,value);SCOPE.Events.trigger(type,label,value);};function handleClickthrough(isPreviewMode,label,url){if(isPreviewMode){contextImpl.redirectClickthroughPage(label,url);}else{throwOnUndefinedUrl(label,url);throwOnInvalidUrl(url);}}
function throwOnUndefinedUrl(label,url){if(_.isUndefined(url)){throw new TypeError("there is no url defined for the given label: "+label);}}
function throwOnInvalidUrl(url){if(!SCOPE.Utils.isValidUrl(url)){throw new TypeError("url must be a valid url");}}
function openIrollWindow(isPreviewMode,label,url){if(!isPreviewMode){iroll.windowOpen(url,label);}}};})(IVA||(IVA={}));
(function(SCOPE){var ProgramNodeBucket=function(){var nodesBucket=[];this.add=function(node,slate){var exists=_.find(nodesBucket,function(aNode){return aNode.node===node;});if(!exists){nodesBucket.push({node:node,slate:slate});}};this.clear=function(node){nodesBucket=_.filter(nodesBucket,function(aNode){return aNode.node!==node;});};this.getAll=function(){return nodesBucket;};};SCOPE.ProgramNode=function(contextImpl,bucket){var that=this,_willOpen=false;var action=function(callback){callback();};this.willOpen=function(){return _willOpen;};this.open=function(slate){_willOpen=true;action=function(callback){bucket.add(that,slate);slate._open(contextImpl);that.trigger("open");slate.on("close",_.once(function(){that.trigger("close");callback();}));};};this.close=function(slate){action=function(callback){bucket.clear(that);slate.close();callback();};};this.show=function(overlay){action=function(callback){overlay._show(contextImpl);callback();};};this.hide=function(overlay){action=function(callback){overlay.hide();callback();};};this.execute=function(callback){that.on("done",callback);action(function(){that.trigger("done");});};};_.extend(IVA.ProgramNode.prototype,Backbone.Events);SCOPE.ProgramNowNode=function(contextImpl,bucket){this.open=function(slate){var that=this;bucket.add(this,slate);slate.on("close",_.once(function(){that.trigger("close");}));slate._open(contextImpl);this.trigger("open");};this.close=function(slate){bucket.clear(this);slate.close();};this.show=function(overlay){overlay._show(contextImpl);};this.hide=function(overlay){overlay.hide();};};_.extend(SCOPE.ProgramNowNode.prototype,Backbone.Events);SCOPE.Program=function(contextImpl){var bucket=new ProgramNodeBucket(),finished=false;var beforeNode=new SCOPE.ProgramNode(contextImpl,bucket),afterNode=new SCOPE.ProgramNode(contextImpl,bucket);var beforeContentNode=new SCOPE.ProgramNode(contextImpl,bucket),afterContentNode=new SCOPE.ProgramNode(contextImpl,bucket);beforeContentNode.on('open',_.once(function(){contextImpl.Events.trigger('surveyOpened');}));beforeContentNode.on('close',_.once(function(){contextImpl.Events.trigger('surveyClosed');}));beforeNode.on('open',_.once(function(){contextImpl.Events.trigger('slateOpened');}));beforeNode.on('close',_.once(function(){contextImpl.Events.trigger('slateClosed');}));afterNode.on('open',_.once(function(){contextImpl.Events.trigger('slateOpened');contextImpl.Events.trigger('timeEarnedStart');}));afterNode.on('close',_.once(function(){contextImpl.Events.trigger('slateClosed');contextImpl.Events.trigger('timeEarnedStop',false);}));afterContentNode.on('open',_.once(function(){contextImpl.Events.trigger('surveyOpened');}));afterContentNode.on('close',_.once(function(){contextImpl.Events.trigger('surveyClosed');}));var intervalMs=50,timeline=new SCOPE.Timeline(contextImpl,intervalMs);this.beforeVideo=function(){return beforeNode;};this.afterVideo=function(){return afterNode;};this.preContentSurvey=function(){return beforeContentNode;};this.postContentSurvey=function(){return afterContentNode;};this.at=function(videoPos){if(typeof videoPos!=="number"){throw new Error("Cannot attach a program node: Video position is not a number");}
var node=new SCOPE.ProgramNode(contextImpl,bucket);node.on('open',function(){contextImpl.Events.trigger('slateOpened');contextImpl.Events.trigger('timeEarnedStart');});node.on('close',function(){contextImpl.Events.trigger('slateClosed');contextImpl.Events.trigger('timeEarnedStop',isFinished()?false:true);});timeline.at(videoPos,node.execute);return node;};this.after=function(videoPos){if(typeof videoPos!=="number"){throw new Error("Cannot attach a program node: Video position is not a number");}
var node=new SCOPE.ProgramNode(contextImpl,bucket);node.on('open',function(){contextImpl.Events.trigger('slateOpened');contextImpl.Events.trigger('timeEarnedStart');});node.on('close',function(){contextImpl.Events.trigger('slateClosed');contextImpl.Events.trigger('timeEarnedStop',isFinished()?false:true);});timeline.after(videoPos,node.execute);return node;};this.now=function(){var node=new SCOPE.ProgramNowNode(contextImpl,bucket);node.on('open',function(){contextImpl.Events.trigger('slateOpened');contextImpl.Events.trigger('timeEarnedStart');});node.on('close',function(){contextImpl.Events.trigger('slateClosed');contextImpl.Events.trigger('timeEarnedStop',isFinished()?false:true);});return node;};this.finish=function(callback){finished=true;timeline.stop();bucket.getAll().forEach(function(aNode){var node=aNode.node,slate=aNode.slate;node.close(slate);if(typeof node.execute==='function'){node.execute(_.noop);}});if(typeof callback==='function')callback();};function isFinished(){return finished;}};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.Timeline=function(contextImpl,intervalTimeMs){var that=this;var video=new SCOPE.Video(contextImpl);var events=[];var interval;var isIntervalSet=false;contextImpl.Events.on('video_play',function(){if(!isIntervalSet){events=_.map(events,normalizeTime);events=_.sortBy(events,'time');checkEventsTime();interval=setInterval(checkEventsTime,intervalTimeMs);isIntervalSet=true;}});['video_pause','video_ended'].forEach(function(evtName){contextImpl.Events.on(evtName,function(){that.stop();});});var checkEventsTime=function(){_.every(events,function(event){var timeDiff=(event.time-video.getCurrentTime())*1000;if(event.isTimeToPlay(timeDiff)){events=_.without(events,event);event.callback();return true;}else if(timeDiff>=0&&timeDiff<intervalTimeMs){setTimeout(function(){events=_.without(events,event);event.callback();},timeDiff);return true;}else{return false;}});};var normalizeTime=function(event){if(event.time<0)
{event.time=video.getDuration()+event.time;}
return event;};var addEventToQueue=function(event){if(typeof video.getDuration()!=='undefined'){event=normalizeTime(event);}
events.push(event);events=_.sortBy(events,'time');};this.at=function(time,callback){var event={callback:callback,time:time,isTimeToPlay:function(timeDiff){return(timeDiff<0&&timeDiff>-intervalTimeMs);}};addEventToQueue(event);};this.after=function(time,callback){var event={callback:callback,time:time,isTimeToPlay:function(timeDiff){return(timeDiff<0);}};addEventToQueue(event);};this.getEvents=function(){return events;};this.isIntervalSet=function(){return isIntervalSet;};this.stop=function(){if(this.isIntervalSet()){clearInterval(interval);isIntervalSet=false;}};};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.ConfigSection=function(data){this.section=function(key){if(data.hasOwnProperty(key)&&typeof data[key]==="object"){return new SCOPE.ConfigSection(data[key]);}else{return new SCOPE.ConfigSection({});}};this.value=function(key,defVal){var val=defVal;if(data.hasOwnProperty(key)){if(typeof data[key]!=="object"){val=data[key];}}
return val;};this.object=function(key,defVal){var val=defVal;if(data.hasOwnProperty(key)){if(typeof data[key]==="object"){val=_.clone(data[key]);}}
return val;};this.array=function(key){if(_.isArray(data[key])){return data[key].slice(0);}else{return[];}};};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.PlayerPlayButtonState={PAUSED:1,PLAYED:2,UNKNOWN:3};SCOPE.Player=function(contextImpl){var iroll=contextImpl.iroll;var playerStates={paused:SCOPE.PlayerPlayButtonState.PAUSED,played:SCOPE.PlayerPlayButtonState.PLAYED};var playerState=SCOPE.PlayerPlayButtonState.UNKNOWN;this.getState=function(){return playerState;};iroll.on('playButtonStateChanged',function(state){if(state in playerStates){playerState=playerStates[state];contextImpl.Events.trigger('playButtonStateChanged');}});};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.Context=function(contextImpl){var filteredPlacementConfig={};if(contextImpl.data.hasOwnProperty("placement-config")){filteredPlacementConfig=JSON.parse(JSON.stringify(contextImpl.data["placement-config"]));}
if(filteredPlacementConfig.hasOwnProperty("tracking-events")){delete filteredPlacementConfig["tracking-events"];}
var iRoll=new SCOPE.IRoll(contextImpl),video=new SCOPE.Video(contextImpl),player=new SCOPE.Player(contextImpl),config=new SCOPE.ConfigSection(contextImpl.data["html-custom-data"]||{}),plcConf=new SCOPE.ConfigSection(filteredPlacementConfig),device=new SCOPE.Device(contextImpl);this.getIroll=function(){return iRoll;};this.getVideo=function(){return video;};this.getPlayer=function(){return player;};this.getConfig=function(){return config;};this.getPlacementConfig=function(){return plcConf;};this.getStudioPropertiesConfig=function(key){var studioPropConf=contextImpl.data["html-studio-properties"];return contextImpl.getStudioProperties(studioPropConf,key);};this.getDevice=function(){return device;};this.isSecured=function(){return location.protocol=="https:";};this.on=function(eventName,cb,context){contextImpl.Events.on(eventName,cb,context);};this.trigger=function(eventName){contextImpl.Events.trigger(eventName);};this.__contextImpl=contextImpl;};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.Device=function(contextImpl){var
that=this;this.getOrientation=function(){var aspectRatio=1.3;var adSize=contextImpl.iroll.canvas.getSize();return(adSize.height*aspectRatio>adSize.width)?SCOPE.Device.Orientation.PORTRAIT:SCOPE.Device.Orientation.LANDSCAPE;};this.getPlatformType=function(){var platformTypes={"mobile":SCOPE.Device.PlatformType.MOBILE,"tablet":SCOPE.Device.PlatformType.TABLET,"desktop":SCOPE.Device.PlatformType.DESKTOP,"tv":SCOPE.Device.PlatformType.TV};var type=contextImpl.getDevicePlatformType();return platformTypes[type];};this.getOSType=function(){var osTypes={"ios":SCOPE.Device.OSType.IOS,"android":SCOPE.Device.OSType.ANDROID,"other":SCOPE.Device.OSType.OTHER};var type=contextImpl.getDeviceOSType();return osTypes[type];};this.canPlayInline=function(){return contextImpl.canPlayInline()||contextImpl.iroll.get("inlinePlaybackForced");};this.onOrientationChange=function(handlerFn){contextImpl.Events.on('orientationChange',function(){handlerFn(that.getOrientation());});};};SCOPE.Device.Orientation={"LANDSCAPE":1,"PORTRAIT":2};SCOPE.Device.OSType={"IOS":1,"ANDROID":2,"OTHER":3};SCOPE.Device.PlatformType={"MOBILE":1,"TABLET":2,"DESKTOP":3,"TV":4};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.VideoState={PLAYING:1,PAUSED:2,ENDED:3,UNKNOWN:4};SCOPE.Video=function(contextImpl){var iroll=contextImpl.iroll;var videoStates={playing:SCOPE.VideoState.PLAYING,paused:SCOPE.VideoState.PAUSED,ended:SCOPE.VideoState.ENDED};this.getState=function(){var state=iroll.get("videoPlayer").getState();if(state in videoStates){return videoStates[state];}
return SCOPE.VideoState.UNKNOWN;};this.getDuration=function(){var duration=iroll.get("videoPlayer").getDuration();if(isNaN(duration)){duration=undefined;}
return duration;};this.getCurrentTime=function(){return iroll.get("videoPlayer").getCurrentTime();};this.disableDefaultClickThru=function(){iroll.get("videoPlayer").off("interact");};};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.CreativeComponent=function(){this._hooks=[];this._rendered=false;};SCOPE.CreativeComponent.prototype.getCSSClass=function(){return this._cssClass;};SCOPE.CreativeComponent.prototype._render=function(contextImpl){if(!this._rendered){var elem=this.render(),sizes;var shouldIgnoreElement=$(elem).attr('data-ignore')===true.toString();if(elem&&isHTMLElement(elem)&&!shouldIgnoreElement){var container=$("<div />");container.addClass(this.getCSSClass());if(this.hasOwnProperty("options")&&this.options.preserveSizes){sizes=this.options.preserveSizes;}
resizeComponent(contextImpl.iroll.canvas,container,sizes);contextImpl.Events.on('winResize',function(){resizeComponent(contextImpl.iroll.canvas,container,sizes);});container.append(elem);contextImpl.iroll.canvas.addElement(container);_.each(this._hooks,function(action){action(contextImpl);});this._rendered=true;}else if(!shouldIgnoreElement){throw new Error("render did not return an HTMLElement or Zepto element");}}};SCOPE.CreativeComponent.prototype.addHook=function(action){this._hooks.push(action);};var resizeComponent=function(canvas,elem,origSizes){var adSize=canvas.getSize(),width=adSize.width,height=adSize.height;if(origSizes){var backgroundRatio=origSizes.width/origSizes.height;if(adSize.width>adSize.height*backgroundRatio){width=origSizes.width*(adSize.height/origSizes.height);}else{height=origSizes.height*(adSize.width/origSizes.width);}
var fontSize=width/1920;elem.css("font-size",fontSize*10);}
elem.height(height);elem.width(width);};var isHTMLElement=function(obj){var result=false;if(typeof obj.get==="function"){var elements=obj.get();_.every(elements,function(elem){result=_.isElement(elem);return result;});}
else if(_.isElement(obj)){result=true;}
return result;};_.extend(SCOPE.CreativeComponent.prototype,Backbone.Events);})(IVA||(IVA={}));
(function(SCOPE){SCOPE.createOverlay=function(props){SCOPE.Utils.validateFuncProp(props,["show","render"]);var overlay=new SCOPE.CreativeComponent();overlay._cssClass="iva-overlay";_.extend(overlay,props);overlay._show=function(contextImpl){this._render(contextImpl);props.show.apply(overlay);};return overlay;};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.createSlate=function(props){SCOPE.Utils.validateFuncProp(props,["open","close","render"]);var slate=new SCOPE.CreativeComponent();slate._cssClass="iva-slate";_.extend(slate,props);slate._open=function(contextImpl){this._render(contextImpl);props.open.apply(slate);};slate.close=function(){props.close.apply(slate);slate.trigger("close");};return slate;};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.Elements={};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.Elements.createVideo=function(id,slate){var video=$('<video />');if(typeof SCOPE.creativeContext!=="undefined"){if(SCOPE.creativeContext.__contextImpl.shouldTransformToInlineVideo()){SCOPE.creativeContext.__contextImpl.transformToInlineVideo(video[0]);}else{SCOPE.creativeContext.__contextImpl.checkAndOverrideFastSeek(video[0]);}}
video.addClass("iva-in-unit-video");video.attr('webkit-playsinline','webkit-playsinline');video.attr('playsinline','playsinline');video.attr("id",id);slate.addHook(function(contextImpl){var videoData=_.findWhere(contextImpl.iroll.get("data")['html-in-unit-videos'],{"name":id});if(_.isUndefined(videoData))
{throw"could not find a video with id="+id+"under 'html-in-unit-videos' in the config";}
if(_.isEmpty(videoData['poster-image']))
{video.attr("poster","data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=");}
else{video.attr("poster",SCOPE.Utils.getAssetPath(videoData['poster-image']));}
contextImpl.initVideo(video[0],videoData);});return video[0];};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.Elements.createImage=function(assetName){var assetPath=SCOPE.Utils.getAssetPath(assetName);return $('<img src="'+assetPath+'"/>');};})(IVA||(IVA={}));
(function(SCOPE){SCOPE.Preloader=function(config){this.onSuccess=function(asset){if(config.onSuccess){config.onSuccess(asset);}
if(config.onDone){config.onDone(asset);}};this.onError=function(asset){if(config.onError){config.onError(asset);}
if(config.onDone){config.onDone(asset);}};};SCOPE.Preloader.PRELOAD_TIMEOUT_MS=5000;SCOPE.Preloader.prototype.preloadAsset=function(assetId,assetPath){var preloaderElem=SCOPE.Preloader.getAssetPreloaderByFileType(assetPath),that=this;var timer=setTimeout(function(){preloaderElem.onload=function(){};preloaderElem.onerror=function(){};that.onError(assetId);},SCOPE.Preloader.PRELOAD_TIMEOUT_MS);preloaderElem.onload=function(){clearTimeout(timer);that.onSuccess(assetId);};preloaderElem.onerror=function(){clearTimeout(timer);that.onError(assetId);};preloaderElem.preload();};SCOPE.Preloader.getAssetPreloaderByFileType=function(assetPath){var isFontAsset=["woff","otf","ttf","woff2"].some(function(font){var ext="."+font;return assetPath.indexOf(ext)===assetPath.length-ext.length;});var fontLoadingSupported=typeof FontFace!=="undefined";if(isFontAsset&&fontLoadingSupported){return SCOPE.Preloader.getFontPreloader(assetPath);}else{return SCOPE.Preloader.getImagePreloader(assetPath);}};SCOPE.Preloader.getFontPreloader=function(assetPath){var fontCssUrl="url("+assetPath+")";var fontFace=new FontFace("preloaded-font",fontCssUrl);return{preload:function(){fontFace.load().then(this.onload).catch(this.onerror);},onload:function(){},onerror:function(){}};};SCOPE.Preloader.getImagePreloader=function(assetPath){var newAsset=new Image();return{preload:function(){newAsset.onload=this.onload;newAsset.onerror=this.onerror;newAsset.src=assetPath;},onload:function(){},onerror:function(){}};};})(IVA);
(function(SCOPE){SCOPE.Utils={};SCOPE.Utils.isValidUrl=function(url){var regexp=/(\w+):(\/\/)*(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return regexp.test(url.toLowerCase());};SCOPE.Utils.validateFuncProp=function(obj,props){props.forEach(function(prop){if(!obj.hasOwnProperty(prop)||typeof obj[prop]!=="function"){throw new Error("Cannot create object: Missing function: "+prop);}});};SCOPE.Utils.getAssetPath=function(assetName){var path;if(IVA.devMode===true){path=assetName;}
else
{path='https://s3.amazonaws.com/static.innovid.com/display/iroll/package/v1/'+assetName;}
return path;};SCOPE.Utils.getAssetPathWithCB=function(assetName){var path;if(IVA.devMode===true){path=assetName;}
else
{path='https://s3.amazonaws.com/static.innovid.com/display/iroll/package/v1/'+assetName+'?cb=1665521581';}
return path;};})(IVA);
var IVC;(function(SCOPE){"use strict";SCOPE.displayUnit=new IVA.Display();IVA.registerCreative(function(context){var creatives=SCOPE.displayUnit.start(context);console.log("Initial Load Banner Id:",creatives.initialLoadBanner.getElement().id);if(creatives.subLoadBanner!==null){console.log("Sub Load Banner Id:",creatives.subLoadBanner.getElement().id);}});})(IVC||(IVC={}));
var IV=(function(SCOPE){SCOPE.default=function(attrs,appsCore){var id,core,that,interfaceName,cssPath;interfaceName='default';that=this;core=typeof appsCore!=='undefined'?appsCore:new SCOPE.AppsCore({data:SCOPE.baseData.app_data,config:SCOPE.baseData.config_data,interface:this,windowOpen:that.windowOpen,mainEngagementEvent:'click'});cssPath=core.get('cssPath');id=core.get('id');core.setAttribute(attrs);core.trigger('init');function remapEvents(){SCOPE.Events.on(id+':impression',function(){that.trigger('impression');});SCOPE.Events.on(id+':video_videoPassed50',function(){that.trigger('midpoint');});SCOPE.Events.on(id+':ad_ended',function(){that.trigger('completion');core.cleanUp();});SCOPE.Events.on(id+':openUrl',function(url){that.trigger('openUrl',url);});SCOPE.Events.on(id+':close',function(){that.trigger('close');core.cleanUp();});}
function remapEventsAndTriggerCoreStart(){remapEvents();core.trigger('start');}
var appendCss=function(){$('head').append('<link rel="stylesheet" href="'+cssPath+'" type="text/css" />');};this.windowOpen=function(url){window.open(url);};this.supports=function(feature){return false};this.createCalendarEvent=function(parameters,url){window.location.href=url;};this.start=function(){appendCss();remapEventsAndTriggerCoreStart();};this.startPreview=function(){appendCss();SCOPE.Events.on(id+":preview_play_click",function(){remapEventsAndTriggerCoreStart();});SCOPE.Events.trigger("previewPlayerReady",core);};this.$log=function(logString){core.$log(logString);};this.setAttribute=function(attrs){var params=attrs||null;if(params==null)return false;if(_.isObject(params)){core.set(params,{silent:true});}};this.reloadPage=function(){setTimeout(function(){window.location.reload();},500);};};_.extend(SCOPE.default.prototype,Backbone.Events);if(typeof(IVAPPS)=='undefined'){window['IVAPPS']=SCOPE.default;}
return SCOPE;})(IV||{});
